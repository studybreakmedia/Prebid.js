{"version":3,"sources":["webpack:///./modules/underdogmediaBidAdapter.js"],"names":["utils","BIDDER_CODE","UDM_ADAPTER_VERSION","spec","code","bidParams","isBidRequestValid","bid","params","siteId","sizes","length","buildRequests","validBidRequests","forEach","flatten","parseSizesInput","bidParam","method","url","window","location","protocol","data","join","interpretResponse","serverResponse","bidRequest","bidResponses","body","mids","mid","useCount","size_not_found","size","width","height","bidResponse","requestId","bidId","bidderCode","cpm","parseFloat","ad","ad_code_html","creativeId","currency","netRevenue","ttl","getConfig","makeNotification","push","notification_url","Math","random","encodeURIComponent","document","visibilityState","JSON","stringify","getUrlVars","subId","vars","hash","hashes","href","slice","indexOf","split","i","match","substr"],"mappings":"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","file":"underdogmediaBidAdapter.js","sourcesContent":["import * as utils from 'src/utils';\nimport { config } from 'src/config';\nimport { registerBidder } from 'src/adapters/bidderFactory';\nconst BIDDER_CODE = 'underdogmedia';\nconst UDM_ADAPTER_VERSION = '1.0';\n\nexport const spec = {\n  code: BIDDER_CODE,\n  bidParams: [],\n\n  isBidRequestValid: function (bid) {\n    return !!((bid.params && bid.params.siteId) && (bid.sizes && bid.sizes.length > 0));\n  },\n\n  buildRequests: function (validBidRequests) {\n    var sizes = [];\n    var siteId = 0;\n\n    validBidRequests.forEach(bidParam => {\n      sizes = utils.flatten(sizes, utils.parseSizesInput(bidParam.sizes));\n      siteId = bidParam.params.siteId;\n    });\n\n    return {\n      method: 'GET',\n      url: `${window.location.protocol}//udmserve.net/udm/img.fetch`,\n      data: `tid=1;dt=10;sid=${siteId};sizes=${sizes.join(',')}`,\n      bidParams: validBidRequests\n    };\n  },\n\n  interpretResponse: function (serverResponse, bidRequest) {\n    const bidResponses = [];\n    bidRequest.bidParams.forEach(bidParam => {\n      serverResponse.body.mids.forEach(mid => {\n        if (mid.useCount > 0) {\n          return;\n        }\n\n        if (!mid.useCount) {\n          mid.useCount = 0;\n        }\n\n        var size_not_found = true;\n        utils.parseSizesInput(bidParam.sizes).forEach(size => {\n          if (size === mid.width + 'x' + mid.height) {\n            size_not_found = false;\n          }\n        });\n\n        if (size_not_found) {\n          return;\n        }\n\n        const bidResponse = {\n          requestId: bidParam.bidId,\n          bidderCode: spec.code,\n          cpm: parseFloat(mid.cpm),\n          width: mid.width,\n          height: mid.height,\n          ad: mid.ad_code_html,\n          creativeId: mid.mid,\n          currency: 'USD',\n          netRevenue: false,\n          ttl: config.getConfig('_bidderTimeout'),\n        };\n\n        if (bidResponse.cpm <= 0) {\n          return;\n        }\n        if (bidResponse.ad.length <= 0) {\n          return;\n        }\n\n        mid.useCount++;\n\n        bidResponse.ad += makeNotification(bidResponse, mid, bidParam);\n\n        bidResponses.push(bidResponse);\n      });\n    });\n\n    return bidResponses;\n  },\n};\n\nfunction makeNotification (bid, mid, bidParam) {\n  var url = mid.notification_url;\n\n  url += UDM_ADAPTER_VERSION;\n  url += ';cb=' + Math.random();\n  url += ';qqq=' + (1 / bid.cpm);\n  url += ';hbt=' + config.getConfig('_bidderTimeout');\n  url += ';style=adapter';\n  url += ';vis=' + encodeURIComponent(document.visibilityState);\n\n  url += ';traffic_info=' + encodeURIComponent(JSON.stringify(getUrlVars()));\n  if (bidParam.params.subId) {\n    url += ';subid=' + encodeURIComponent(bidParam.params.subId);\n  }\n  return '<script async src=\"' + url + '\"></script>';\n}\n\nfunction getUrlVars() {\n  var vars = {};\n  var hash;\n  var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');\n  for (var i = 0; i < hashes.length; i++) {\n    hash = hashes[i].split('=');\n    if (hash[0].match(/^utm_/)) {\n      vars[hash[0]] = hash[1].substr(0, 150);\n    }\n  }\n  return vars;\n}\n\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/underdogmediaBidAdapter.js"],"sourceRoot":""}