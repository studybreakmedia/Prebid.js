{"version":3,"sources":["webpack:///./modules/trionBidAdapter.js"],"names":["getStorageData","setStorageData","acceptPostMessage","utils","BID_REQUEST_BASE_URL","USER_SYNC_URL","BIDDER_CODE","BASE_KEY","spec","code","isBidRequestValid","bid","params","pubId","sectionId","buildRequests","validBidRequests","bidRequests","i","length","trionUrlParams","buildTrionUrlParams","push","method","url","bidRequest","data","interpretResponse","trionResponseObj","request","bidResponses","responseBody","body","bidId","result","cpm","placeBid","ad","parseInt","requestId","width","height","ttl","creativeId","currency","netRevenue","getUserSyncs","syncOptions","iframeEnabled","handlePostMessage","type","getSyncUrl","unParsedPubAndSection","pubSectionArray","split","getTopWindowUrl","getBidIdParameter","re","sizes","parseSizesInput","join","int_t","window","TR_INT_T","trionUrl","tryAppendQueryString","encodeURIComponent","lastIndexOf","substring","addEventListener","e","key","item","localStorage","getItem","setItem","message","indexOf"],"mappings":"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","file":"trionBidAdapter.js","sourcesContent":["import * as utils from 'src/utils';\nimport {registerBidder} from 'src/adapters/bidderFactory';\n\nconst BID_REQUEST_BASE_URL = 'https://in-appadvertising.com/api/bidRequest';\nconst USER_SYNC_URL = 'https://in-appadvertising.com/api/userSync.html';\nconst BIDDER_CODE = 'trion';\nconst BASE_KEY = '_trion_';\n\nexport const spec = {\n  code: BIDDER_CODE,\n  isBidRequestValid: function (bid) {\n    return !!(bid && bid.params && bid.params.pubId && bid.params.sectionId);\n  },\n  buildRequests: function (validBidRequests) {\n    var bidRequests = [];\n\n    for (var i = 0; i < validBidRequests.length; i++) {\n      var bid = validBidRequests[i];\n\n      var trionUrlParams = buildTrionUrlParams(bid);\n\n      bidRequests.push({\n        method: 'GET',\n        url: BID_REQUEST_BASE_URL,\n        bidRequest: bid,\n        data: trionUrlParams\n      });\n    }\n    return bidRequests;\n  },\n\n  interpretResponse: function (trionResponseObj, request) {\n    var bid = {};\n    var bidResponses = [];\n    var bidRequest = request.bidRequest;\n    var responseBody = trionResponseObj ? trionResponseObj.body : {};\n\n    if (responseBody && responseBody.bidId && bidRequest) {\n      var result = responseBody.result;\n\n      if (result && result.cpm && result.placeBid && result.ad) {\n        var cpm = parseInt(result.cpm, 10) / 100;\n\n        bid.requestId = bidRequest.bidId;\n        bid.cpm = cpm;\n        bid.ad = result.ad;\n        bid.width = result.width;\n        bid.height = result.height;\n        bid.ttl = result.ttl;\n        bid.creativeId = result.creativeId;\n        bid.currency = result.currency;\n        bid.netRevenue = result.netRevenue;\n        bidResponses.push(bid);\n      }\n    }\n\n    return bidResponses;\n  },\n  getUserSyncs: function getUserSyncs(syncOptions) {\n    if (syncOptions.iframeEnabled) {\n      handlePostMessage();\n      return [{\n        type: 'iframe',\n        url: getSyncUrl()\n      }];\n    }\n  }\n\n};\nregisterBidder(spec);\n\nfunction getSyncUrl() {\n  var unParsedPubAndSection = getStorageData(BASE_KEY + 'lps') || ':';\n  var pubSectionArray = unParsedPubAndSection.split(':') || [];\n  var pubId = pubSectionArray[0] || -1;\n  var sectionId = pubSectionArray[1] || -1;\n  var url = utils.getTopWindowUrl();\n  return USER_SYNC_URL + `?p=${pubId}&s=${sectionId}&u=${url}`;\n}\n\nfunction buildTrionUrlParams(bid) {\n  var pubId = utils.getBidIdParameter('pubId', bid.params);\n  var sectionId = utils.getBidIdParameter('sectionId', bid.params);\n  var re = utils.getBidIdParameter('re', bid.params);\n  var url = utils.getTopWindowUrl();\n  var sizes = utils.parseSizesInput(bid.sizes).join(',');\n\n  var int_t = window.TR_INT_T && window.TR_INT_T != -1 ? window.TR_INT_T : null;\n  if (!int_t) {\n    int_t = getStorageData(BASE_KEY + 'int_t');\n  }\n  if (int_t) {\n    setStorageData(BASE_KEY + 'int_t', int_t)\n  }\n  setStorageData(BASE_KEY + 'lps', pubId + ':' + sectionId);\n  var trionUrl = '';\n\n  trionUrl = utils.tryAppendQueryString(trionUrl, 'bidId', bid.bidId);\n  trionUrl = utils.tryAppendQueryString(trionUrl, 'pubId', pubId);\n  trionUrl = utils.tryAppendQueryString(trionUrl, 'sectionId', sectionId);\n  trionUrl = utils.tryAppendQueryString(trionUrl, 're', re);\n  if (url) {\n    trionUrl += 'url=' + url + '&';\n  }\n  if (sizes) {\n    trionUrl += 'sizes=' + sizes + '&';\n  }\n  if (int_t) {\n    trionUrl = utils.tryAppendQueryString(trionUrl, 'int_t', encodeURIComponent(int_t));\n  }\n\n  // remove the trailing \"&\"\n  if (trionUrl.lastIndexOf('&') === trionUrl.length - 1) {\n    trionUrl = trionUrl.substring(0, trionUrl.length - 1);\n  }\n  return trionUrl;\n}\n\nfunction handlePostMessage() {\n  try {\n    if (window.addEventListener) {\n      window.addEventListener('message', acceptPostMessage);\n    }\n  } catch (e) {\n  }\n}\n\nexport function getStorageData(key) {\n  var item = null;\n  try {\n    if (window.localStorage) {\n      item = window.localStorage.getItem(key);\n    }\n  } catch (e) {\n  }\n  return item;\n}\n\nexport function setStorageData(key, item) {\n  try {\n    if (window.localStorage) {\n      window.localStorage.setItem(key, item);\n    }\n  } catch (e) {\n  }\n}\n\nexport function acceptPostMessage(e) {\n  var message = e.data || '';\n  if (message.indexOf(BASE_KEY + 'userId') !== 0) {\n    return;\n  }\n  var int_t = message.split(BASE_KEY + 'userId=')[1];\n  if (int_t) {\n    setStorageData(BASE_KEY + 'int_t', int_t);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./modules/trionBidAdapter.js"],"sourceRoot":""}