{"version":3,"sources":["webpack:///./modules/aolBidAdapter.js"],"names":["utils","AOL_BIDDERS_CODES","AOL","ONEMOBILE","ONEDISPLAY","AOL_ENDPOINTS","DISPLAY","GET","MOBILE","POST","SYNC_TYPES","IFRAME","TAG","TYPE","IMAGE","pubapiTemplate","template","nexageBaseApiTemplate","nexageGetApiTemplate","MP_SERVER_MAP","us","eu","as","NEXAGE_SERVER","BID_RESPONSE_TTL","pbjs","aolGlobals","pixelsDropped","showCpmAdjustmentWarning","showCpmWarning","bidderSettings","aol","bidCpmAdjustment","logWarn","strings","keys","values","dict","length","result","forEach","key","i","value","Number","isInteger","push","join","isSecureProtocol","document","location","protocol","parsePixelItems","pixels","itemsRegExp","tagNameRegExp","srcRegExp","pixelsItems","matchedItems","match","tagName","item","url","type","_buildMarketplaceUrl","bid","params","serverParam","server","regionParam","region","hasOwnProperty","host","network","placement","parseInt","pageid","pageId","sizeid","sizeId","alias","getUniqueIdentifierStr","bidfloor","formatMarketplaceBidFloor","bidFloor","keyValues","formatMarketplaceKeyValues","misc","Date","getTime","toString","formattedKeyValues","_each","encodeURIComponent","_buildOneMobileBaseUrl","_buildOneMobileGetUrl","dcn","pos","nexageApi","ext","secure","_parseBidResponse","response","bidRequest","bidData","seatbid","e","cpm","encp","price","isNaN","logError","ad","adm","getConfig","EVENTS","BID_RESPONSE","formattedPixels","replace","bidderCode","requestId","bidId","width","w","height","h","creativeId","crid","pubapiId","id","currency","cur","dealId","dealid","netRevenue","ttl","_isMarketplaceBidder","bidder","_isNexageBidder","_isNexageRequestPost","imp","tagid","banner","video","mimes","minduration","maxduration","_isNexageRequestGet","isMarketplaceBid","isMobileBid","resolveEndpointCode","formatBidRequest","endpointCode","method","data","options","contentType","customHeaders","userSyncOn","interpretResponse","body","mediaType","spec","code","aliases","isBidRequestValid","buildRequests","bids","map","getUserSyncs","bidResponses","bidResponse"],"mappings":"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","file":"aolBidAdapter.js","sourcesContent":["import * as utils from 'src/utils';\nimport { registerBidder } from 'src/adapters/bidderFactory';\nimport { config } from 'src/config';\nimport constants from 'src/constants.json';\nimport { BANNER } from 'src/mediaTypes';\n\nconst AOL_BIDDERS_CODES = {\n  AOL: 'aol',\n  ONEMOBILE: 'onemobile',\n  ONEDISPLAY: 'onedisplay'\n};\n\nconst AOL_ENDPOINTS = {\n  DISPLAY: {\n    GET: 'display-get'\n  },\n  MOBILE: {\n    GET: 'mobile-get',\n    POST: 'mobile-post'\n  }\n};\n\nconst SYNC_TYPES = {\n  IFRAME: {\n    TAG: 'iframe',\n    TYPE: 'iframe'\n  },\n  IMAGE: {\n    TAG: 'img',\n    TYPE: 'image'\n  }\n};\n\nconst pubapiTemplate = template`//${'host'}/pubapi/3.0/${'network'}/${'placement'}/${'pageid'}/${'sizeid'}/ADTECH;v=2;cmd=bid;cors=yes;alias=${'alias'}${'bidfloor'}${'keyValues'};misc=${'misc'}`;\nconst nexageBaseApiTemplate = template`//${'host'}/bidRequest?`;\nconst nexageGetApiTemplate = template`dcn=${'dcn'}&pos=${'pos'}&cmd=bid${'ext'}`;\nconst MP_SERVER_MAP = {\n  us: 'adserver-us.adtech.advertising.com',\n  eu: 'adserver-eu.adtech.advertising.com',\n  as: 'adserver-as.adtech.advertising.com'\n};\nconst NEXAGE_SERVER = 'hb.nexage.com';\nconst BID_RESPONSE_TTL = 300;\n\npbjs.aolGlobals = {\n  pixelsDropped: false\n};\n\nlet showCpmAdjustmentWarning = (function () {\n  let showCpmWarning = true;\n\n  return function () {\n    let bidderSettings = pbjs.bidderSettings;\n    if (showCpmWarning && bidderSettings && bidderSettings.aol &&\n      typeof bidderSettings.aol.bidCpmAdjustment === 'function') {\n      utils.logWarn(\n        'bidCpmAdjustment is active for the AOL adapter. ' +\n        'As of Prebid 0.14, AOL can bid in net â€“ please contact your accounts team to enable.'\n      );\n      showCpmWarning = false; // warning is shown at most once\n    }\n  };\n})();\n\nfunction template(strings, ...keys) {\n  return function(...values) {\n    let dict = values[values.length - 1] || {};\n    let result = [strings[0]];\n    keys.forEach(function(key, i) {\n      let value = Number.isInteger(key) ? values[key] : dict[key];\n      result.push(value, strings[i + 1]);\n    });\n    return result.join('');\n  };\n}\n\nfunction isSecureProtocol() {\n  return document.location.protocol === 'https:';\n}\n\nfunction parsePixelItems(pixels) {\n  let itemsRegExp = /(img|iframe)[\\s\\S]*?src\\s*=\\s*(\"|')(.*?)\\2/gi;\n  let tagNameRegExp = /\\w*(?=\\s)/;\n  let srcRegExp = /src=(\"|')(.*?)\\1/;\n  let pixelsItems = [];\n\n  if (pixels) {\n    let matchedItems = pixels.match(itemsRegExp);\n    if (matchedItems) {\n      matchedItems.forEach(item => {\n        let tagName = item.match(tagNameRegExp)[0];\n        let url = item.match(srcRegExp)[2];\n\n        if (tagName && tagName) {\n          pixelsItems.push({\n            type: tagName === SYNC_TYPES.IMAGE.TAG ? SYNC_TYPES.IMAGE.TYPE : SYNC_TYPES.IFRAME.TYPE,\n            url: url\n          });\n        }\n      });\n    }\n  }\n\n  return pixelsItems;\n}\n\nfunction _buildMarketplaceUrl(bid) {\n  const params = bid.params;\n  const serverParam = params.server;\n  let regionParam = params.region || 'us';\n  let server;\n\n  if (!MP_SERVER_MAP.hasOwnProperty(regionParam)) {\n    utils.logWarn(`Unknown region '${regionParam}' for AOL bidder.`);\n    regionParam = 'us'; // Default region.\n  }\n\n  if (serverParam) {\n    server = serverParam;\n  } else {\n    server = MP_SERVER_MAP[regionParam];\n  }\n\n  // Set region param, used by AOL analytics.\n  params.region = regionParam;\n\n  return pubapiTemplate({\n    host: server,\n    network: params.network,\n    placement: parseInt(params.placement),\n    pageid: params.pageId || 0,\n    sizeid: params.sizeId || 0,\n    alias: params.alias || utils.getUniqueIdentifierStr(),\n    bidfloor: formatMarketplaceBidFloor(params.bidFloor),\n    keyValues: formatMarketplaceKeyValues(params.keyValues),\n    misc: new Date().getTime() // cache busting\n  });\n}\n\nfunction formatMarketplaceBidFloor(bidFloor) {\n  return (typeof bidFloor !== 'undefined') ? `;bidfloor=${bidFloor.toString()}` : '';\n}\n\nfunction formatMarketplaceKeyValues(keyValues) {\n  let formattedKeyValues = '';\n\n  utils._each(keyValues, (value, key) => {\n    formattedKeyValues += `;kv${key}=${encodeURIComponent(value)}`;\n  });\n\n  return formattedKeyValues;\n}\n\nfunction _buildOneMobileBaseUrl(bid) {\n  return nexageBaseApiTemplate({\n    host: bid.params.host || NEXAGE_SERVER\n  });\n}\n\nfunction _buildOneMobileGetUrl(bid) {\n  let {dcn, pos} = bid.params;\n  let nexageApi = _buildOneMobileBaseUrl(bid);\n  if (dcn && pos) {\n    let ext = '';\n    if (isSecureProtocol()) {\n      bid.params.ext = bid.params.ext || {};\n      bid.params.ext.secure = 1;\n    }\n    utils._each(bid.params.ext, (value, key) => {\n      ext += `&${key}=${encodeURIComponent(value)}`;\n    });\n    nexageApi += nexageGetApiTemplate({dcn, pos, ext});\n  }\n  return nexageApi;\n}\n\nfunction _parseBidResponse(response, bidRequest) {\n  let bidData;\n\n  try {\n    bidData = response.seatbid[0].bid[0];\n  } catch (e) {\n    return;\n  }\n\n  let cpm;\n\n  if (bidData.ext && bidData.ext.encp) {\n    cpm = bidData.ext.encp;\n  } else {\n    cpm = bidData.price;\n\n    if (cpm === null || isNaN(cpm)) {\n      utils.logError('Invalid price in bid response', AOL_BIDDERS_CODES.AOL, bid);\n      return;\n    }\n  }\n\n  let ad = bidData.adm;\n  if (response.ext && response.ext.pixels) {\n    if (config.getConfig('aol.userSyncOn') !== constants.EVENTS.BID_RESPONSE) {\n      let formattedPixels = response.ext.pixels.replace(/<\\/?script( type=('|\")text\\/javascript('|\")|)?>/g, '');\n\n      ad += '<script>if(!parent.pbjs.aolGlobals.pixelsDropped){' +\n        'parent.pbjs.aolGlobals.pixelsDropped=true;' + formattedPixels +\n        '}</script>';\n    }\n  }\n\n  return {\n    bidderCode: bidRequest.bidderCode,\n    requestId: bidRequest.bidId,\n    ad: ad,\n    cpm: cpm,\n    width: bidData.w,\n    height: bidData.h,\n    creativeId: bidData.crid,\n    pubapiId: response.id,\n    currency: response.cur,\n    dealId: bidData.dealid,\n    netRevenue: true,\n    ttl: BID_RESPONSE_TTL\n  };\n}\n\nfunction _isMarketplaceBidder(bidder) {\n  return bidder === AOL_BIDDERS_CODES.AOL || bidder === AOL_BIDDERS_CODES.ONEDISPLAY;\n}\n\nfunction _isNexageBidder(bidder) {\n  return bidder === AOL_BIDDERS_CODES.AOL || bidder === AOL_BIDDERS_CODES.ONEMOBILE;\n}\n\nfunction _isNexageRequestPost(bid) {\n  if (_isNexageBidder(bid.bidder) && bid.params.id && bid.params.imp && bid.params.imp[0]) {\n    let imp = bid.params.imp[0];\n    return imp.id && imp.tagid &&\n      ((imp.banner && imp.banner.w && imp.banner.h) ||\n        (imp.video && imp.video.mimes && imp.video.minduration && imp.video.maxduration));\n  }\n}\n\nfunction _isNexageRequestGet(bid) {\n  return _isNexageBidder(bid.bidder) && bid.params.dcn && bid.params.pos;\n}\n\nfunction isMarketplaceBid(bid) {\n  return _isMarketplaceBidder(bid.bidder) && bid.params.placement && bid.params.network;\n}\n\nfunction isMobileBid(bid) {\n  return _isNexageRequestGet(bid) || _isNexageRequestPost(bid);\n}\n\nfunction resolveEndpointCode(bid) {\n  if (_isNexageRequestGet(bid)) {\n    return AOL_ENDPOINTS.MOBILE.GET;\n  } else if (_isNexageRequestPost(bid)) {\n    return AOL_ENDPOINTS.MOBILE.POST;\n  } else if (isMarketplaceBid(bid)) {\n    return AOL_ENDPOINTS.DISPLAY.GET;\n  }\n}\n\nfunction formatBidRequest(endpointCode, bid) {\n  let bidRequest;\n\n  switch (endpointCode) {\n    case AOL_ENDPOINTS.DISPLAY.GET:\n      bidRequest = {\n        url: _buildMarketplaceUrl(bid),\n        method: 'GET'\n      };\n      break;\n\n    case AOL_ENDPOINTS.MOBILE.GET:\n      bidRequest = {\n        url: _buildOneMobileGetUrl(bid),\n        method: 'GET'\n      };\n      break;\n\n    case AOL_ENDPOINTS.MOBILE.POST:\n      bidRequest = {\n        url: _buildOneMobileBaseUrl(bid),\n        method: 'POST',\n        data: bid.params,\n        options: {\n          contentType: 'application/json',\n          customHeaders: {\n            'x-openrtb-version': '2.2'\n          }\n        }\n      };\n      break;\n  }\n\n  bidRequest.bidderCode = bid.bidder;\n  bidRequest.bidId = bid.bidId;\n  bidRequest.userSyncOn = bid.params.userSyncOn;\n\n  return bidRequest;\n}\n\nfunction interpretResponse({body}, bidRequest) {\n  showCpmAdjustmentWarning();\n  if (!body) {\n    utils.logError('Empty bid response', bidRequest.bidderCode, body);\n  } else {\n    let bid = _parseBidResponse(body, bidRequest);\n\n    if (bid) {\n      return bid;\n    }\n  }\n  return {\n    requestId: bidRequest.bidId,\n    cpm: 0,\n    width: 1,\n    height: 1,\n    creativeId: null,\n    dealId: null,\n    currency: 'USD',\n    netRevenue: true,\n    mediaType: BANNER,\n    ttl: 60000,\n    ad: null\n  }\n}\n\nexport const spec = {\n  code: AOL_BIDDERS_CODES.AOL,\n  aliases: [AOL_BIDDERS_CODES.ONEMOBILE, AOL_BIDDERS_CODES.ONEDISPLAY],\n  isBidRequestValid: function(bid) {\n    return isMarketplaceBid(bid) || isMobileBid(bid);\n  },\n  buildRequests: function (bids) {\n    return bids.map(bid => {\n      const endpointCode = resolveEndpointCode(bid);\n\n      if (endpointCode) {\n        return formatBidRequest(endpointCode, bid);\n      }\n    });\n  },\n  interpretResponse: interpretResponse,\n  getUserSyncs: function(options, bidResponses) {\n    let bidResponse = bidResponses[0];\n\n    if (config.getConfig('aol.userSyncOn') === constants.EVENTS.BID_RESPONSE) {\n      if (!pbjs.aolGlobals.pixelsDropped && bidResponse.ext && bidResponse.ext.pixels) {\n        pbjs.aolGlobals.pixelsDropped = true;\n\n        return parsePixelItems(bidResponse.ext.pixels);\n      }\n    }\n\n    return [];\n  }\n};\n\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/aolBidAdapter.js"],"sourceRoot":""}