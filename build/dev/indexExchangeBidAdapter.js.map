{"version":3,"sources":["webpack:///./modules/indexExchangeBidAdapter.js"],"names":["utils","url","ADAPTER_NAME","ADAPTER_CODE","CONSTANTS","OPEN_MARKET","PRIVATE_MARKET","VIDEO_REQUIRED_PARAMS_MAP","siteID","playerType","protocols","maxduration","VIDEO_OPTIONAL_PARAMS_MAP","minduration","startdelay","linearity","mimes","allowVPAID","apiList","SUPPORTED_PLAYER_TYPES_MAP","HTML5","FLASH","SUPPORTED_PROTOCOLS_MAP","SUPPORTED_API_MAP","LINEARITY_MAP","linear","nonlinear","START_DELAY_MAP","preroll","midroll","postroll","SLOT_ID_PREFIX_MAP","DEFAULT_MIMES_MAP","DEFAULT_VPAID_MIMES_MAP","BASE_CYGNUS_VIDEO_URL_INSECURE","BASE_CYGNUS_VIDEO_URL_SECURE","window","cygnus_index_parse_res","response","_IndexRequestData","impIDToSlotID","id","targetMode","callbackFn","reqOptions","callback","lastRequestID","targetIDToBid","targetIDToResp","targetIDToCreative","allBids","seatbidLength","seatbid","length","i","j","bid","ext","pricelevel","impid","slotID","targetID","noTargetModeTargetID","targetPrefix","dealid","undefined","adm","push","impBid","impressionID","dealID","price","priceLevel","target","e","cygnus_index_ready_state","index_render","doc","ad","pop","write","getTopWindowLocation","protocol","cygnus_index_args","encodeURIComponent","location","href","px_call","Image","src","headertag_render","index_slot","index_ary","split","unpack","cygnus_index_adunits","getIndexDebugMode","getParameterByName","INDEX_DEBUG_MODE","queryParam","toUpperCase","name","wdw","childsReferrer","x","mode","sandbox","topFrameLimit","parent","document","referrer","err","topURL","top","self","regexS","regex","RegExp","results","exec","decodeURIComponent","replace","cygnus_index_start","parseFn","escapable","meta","escapeCharacter","character","escaped","charCodeAt","toString","slice","quote","string","lastIndex","test","OpenRTBRequest","timeoutDelay","initialized","Number","impressions","_parseFnName","sitePage","getTopWindowUrl","topframe","requestCounter","Math","floor","random","requestID","String","Date","getTime","prototype","serialize","json","impObj","w","h","bidfloor","bidfloorcur","match","join","setPageOverride","sitePageOverride","addImpression","width","height","bidFloor","bidFloorCurrency","buildRequest","jsonURI","scriptSrc","queryValue","logMessage","prebidVersion","slots","req","timeout","slotDef","impID","logError","IndexExchangeAdapter","baseAdapter","slotIdMap","requiredParams","firstAdUnitCode","bidRequests","passOnBid","adUnitCode","createBid","bidderCode","addBidResponse","_callBids","request","isEmpty","bidArr","bids","targetAggregate","videoImpressions","forEach","mediaType","impression","buildVideoImpressions","cygnus_index_init","sendVideoRequest","bidderRequestId","loadScript","responded","indexObj","adSlotId","bidObj","placementCode","cpmAndSlotId","tier","currentCPM","slotObj","getSlotObj","cpm","dealId","logErrorBidResponse","hasValidBidRequest","params","sizeID","isArray","sizes","validSize","k","usingSizeSpecificSiteID","size","slotName","mergeSlotInto","tier2SiteID","tier3SiteID","cygnusRequest","imp","cygnusRequestUrl","createCygnusRequest","validateBid","transformBid","bidId","prebid","cygnusImpression","video","podType","sid","Object","keys","filter","param","bidSize","getSizes","shift","cygnus","slot","slotList","obj","arr","returnObj","_each","value","cygnusUrl","parse","search","s","r","JSON","stringify","formattedCygnusUrl","format","pbjs","handleCygnusResponse","logInfo","prebidRequest","createBidObj","NO_BID","seat","validBid","cygnusBid","vasturl","host","charAt","isNumber","isNaN","GOOD","vastUrl","status","code","getBidderCode","isValidSite","isValidPlayerType","isValidProtocolArray","isValidDuration","intSiteID","isStr","protocolArray","duration","intDuration","isValidMimeArray","mimeArray","mimeType","isEmptyStr","isValidLinearity","isValidStartDelay","intStartdelay","isValidApiArray","apiArray","api","includes","reduce","concat","isA","requestSizes","sizeObj","parseInt","callBids","registerBidAdapter","supportedMediaTypes","module","exports"],"mappings":"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","file":"indexExchangeBidAdapter.js","sourcesContent":["// Factory for creating the bidderAdaptor\n// jshint ignore:start\nimport Adapter from 'src/adapter';\nimport bidfactory from 'src/bidfactory';\nimport bidmanager from 'src/bidmanager';\nimport * as utils from 'src/utils';\nimport { STATUS } from 'src/constants';\nimport * as url from 'src/url';\nimport adloader from 'src/adloader';\nimport adaptermanager from 'src/adaptermanager';\n\nvar ADAPTER_NAME = 'INDEXEXCHANGE';\nvar ADAPTER_CODE = 'indexExchange';\n\nvar CONSTANTS = {\n  'INDEX_DEBUG_MODE': {\n    'queryParam': 'pbjs_ix_debug',\n    'mode': {\n      'sandbox': {\n        'topFrameLimit': 10,\n        'queryValue': 'sandbox',\n        'siteID': '999990'\n      }\n    }\n  }\n};\n\nvar OPEN_MARKET = 'IOM';\nvar PRIVATE_MARKET = 'IPM';\n\nconst VIDEO_REQUIRED_PARAMS_MAP = {\n  siteID: true,\n  playerType: true,\n  protocols: true,\n  maxduration: true\n};\nconst VIDEO_OPTIONAL_PARAMS_MAP = {\n  minduration: 0,\n  startdelay: 'preroll',\n  linearity: 'linear',\n  mimes: [],\n  allowVPAID: true,\n  apiList: []\n};\nconst SUPPORTED_PLAYER_TYPES_MAP = {\n  HTML5: true,\n  FLASH: true\n};\nconst SUPPORTED_PROTOCOLS_MAP = {\n  'VAST2': [2, 5],\n  'VAST3': [3, 6]\n};\nconst SUPPORTED_API_MAP = {\n  FLASH: [1, 2],\n  HTML5: [2]\n};\nconst LINEARITY_MAP = {\n  linear: 1,\n  nonlinear: 2\n};\nconst START_DELAY_MAP = {\n  preroll: 0,\n  midroll: -1,\n  postroll: -2\n};\nconst SLOT_ID_PREFIX_MAP = {\n  preroll: 'pr',\n  midroll: 'm',\n  postroll: 'po'\n};\nconst DEFAULT_MIMES_MAP = {\n  FLASH: ['video/mp4', 'video/x-flv'],\n  HTML5: ['video/mp4', 'video/webm']\n};\nconst DEFAULT_VPAID_MIMES_MAP = {\n  FLASH: ['application/x-shockwave-flash'],\n  HTML5: ['application/javascript']\n};\n\nconst BASE_CYGNUS_VIDEO_URL_INSECURE = `http://as.casalemedia.com/cygnus?v=8&fn=pbjs.handleCygnusResponse`;\nconst BASE_CYGNUS_VIDEO_URL_SECURE = `https://as-sec.casalemedia.com/cygnus?v=8&fn=pbjs.handleCygnusResponse`;\n\nwindow.cygnus_index_parse_res = function(response) {\n  try {\n    if (response) {\n      if (typeof _IndexRequestData !== 'object' || typeof _IndexRequestData.impIDToSlotID !== 'object' || typeof _IndexRequestData.impIDToSlotID[response.id] === 'undefined') {\n        return;\n      }\n      var targetMode = 1;\n      var callbackFn;\n      if (typeof _IndexRequestData.reqOptions === 'object' && typeof _IndexRequestData.reqOptions[response.id] === 'object') {\n        if (typeof _IndexRequestData.reqOptions[response.id].callback === 'function') {\n          callbackFn = _IndexRequestData.reqOptions[response.id].callback;\n        }\n        if (typeof _IndexRequestData.reqOptions[response.id].targetMode === 'number') {\n          targetMode = _IndexRequestData.reqOptions[response.id].targetMode;\n        }\n      }\n\n      _IndexRequestData.lastRequestID = response.id;\n      _IndexRequestData.targetIDToBid = {};\n      _IndexRequestData.targetIDToResp = {};\n      _IndexRequestData.targetIDToCreative = {};\n\n      var allBids = [];\n      var seatbidLength = typeof response.seatbid === 'undefined' ? 0 : response.seatbid.length;\n      for (var i = 0; i < seatbidLength; i++) {\n        for (var j = 0; j < response.seatbid[i].bid.length; j++) {\n          var bid = response.seatbid[i].bid[j];\n          if (typeof bid.ext !== 'object' || typeof bid.ext.pricelevel !== 'string') {\n            continue;\n          }\n          if (typeof _IndexRequestData.impIDToSlotID[response.id][bid.impid] === 'undefined') {\n            continue;\n          }\n          var slotID = _IndexRequestData.impIDToSlotID[response.id][bid.impid];\n          var targetID;\n          var noTargetModeTargetID;\n          var targetPrefix;\n          if (typeof bid.ext.dealid === 'string') {\n            if (targetMode === 1) {\n              targetID = slotID + bid.ext.pricelevel;\n            } else {\n              targetID = slotID + '_' + bid.ext.dealid;\n            }\n            noTargetModeTargetID = slotID + '_' + bid.ext.dealid;\n            targetPrefix = PRIVATE_MARKET + '_';\n          } else {\n            targetID = slotID + bid.ext.pricelevel;\n            noTargetModeTargetID = slotID + bid.ext.pricelevel;\n            targetPrefix = OPEN_MARKET + '_';\n          }\n          if (_IndexRequestData.targetIDToBid[targetID] === undefined) {\n            _IndexRequestData.targetIDToBid[targetID] = [bid.adm];\n          } else {\n            _IndexRequestData.targetIDToBid[targetID].push(bid.adm);\n          }\n          if (_IndexRequestData.targetIDToCreative[noTargetModeTargetID] === undefined) {\n            _IndexRequestData.targetIDToCreative[noTargetModeTargetID] = [bid.adm];\n          } else {\n            _IndexRequestData.targetIDToCreative[noTargetModeTargetID].push(bid.adm);\n          }\n          var impBid = {};\n          impBid.impressionID = bid.impid;\n          if (typeof bid.ext.dealid !== 'undefined') {\n            impBid.dealID = bid.ext.dealid;\n          }\n          impBid.bid = bid.price;\n          impBid.slotID = slotID;\n          impBid.priceLevel = bid.ext.pricelevel;\n          impBid.target = targetPrefix + targetID;\n          _IndexRequestData.targetIDToResp[targetID] = impBid;\n          allBids.push(impBid);\n        }\n      }\n      if (typeof callbackFn === 'function') {\n        if (allBids.length === 0) {\n          callbackFn(response.id);\n        } else {\n          callbackFn(response.id, allBids);\n        }\n      }\n    }\n  } catch (e) {}\n\n  if (typeof window.cygnus_index_ready_state === 'function') {\n    window.cygnus_index_ready_state();\n  }\n}\n\nwindow.index_render = function(doc, targetID) {\n  try {\n    var ad = _IndexRequestData.targetIDToCreative[targetID].pop();\n    if (ad != null) {\n      doc.write(ad);\n    } else {\n      var url = utils.getTopWindowLocation().protocol === 'http:' ? 'http://as.casalemedia.com' : 'https://as-sec.casalemedia.com';\n      url += '/headerstats?type=RT&s=' + cygnus_index_args.siteID + '&u=' + encodeURIComponent(location.href) + '&r=' + _IndexRequestData.lastRequestID;\n      var px_call = new Image();\n      px_call.src = url + '&blank=' + targetID;\n    }\n  } catch (e) {}\n}\n\nwindow.headertag_render = function(doc, targetID, slotID) {\n  var index_slot = slotID;\n  var index_ary = targetID.split(',');\n  for (var i = 0; i < index_ary.length; i++) {\n    var unpack = index_ary[i].split('_');\n    if (unpack[0] == index_slot) {\n      index_render(doc, index_ary[i]);\n      return;\n    }\n  }\n}\n\nwindow.cygnus_index_args = {};\n\nvar cygnus_index_adunits = [[728, 90], [120, 600], [300, 250], [160, 600], [336, 280], [234, 60], [300, 600], [300, 50], [320, 50], [970, 250], [300, 1050], [970, 90], [180, 150]];\n\nvar getIndexDebugMode = function() {\n  return getParameterByName(CONSTANTS.INDEX_DEBUG_MODE.queryParam).toUpperCase();\n}\n\nvar getParameterByName = function (name) {\n  var wdw = window;\n  var childsReferrer = '';\n  for (var x = 0; x < CONSTANTS.INDEX_DEBUG_MODE.mode.sandbox.topFrameLimit; x++) {\n    if (wdw.parent == wdw) {\n      break;\n    }\n    try {\n      childsReferrer = wdw.document.referrer;\n    } catch (err) {}\n    wdw = wdw.parent;\n  }\n  var topURL = top === self ? location.href : childsReferrer;\n  var regexS = '[\\\\?&]' + name + '=([^&#]*)';\n  var regex = new RegExp(regexS);\n  var results = regex.exec(topURL);\n  if (results === null) {\n    return '';\n  }\n  return decodeURIComponent(results[1].replace(/\\+/g, ' '));\n};\n\nvar cygnus_index_start = function () {\n  window.cygnus_index_args.parseFn = cygnus_index_parse_res;\n  var escapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\n  var meta = {\n    '\\b': '\\\\b',\n    '\\t': '\\\\t',\n    '\\n': '\\\\n',\n    '\\f': '\\\\f',\n    '\\r': '\\\\r',\n    '\"': '\\\\\"',\n    '\\\\': '\\\\\\\\'\n  };\n\n  function escapeCharacter(character) {\n    var escaped = meta[character];\n    if (typeof escaped === 'string') {\n      return escaped;\n    } else {\n      return '\\\\u' + ('0000' + character.charCodeAt(0).toString(16)).slice(-4);\n    }\n  }\n\n  function quote(string) {\n    escapable.lastIndex = 0;\n    if (escapable.test(string)) {\n      return string.replace(escapable, escapeCharacter);\n    } else {\n      return string;\n    }\n  }\n\n  function OpenRTBRequest(siteID, parseFn, timeoutDelay) {\n    this.initialized = false;\n    if (typeof siteID !== 'number' || siteID % 1 !== 0 || siteID < 0) {\n      throw 'Invalid Site ID';\n    }\n\n    timeoutDelay = Number(timeoutDelay);\n    if (typeof timeoutDelay === 'number' && timeoutDelay % 1 === 0 && timeoutDelay >= 0) {\n      this.timeoutDelay = timeoutDelay;\n    }\n\n    this.siteID = siteID;\n    this.impressions = [];\n    this._parseFnName = undefined;\n\n    // Get page URL\n    this.sitePage = undefined;\n    try {\n      this.sitePage = utils.getTopWindowUrl();\n    } catch (e) {}\n    // Fallback to old logic if utils.getTopWindowUrl() fails to return site.page\n    if (typeof this.sitePage === 'undefined' || this.sitePage === '') {\n      if (top === self) {\n        this.sitePage = location.href;\n      } else {\n        this.sitePage = document.referrer;\n      }\n    }\n\n    if (top === self) {\n      this.topframe = 1;\n    } else {\n      this.topframe = 0;\n    }\n\n    if (typeof parseFn !== 'undefined') {\n      if (typeof parseFn === 'function') {\n        this._parseFnName = 'cygnus_index_args.parseFn';\n      } else {\n        throw 'Invalid jsonp target function';\n      }\n    }\n\n    if (typeof _IndexRequestData.requestCounter === 'undefined') {\n      _IndexRequestData.requestCounter = Math.floor(Math.random() * 256);\n    } else {\n      _IndexRequestData.requestCounter = (_IndexRequestData.requestCounter + 1) % 256;\n    }\n\n    this.requestID = String((new Date().getTime() % 2592000) * 256 + _IndexRequestData.requestCounter + 256);\n    this.initialized = true;\n  }\n\n  OpenRTBRequest.prototype.serialize = function () {\n    var json = '{\"id\":\"' + this.requestID + '\",\"site\":{\"page\":\"' + quote(this.sitePage) + '\"';\n    if (typeof document.referrer === 'string' && document.referrer !== '') {\n      json += ',\"ref\":\"' + quote(document.referrer) + '\"';\n    }\n\n    json += '},\"imp\":[';\n    for (var i = 0; i < this.impressions.length; i++) {\n      var impObj = this.impressions[i];\n      var ext = [];\n      json += '{\"id\":\"' + impObj.id + '\", \"banner\":{\"w\":' + impObj.w + ',\"h\":' + impObj.h + ',\"topframe\":' + String(this.topframe) + '}';\n      if (typeof impObj.bidfloor === 'number') {\n        json += ',\"bidfloor\":' + impObj.bidfloor;\n        if (typeof impObj.bidfloorcur === 'string') {\n          json += ',\"bidfloorcur\":\"' + quote(impObj.bidfloorcur) + '\"';\n        }\n      }\n\n      if (typeof impObj.slotID === 'string' && (!impObj.slotID.match(/^\\s*$/))) {\n        ext.push('\"sid\":\"' + quote(impObj.slotID) + '\"');\n      }\n\n      if (typeof impObj.siteID === 'number') {\n        ext.push('\"siteID\":' + impObj.siteID);\n      }\n\n      if (ext.length > 0) {\n        json += ',\"ext\": {' + ext.join() + '}';\n      }\n\n      if (i + 1 === this.impressions.length) {\n        json += '}';\n      } else {\n        json += '},';\n      }\n    }\n\n    json += ']}';\n    return json;\n  };\n\n  OpenRTBRequest.prototype.setPageOverride = function (sitePageOverride) {\n    if (typeof sitePageOverride === 'string' && (!sitePageOverride.match(/^\\s*$/))) {\n      this.sitePage = sitePageOverride;\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  OpenRTBRequest.prototype.addImpression = function (width, height, bidFloor, bidFloorCurrency, slotID, siteID) {\n    var impObj = {\n      id: String(this.impressions.length + 1)\n    };\n    if (typeof width !== 'number' || width <= 1) {\n      return null;\n    }\n\n    if (typeof height !== 'number' || height <= 1) {\n      return null;\n    }\n\n    if ((typeof slotID === 'string' || typeof slotID === 'number') && String(slotID).length <= 50) {\n      impObj.slotID = String(slotID);\n    }\n\n    impObj.w = width;\n    impObj.h = height;\n    if (bidFloor !== undefined && typeof bidFloor !== 'number') {\n      return null;\n    }\n\n    if (typeof bidFloor === 'number') {\n      if (bidFloor < 0) {\n        return null;\n      }\n\n      impObj.bidfloor = bidFloor;\n      if (bidFloorCurrency !== undefined && typeof bidFloorCurrency !== 'string') {\n        return null;\n      }\n\n      impObj.bidfloorcur = bidFloorCurrency;\n    }\n\n    if (typeof siteID !== 'undefined') {\n      if (typeof siteID === 'number' && siteID % 1 === 0 && siteID >= 0) {\n        impObj.siteID = siteID;\n      } else {\n        return null;\n      }\n    }\n\n    this.impressions.push(impObj);\n    return impObj.id;\n  };\n\n  OpenRTBRequest.prototype.buildRequest = function () {\n    if (this.impressions.length === 0 || this.initialized !== true) {\n      return;\n    }\n\n    var jsonURI = encodeURIComponent(this.serialize());\n\n    var scriptSrc;\n    if (getIndexDebugMode() == CONSTANTS.INDEX_DEBUG_MODE.mode.sandbox.queryValue.toUpperCase()) {\n      this.siteID = CONSTANTS.INDEX_DEBUG_MODE.mode.sandbox.siteID;\n      scriptSrc = utils.getTopWindowLocation().protocol === 'http:' ? 'http://sandbox.ht.indexexchange.com' : 'https://sandbox.ht.indexexchange.com';\n      utils.logMessage('IX DEBUG: Sandbox mode activated');\n    } else {\n      scriptSrc = utils.getTopWindowLocation().protocol === 'http:' ? 'http://as.casalemedia.com' : 'https://as-sec.casalemedia.com';\n    }\n    var prebidVersion = encodeURIComponent('0.34.1');\n    scriptSrc += '/cygnus?v=7&fn=cygnus_index_parse_res&s=' + this.siteID + '&r=' + jsonURI + '&pid=pb' + prebidVersion;\n    if (typeof this.timeoutDelay === 'number' && this.timeoutDelay % 1 === 0 && this.timeoutDelay >= 0) {\n      scriptSrc += '&t=' + this.timeoutDelay;\n    }\n\n    return scriptSrc;\n  };\n\n  try {\n    if (typeof cygnus_index_args === 'undefined' || typeof cygnus_index_args.siteID === 'undefined' || typeof cygnus_index_args.slots === 'undefined') {\n      return;\n    }\n\n    var req = new OpenRTBRequest(cygnus_index_args.siteID, cygnus_index_args.parseFn, cygnus_index_args.timeout);\n    if (cygnus_index_args.url && typeof cygnus_index_args.url === 'string') {\n      req.setPageOverride(cygnus_index_args.url);\n    }\n\n    _IndexRequestData.impIDToSlotID[req.requestID] = {};\n    _IndexRequestData.reqOptions[req.requestID] = {};\n    var slotDef, impID;\n\n    for (var i = 0; i < cygnus_index_args.slots.length; i++) {\n      slotDef = cygnus_index_args.slots[i];\n\n      impID = req.addImpression(slotDef.width, slotDef.height, slotDef.bidfloor, slotDef.bidfloorcur, slotDef.id, slotDef.siteID);\n      if (impID) {\n        _IndexRequestData.impIDToSlotID[req.requestID][impID] = String(slotDef.id);\n      }\n    }\n\n    if (typeof cygnus_index_args.targetMode === 'number') {\n      _IndexRequestData.reqOptions[req.requestID].targetMode = cygnus_index_args.targetMode;\n    }\n\n    if (typeof cygnus_index_args.callback === 'function') {\n      _IndexRequestData.reqOptions[req.requestID].callback = cygnus_index_args.callback;\n    }\n\n    return req.buildRequest();\n  } catch (e) {\n    utils.logError('Error calling index adapter', ADAPTER_NAME, e);\n  }\n};\n\nvar IndexExchangeAdapter = function IndexExchangeAdapter() {\n  let baseAdapter = new Adapter('indexExchange');\n\n  var slotIdMap = {};\n  var requiredParams = [\n    /* 0 */\n    'id',\n    /* 1 */\n    'siteID'\n  ];\n  var firstAdUnitCode = '';\n  let bidRequests = {};\n\n  function passOnBid(adUnitCode) {\n    var bid = bidfactory.createBid(2);\n    bid.bidderCode = ADAPTER_CODE;\n    bidmanager.addBidResponse(adUnitCode, bid);\n    return bid;\n  }\n\n  function _callBids(request) {\n    if (typeof request === 'undefined' || utils.isEmpty(request)) {\n      return;\n    }\n\n    var bidArr = request.bids;\n\n    if (typeof window._IndexRequestData === 'undefined') {\n      window._IndexRequestData = {};\n      window._IndexRequestData.impIDToSlotID = {};\n      window._IndexRequestData.reqOptions = {};\n    }\n    // clear custom targets at the beginning of every request\n    _IndexRequestData.targetAggregate = {'open': {}, 'private': {}};\n\n    // Our standard is to always bid for all known slots.\n    cygnus_index_args.slots = [];\n\n    var videoImpressions = [];\n\n    // Grab the slot level data for cygnus_index_args\n    bidArr.forEach(bid => {\n      if (bid.mediaType === 'video') {\n        var impression = buildVideoImpressions(bid, bidRequests);\n        if (typeof impression !== 'undefined') {\n          videoImpressions.push(impression);\n        }\n      } else {\n        cygnus_index_init(bid);\n      }\n    });\n\n    if (videoImpressions.length > 0) {\n      sendVideoRequest(request.bidderRequestId, videoImpressions);\n    }\n\n    if (cygnus_index_args.slots.length > 20) {\n      utils.logError('Too many unique sizes on slots, will use the first 20.', ADAPTER_NAME);\n    }\n\n    if (cygnus_index_args.slots.length > 0) {\n      // bidmanager.setExpectedBidsCount(ADAPTER_CODE, expectedBids);\n      adloader.loadScript(cygnus_index_start());\n    }\n\n    var responded = false;\n\n    // Handle response\n    window.cygnus_index_ready_state = function () {\n      if (responded) {\n        return;\n      }\n      responded = true;\n\n      try {\n        var indexObj = _IndexRequestData.targetIDToBid;\n\n        // Grab all the bids for each slot\n        for (var adSlotId in slotIdMap) {\n          var bidObj = slotIdMap[adSlotId];\n          var adUnitCode = bidObj.placementCode;\n\n          var bids = [];\n\n          // Grab the bid for current slot\n          for (var cpmAndSlotId in indexObj) {\n            var match = /^(T\\d_)?(.+)_(\\d+)$/.exec(cpmAndSlotId);\n            // if parse fail, move to next bid\n            if (!(match)) {\n              utils.logError('Unable to parse ' + cpmAndSlotId + ', skipping slot', ADAPTER_NAME);\n              continue;\n            }\n            var tier = match[1] || '';\n            var slotID = match[2];\n            var currentCPM = match[3];\n\n            var slotObj = getSlotObj(cygnus_index_args, tier + slotID);\n            // Bid is for the current slot\n            if (slotID === adSlotId) {\n              var bid = bidfactory.createBid(1);\n              bid.cpm = currentCPM / 100;\n              bid.ad = indexObj[cpmAndSlotId][0];\n              bid.bidderCode = ADAPTER_CODE;\n              bid.width = slotObj.width;\n              bid.height = slotObj.height;\n              bid.siteID = slotObj.siteID;\n              if (typeof _IndexRequestData.targetIDToResp === 'object' && typeof _IndexRequestData.targetIDToResp[cpmAndSlotId] === 'object' && typeof _IndexRequestData.targetIDToResp[cpmAndSlotId].dealID !== 'undefined') {\n                if (typeof _IndexRequestData.targetAggregate['private'][adUnitCode] === 'undefined') { _IndexRequestData.targetAggregate['private'][adUnitCode] = []; }\n                bid.dealId = _IndexRequestData.targetIDToResp[cpmAndSlotId].dealID;\n                _IndexRequestData.targetAggregate['private'][adUnitCode].push(slotID + '_' + _IndexRequestData.targetIDToResp[cpmAndSlotId].dealID);\n              } else {\n                if (typeof _IndexRequestData.targetAggregate['open'][adUnitCode] === 'undefined') { _IndexRequestData.targetAggregate['open'][adUnitCode] = []; }\n                _IndexRequestData.targetAggregate['open'][adUnitCode].push(slotID + '_' + currentCPM);\n              }\n              bids.push(bid);\n            }\n          }\n\n          if (bids.length > 0) {\n            // Add all bid responses\n            for (var i = 0; i < bids.length; i++) {\n              bidmanager.addBidResponse(adUnitCode, bids[i]);\n            }\n          // No bids for expected bid, pass bid\n          } else {\n            passOnBid(adUnitCode);\n          }\n        }\n      } catch (e) {\n        utils.logError('Error calling index adapter', ADAPTER_NAME, e);\n        logErrorBidResponse();\n      } finally {\n        // ensure that previous targeting mapping is cleared\n        _IndexRequestData.targetIDToBid = {};\n      }\n\n      // slotIdMap is used to determine which slots will be bid on in a given request.\n      // Therefore it needs to be blanked after the request is handled, else we will submit 'bids' for the wrong ads.\n      slotIdMap = {};\n    };\n  }\n\n  function cygnus_index_init(bid) {\n    if (!utils.hasValidBidRequest(bid.params, requiredParams, ADAPTER_NAME)) {\n      passOnBid(bid.placementCode);\n      return;\n    }\n\n    var sizeID = 0;\n\n    // Expecting nested arrays for sizes\n    if (!utils.isArray(bid.sizes[0])) {\n      bid.sizes = [bid.sizes];\n    }\n\n    // Create index slots for all bids and sizes\n    for (var j = 0; j < bid.sizes.length; j++) {\n      var validSize = false;\n      for (var k = 0; k < cygnus_index_adunits.length; k++) {\n        if (bid.sizes[j][0] == cygnus_index_adunits[k][0] &&\n            bid.sizes[j][1] == cygnus_index_adunits[k][1]) {\n          bid.sizes[j][0] = Number(bid.sizes[j][0]);\n          bid.sizes[j][1] = Number(bid.sizes[j][1]);\n          validSize = true;\n          break;\n        }\n      }\n\n      if (!validSize) {\n        utils.logMessage(ADAPTER_NAME + ' slot excluded from request due to no valid sizes');\n        passOnBid(bid.placementCode);\n        continue;\n      }\n\n      var usingSizeSpecificSiteID = false;\n      // Check for size defined in bidder params\n      if (bid.params.size && utils.isArray(bid.params.size)) {\n        if (!(bid.sizes[j][0] == bid.params.size[0] && bid.sizes[j][1] == bid.params.size[1])) {\n          passOnBid(bid.placementCode);\n          continue;\n        }\n        usingSizeSpecificSiteID = true;\n      }\n\n      if (bid.params.timeout && typeof cygnus_index_args.timeout === 'undefined') {\n        cygnus_index_args.timeout = bid.params.timeout;\n      }\n\n      var siteID = Number(bid.params.siteID);\n      if (typeof siteID !== 'number' || siteID % 1 != 0 || siteID <= 0) {\n        utils.logMessage(ADAPTER_NAME + ' slot excluded from request due to invalid siteID');\n        passOnBid(bid.placementCode);\n        continue;\n      }\n      if (siteID && typeof cygnus_index_args.siteID === 'undefined') {\n        cygnus_index_args.siteID = siteID;\n      }\n\n      if (utils.hasValidBidRequest(bid.params, requiredParams, ADAPTER_NAME)) {\n        firstAdUnitCode = bid.placementCode;\n        var slotID = bid.params[requiredParams[0]];\n        if (typeof slotID !== 'string' && typeof slotID !== 'number') {\n          utils.logError(ADAPTER_NAME + ' bid contains invalid slot ID from ' + bid.placementCode + '. Discarding slot');\n          passOnBid(bid.placementCode);\n          continue\n        }\n\n        sizeID++;\n        var size = {\n          width: bid.sizes[j][0],\n          height: bid.sizes[j][1]\n        };\n\n        var slotName = usingSizeSpecificSiteID ? String(slotID) : slotID + '_' + sizeID;\n        slotIdMap[slotName] = bid;\n\n        // Doesn't need the if(primary_request) conditional since we are using the mergeSlotInto function which is safe\n        cygnus_index_args.slots = mergeSlotInto({\n          id: slotName,\n          width: size.width,\n          height: size.height,\n          siteID: siteID || cygnus_index_args.siteID\n        }, cygnus_index_args.slots);\n\n        if (bid.params.tier2SiteID) {\n          var tier2SiteID = Number(bid.params.tier2SiteID);\n          if (typeof tier2SiteID !== 'undefined' && !tier2SiteID) {\n            continue;\n          }\n\n          cygnus_index_args.slots = mergeSlotInto({\n            id: 'T1_' + slotName,\n            width: size.width,\n            height: size.height,\n            siteID: tier2SiteID\n          }, cygnus_index_args.slots);\n        }\n\n        if (bid.params.tier3SiteID) {\n          var tier3SiteID = Number(bid.params.tier3SiteID);\n          if (typeof tier3SiteID !== 'undefined' && !tier3SiteID) {\n            continue;\n          }\n\n          cygnus_index_args.slots = mergeSlotInto({\n            id: 'T2_' + slotName,\n            width: size.width,\n            height: size.height,\n            siteID: tier3SiteID\n          }, cygnus_index_args.slots);\n        }\n      }\n    }\n  }\n\n  function sendVideoRequest(requestID, videoImpressions) {\n    let cygnusRequest = {\n      'id': requestID,\n      'imp': videoImpressions,\n      'site': {\n        'page': utils.getTopWindowUrl()\n      }\n    };\n\n    if (!utils.isEmpty(cygnusRequest.imp)) {\n      let cygnusRequestUrl = createCygnusRequest(cygnusRequest.imp[0].ext.siteID, cygnusRequest);\n\n      adloader.loadScript(cygnusRequestUrl);\n    }\n  }\n\n  function buildVideoImpressions(bid) {\n    if (!validateBid(bid)) {\n      return;\n    }\n\n    bid = transformBid(bid);\n\n    // map request id to bid object to retrieve adUnit code in callback\n    bidRequests[bid.bidId] = {};\n    bidRequests[bid.bidId].prebid = bid;\n\n    let cygnusImpression = {};\n    cygnusImpression.id = bid.bidId;\n\n    cygnusImpression.ext = {};\n    cygnusImpression.ext.siteID = bid.params.video.siteID;\n    delete bid.params.video.siteID;\n\n    let podType = bid.params.video.startdelay;\n    if (bid.params.video.startdelay === 0) {\n      podType = 'preroll';\n    } else if (typeof START_DELAY_MAP[bid.params.video.startdelay] === 'undefined') {\n      podType = 'midroll';\n    }\n    cygnusImpression.ext.sid = [SLOT_ID_PREFIX_MAP[podType], 1, 1, 's'].join('_');\n\n    cygnusImpression.video = {};\n\n    if (bid.params.video) {\n      Object.keys(bid.params.video)\n        .filter(param => typeof VIDEO_REQUIRED_PARAMS_MAP[param] !== 'undefined' || typeof VIDEO_OPTIONAL_PARAMS_MAP[param] !== 'undefined')\n        .forEach(param => {\n          if (param === 'startdelay' && typeof START_DELAY_MAP[bid.params.video[param]] !== 'undefined') {\n            bid.params.video[param] = START_DELAY_MAP[bid.params.video[param]];\n          }\n          if (param === 'linearity' && typeof LINEARITY_MAP[bid.params.video[param]] !== 'undefined') {\n            bid.params.video[param] = LINEARITY_MAP[bid.params.video[param]];\n          }\n          cygnusImpression.video[param] = bid.params.video[param];\n        });\n    } else {\n      return;\n    }\n\n    let bidSize = getSizes(bid.sizes).shift();\n    if (!bidSize || !bidSize.width || !bidSize.height) {\n      return;\n    }\n    cygnusImpression.video.w = bidSize.width;\n    cygnusImpression.video.h = bidSize.height;\n\n    bidRequests[bid.bidId].cygnus = cygnusImpression;\n\n    return cygnusImpression;\n  }\n\n  /*\n  Function in order to add a slot into the list if it hasn't been created yet, else it returns the same list.\n  */\n  function mergeSlotInto(slot, slotList) {\n    for (var i = 0; i < slotList.length; i++) {\n      if (slot.id === slotList[i].id) {\n        return slotList;\n      }\n    }\n    slotList.push(slot);\n    return slotList;\n  }\n\n  function getSlotObj(obj, id) {\n    var arr = obj.slots;\n    var returnObj = {};\n    utils._each(arr, function (value) {\n      if (value.id === id) {\n        returnObj = value;\n      }\n    });\n\n    return returnObj;\n  }\n\n  function logErrorBidResponse() {\n    // no bid response\n    var bid = bidfactory.createBid(2);\n    bid.bidderCode = ADAPTER_CODE;\n\n    // log error to first add unit\n    bidmanager.addBidResponse(firstAdUnitCode, bid);\n  }\n\n  function createCygnusRequest(siteID, cygnusRequest) {\n    let cygnusUrl = (window.location.protocol === 'https:') ? url.parse(BASE_CYGNUS_VIDEO_URL_SECURE) : url.parse(BASE_CYGNUS_VIDEO_URL_INSECURE);\n    cygnusUrl.search.s = siteID;\n    cygnusUrl.search.r = encodeURIComponent(JSON.stringify(cygnusRequest));\n    let formattedCygnusUrl = url.format(cygnusUrl);\n    return formattedCygnusUrl;\n  }\n\n  /* Notify Prebid of bid responses so bids can get in the auction */\n  pbjs.handleCygnusResponse = function (response) {\n    if (!response || !response.seatbid || utils.isEmpty(response.seatbid)) {\n      utils.logInfo('Cygnus returned no bids');\n\n      // signal this response is complete\n      Object.keys(bidRequests)\n        .forEach(bidId => {\n          let prebidRequest = bidRequests[bidId].prebid;\n          let bid = createBidObj(STATUS.NO_BID, prebidRequest);\n          utils.logInfo(JSON.stringify(bid));\n          bidmanager.addBidResponse(prebidRequest.placementCode, bid);\n        });\n\n      return;\n    }\n\n    response.seatbid\n      .forEach(seat => {\n        seat.bid.forEach(cygnusBid => {\n          let validBid = true;\n\n          if (typeof bidRequests[cygnusBid.impid] === 'undefined') {\n            utils.logInfo('Cygnus returned mismatched id');\n\n            // signal this response is complete\n            Object.keys(bidRequests)\n              .forEach(bidId => {\n                let prebidRequest = bidRequests[bidId].prebid;\n                let bid = createBidObj(STATUS.NO_BID, prebidRequest);\n                bidmanager.addBidResponse(prebidRequest.placementCode, bid);\n              });\n            return;\n          }\n\n          if (!cygnusBid.ext.vasturl) {\n            utils.logInfo('Cygnus returned no vast url');\n            validBid = false;\n          }\n\n          if (url.parse(cygnusBid.ext.vasturl).host === window.location.host) {\n            utils.logInfo('Cygnus returned no vast url');\n            validBid = false;\n          }\n\n          let cpm;\n          if (typeof cygnusBid.ext.pricelevel === 'string') {\n            let priceLevel = cygnusBid.ext.pricelevel;\n            if (priceLevel.charAt(0) === '_') priceLevel = priceLevel.slice(1);\n            cpm = priceLevel / 100;\n            if (!utils.isNumber(cpm) || isNaN(cpm)) {\n              utils.logInfo('Cygnus returned invalid price');\n              validBid = false;\n            }\n          } else {\n            validBid = false;\n          }\n\n          let prebidRequest = bidRequests[cygnusBid.impid].prebid;\n          let cygnusRequest = bidRequests[cygnusBid.impid].cygnus;\n\n          if (!validBid) {\n            let bid = createBidObj(STATUS.NO_BID, prebidRequest);\n            bidmanager.addBidResponse(prebidRequest.placementCode, bid);\n            return;\n          }\n\n          let bid = createBidObj(STATUS.GOOD, prebidRequest);\n          bid.cpm = cpm;\n          bid.width = cygnusRequest.video.w;\n          bid.height = cygnusRequest.video.h;\n          bid.vastUrl = cygnusBid.ext.vasturl;\n          bid.mediaType = 'video';\n\n          bidmanager.addBidResponse(prebidRequest.placementCode, bid);\n        });\n      });\n\n    bidRequests = {};\n  };\n\n  function createBidObj(status, request) {\n    let bid = bidfactory.createBid(status, request);\n    bid.code = baseAdapter.getBidderCode();\n    bid.bidderCode = baseAdapter.getBidderCode();\n\n    return bid;\n  }\n\n  /* Check that a bid has required paramters */\n  function validateBid(bid) {\n    if (\n      bid.mediaType === 'video' &&\n      utils.hasValidBidRequest(bid.params.video, Object.keys(VIDEO_REQUIRED_PARAMS_MAP), ADAPTER_NAME) &&\n      isValidSite(bid.params.video.siteID) &&\n      isValidPlayerType(bid.params.video.playerType) &&\n      isValidProtocolArray(bid.params.video.protocols) &&\n      isValidDuration(bid.params.video.maxduration) && bid.params.video.maxduration > 0\n    ) {\n      return bid;\n    }\n  }\n\n  function isValidSite(siteID) {\n    let intSiteID = +siteID;\n    if (isNaN(intSiteID) || !utils.isNumber(intSiteID) || intSiteID < 0 || utils.isArray(siteID)) {\n      utils.logError(`Site ID is invalid, must be a number > 0. Got: ${siteID}`);\n      return false;\n    }\n    return true;\n  }\n\n  function isValidPlayerType(playerType) {\n    if (typeof playerType === 'undefined' || !utils.isStr(playerType)) {\n      utils.logError(`Player type is invalid, must be one of: ${Object.keys(SUPPORTED_PLAYER_TYPES_MAP)}`);\n      return false;\n    }\n    playerType = playerType.toUpperCase();\n    if (!SUPPORTED_PLAYER_TYPES_MAP[playerType]) {\n      utils.logError(`Player type is invalid, must be one of: ${Object.keys(SUPPORTED_PLAYER_TYPES_MAP)}`);\n      return false;\n    }\n    return true;\n  }\n\n  function isValidProtocolArray(protocolArray) {\n    if (!utils.isArray(protocolArray) || utils.isEmpty(protocolArray)) {\n      utils.logError(`Protocol array is not an array. Got: ${protocolArray}`);\n      return false;\n    } else {\n      for (var i = 0; i < protocolArray.length; i++) {\n        let protocol = protocolArray[i];\n        if (!SUPPORTED_PROTOCOLS_MAP[protocol]) {\n          utils.logError(`Protocol array contains an invalid protocol, must be one of: ${SUPPORTED_PROTOCOLS_MAP}. Got: ${protocol}`);\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  function isValidDuration(duration) {\n    let intDuration = +duration;\n    if (isNaN(intDuration) || !utils.isNumber(intDuration) || utils.isArray(duration)) {\n      utils.logError(`Duration is invalid, must be a number. Got: ${duration}`);\n      return false;\n    }\n    return true;\n  }\n\n  function isValidMimeArray(mimeArray) {\n    if (!utils.isArray(mimeArray) || utils.isEmpty(mimeArray)) {\n      utils.logError(`MIMEs array is not an array. Got: ${mimeArray}`);\n      return false;\n    } else {\n      for (var i = 0; i < mimeArray.length; i++) {\n        let mimeType = mimeArray[i];\n        if (!utils.isStr(mimeType) || utils.isEmptyStr(mimeType) || !/^\\w+\\/[\\w-]+$/.test(mimeType)) {\n          utils.logError(`MIMEs array contains an invalid MIME type. Got: ${mimeType}`);\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  function isValidLinearity(linearity) {\n    if (!LINEARITY_MAP[linearity]) {\n      utils.logInfo(`Linearity is invalid, must be one of: ${Object.keys(LINEARITY_MAP)}. Got: ${linearity}`);\n      return false;\n    }\n    return true;\n  }\n\n  function isValidStartDelay(startdelay) {\n    if (typeof START_DELAY_MAP[startdelay] === 'undefined') {\n      let intStartdelay = +startdelay;\n      if (isNaN(intStartdelay) || !utils.isNumber(intStartdelay) || intStartdelay < -2 || utils.isArray(startdelay)) {\n        utils.logInfo(`Start delay is invalid, must be a number >= -2. Got: ${startdelay}`);\n        return false;\n      }\n    }\n    return true;\n  }\n\n  function isValidApiArray(apiArray, playerType) {\n    if (!utils.isArray(apiArray) || utils.isEmpty(apiArray)) {\n      utils.logInfo(`API array is not an array. Got: ${apiArray}`);\n      return false;\n    } else {\n      for (var i = 0; i < apiArray.length; i++) {\n        let api = +apiArray[i];\n        if (isNaN(api) || !SUPPORTED_API_MAP[playerType].includes(api)) {\n          utils.logInfo(`API array contains an invalid API version. Got: ${api}`);\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  function transformBid(bid) {\n    bid.params.video.siteID = +bid.params.video.siteID;\n    bid.params.video.maxduration = +bid.params.video.maxduration;\n\n    bid.params.video.protocols = bid.params.video.protocols.reduce((arr, protocol) => {\n      return arr.concat(SUPPORTED_PROTOCOLS_MAP[protocol]);\n    }, []);\n\n    let minduration = bid.params.video.minduration;\n    if (typeof minduration === 'undefined' || !isValidDuration(minduration)) {\n      utils.logInfo(`Using default value for 'minduration', default: ${VIDEO_OPTIONAL_PARAMS_MAP.minduration}`);\n      bid.params.video.minduration = VIDEO_OPTIONAL_PARAMS_MAP.minduration;\n    }\n\n    let startdelay = bid.params.video.startdelay;\n    if (typeof startdelay === 'undefined' || !isValidStartDelay(startdelay)) {\n      utils.logInfo(`Using default value for 'startdelay', default: ${VIDEO_OPTIONAL_PARAMS_MAP.startdelay}`);\n      bid.params.video.startdelay = VIDEO_OPTIONAL_PARAMS_MAP.startdelay;\n    }\n\n    let linearity = bid.params.video.linearity;\n    if (typeof linearity === 'undefined' || !isValidLinearity(linearity)) {\n      utils.logInfo(`Using default value for 'linearity', default: ${VIDEO_OPTIONAL_PARAMS_MAP.linearity}`);\n      bid.params.video.linearity = VIDEO_OPTIONAL_PARAMS_MAP.linearity;\n    }\n\n    let mimes = bid.params.video.mimes;\n    let playerType = bid.params.video.playerType.toUpperCase();\n    if (typeof mimes === 'undefined' || !isValidMimeArray(mimes)) {\n      utils.logInfo(`Using default value for 'mimes', player type: '${playerType}', default: ${DEFAULT_MIMES_MAP[playerType]}`);\n      bid.params.video.mimes = DEFAULT_MIMES_MAP[playerType];\n    }\n\n    let apiList = bid.params.video.apiList;\n    if (typeof apiList !== 'undefined' && !isValidApiArray(apiList, playerType)) {\n      utils.logInfo(`Removing invalid api versions from api list.`);\n      if (utils.isArray(apiList)) {\n        bid.params.video.apiList = apiList.filter(api => SUPPORTED_API_MAP[playerType].includes(api));\n      } else {\n        bid.params.video.apiList = [];\n      }\n    }\n\n    if (typeof apiList === 'undefined' && bid.params.video.allowVPAID && utils.isA(bid.params.video.allowVPAID, 'Boolean')) {\n      bid.params.video.mimes = bid.params.video.mimes.concat(DEFAULT_VPAID_MIMES_MAP[playerType]);\n      bid.params.video.apiList = SUPPORTED_API_MAP[playerType];\n    }\n\n    if (utils.isEmpty(bid.params.video.apiList)) {\n      utils.logInfo(`API list is empty, VPAID ads will not be requested.`);\n      delete bid.params.video.apiList;\n    }\n\n    delete bid.params.video.playerType;\n    delete bid.params.video.allowVPAID;\n\n    return bid;\n  }\n\n  /* Turn bid request sizes into ut-compatible format */\n  function getSizes(requestSizes) {\n    let sizes = [];\n    let sizeObj = {};\n\n    if (utils.isArray(requestSizes) && requestSizes.length === 2 && !utils.isArray(requestSizes[0])) {\n      if (!utils.isNumber(requestSizes[0]) || !utils.isNumber(requestSizes[1])) {\n        return sizes;\n      }\n      sizeObj.width = requestSizes[0];\n      sizeObj.height = requestSizes[1];\n      sizes.push(sizeObj);\n    } else if (typeof requestSizes === 'object') {\n      for (let i = 0; i < requestSizes.length; i++) {\n        let size = requestSizes[i];\n        sizeObj = {};\n        sizeObj.width = parseInt(size[0], 10);\n        sizeObj.height = parseInt(size[1], 10);\n        sizes.push(sizeObj);\n      }\n    }\n\n    return sizes;\n  }\n\n  return Object.assign(this, {\n    callBids: _callBids\n  });\n};\n\nadaptermanager.registerBidAdapter(new IndexExchangeAdapter(), 'indexExchange', {\n  supportedMediaTypes: ['video']\n});\n\nmodule.exports = IndexExchangeAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/indexExchangeBidAdapter.js"],"sourceRoot":""}