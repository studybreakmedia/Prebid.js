{"version":3,"sources":["webpack:///./modules/readpeakBidAdapter.js"],"names":["ENDPOINT","NATIVE_DEFAULTS","TITLE_LEN","DESCR_LEN","SPONSORED_BY_LEN","IMG_MIN","ICON_MIN","CTA_LEN","BIDDER_CODE","spec","code","supportedMediaTypes","isBidRequestValid","bid","params","publisherId","nativeParams","buildRequests","request","id","bidRequests","bidderRequestId","imp","map","impression","slot","filter","native","site","app","device","isPrebid","method","url","data","JSON","stringify","interpretResponse","response","bidResponseAvailable","bidRequest","bidResponse","idToImpMap","idToBidMap","body","parse","forEach","seatbid","seatBid","impid","bids","Object","keys","requestId","cpm","price","creativeId","crid","ttl","netRevenue","mediaType","currency","cur","nativeResponse","push","bidId","nativeImpression","bidfloor","bidfloorcur","assets","addAsset","titleAsset","title","imageAsset","image","dataAsset","sponsoredBy","cta","ver","asset","defaultLen","required","len","type","defaultMinWidth","defaultMinHeight","img","wmin","hmin","bidderRequest","pubId","length","appParams","publisher","toString","ref","referrer","page","href","domain","hostname","bundle","storeurl","storeUrl","window","top","document","e","ua","navigator","userAgent","language","browserLanguage","userLanguage","systemLanguage","rawResponse","ex","nativeAd","adm","text","value","link","clickUrl","encodeURIComponent","impressionTrackers","imptrackers"],"mappings":"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","file":"readpeakBidAdapter.js","sourcesContent":["import {logError, getTopWindowLocation} from 'src/utils';\nimport { registerBidder } from 'src/adapters/bidderFactory';\n\nexport const ENDPOINT = '//app.readpeak.com/header/prebid';\n\nconst NATIVE_DEFAULTS = {\n  TITLE_LEN: 70,\n  DESCR_LEN: 120,\n  SPONSORED_BY_LEN: 50,\n  IMG_MIN: 150,\n  ICON_MIN: 50,\n  CTA_LEN: 50,\n};\n\nconst BIDDER_CODE = 'readpeak'\n\nexport const spec = {\n\n  code: BIDDER_CODE,\n\n  supportedMediaTypes: ['native'],\n\n  isBidRequestValid: bid => (\n    !!(bid && bid.params && bid.params.publisherId && bid.nativeParams)\n  ),\n\n  buildRequests: bidRequests => {\n    const request = {\n      id: bidRequests[0].bidderRequestId,\n      imp: bidRequests.map(slot => impression(slot)).filter(imp => imp.native != null),\n      site: site(bidRequests),\n      app: app(bidRequests),\n      device: device(),\n      isPrebid: true,\n    }\n\n    return {\n      method: 'POST',\n      url: ENDPOINT,\n      data: JSON.stringify(request),\n    }\n  },\n\n  interpretResponse: (response, request) => (\n    bidResponseAvailable(request, response)\n  ),\n};\n\nfunction bidResponseAvailable(bidRequest, bidResponse) {\n  const idToImpMap = {};\n  const idToBidMap = {};\n  if (!bidResponse['body']) {\n    return []\n  }\n  bidResponse = bidResponse.body\n  parse(bidRequest.data).imp.forEach(imp => {\n    idToImpMap[imp.id] = imp;\n  });\n  if (bidResponse) {\n    bidResponse.seatbid.forEach(seatBid => seatBid.bid.forEach(bid => {\n      idToBidMap[bid.impid] = bid;\n    }));\n  }\n  const bids = [];\n  Object.keys(idToImpMap).forEach(id => {\n    if (idToBidMap[id]) {\n      const bid = {\n        requestId: id,\n        cpm: idToBidMap[id].price,\n        creativeId: idToBidMap[id].crid,\n        ttl: 300,\n        netRevenue: true,\n        mediaType: 'native',\n        currency: bidResponse.cur,\n        native: nativeResponse(idToImpMap[id], idToBidMap[id]),\n      };\n      bids.push(bid);\n    }\n  });\n  return bids;\n}\n\nfunction impression(slot) {\n  return {\n    id: slot.bidId,\n    native: nativeImpression(slot),\n    bidfloor: slot.params.bidfloor || 0,\n    bidfloorcur: slot.params.bidfloorcur || 'USD'\n  };\n}\n\nfunction nativeImpression(slot) {\n  if (slot.nativeParams) {\n    const assets = [];\n    addAsset(assets, titleAsset(1, slot.nativeParams.title, NATIVE_DEFAULTS.TITLE_LEN));\n    addAsset(assets, imageAsset(2, slot.nativeParams.image, 3, NATIVE_DEFAULTS.IMG_MIN, NATIVE_DEFAULTS.IMG_MIN));\n    addAsset(assets, dataAsset(3, slot.nativeParams.sponsoredBy, 1, NATIVE_DEFAULTS.SPONSORED_BY_LEN));\n    addAsset(assets, dataAsset(4, slot.nativeParams.body, 2, NATIVE_DEFAULTS.DESCR_LEN));\n    addAsset(assets, dataAsset(5, slot.nativeParams.cta, 12, NATIVE_DEFAULTS.CTA_LEN));\n    return {\n      request: JSON.stringify({ assets }),\n      ver: '1.1',\n    };\n  }\n  return null;\n}\n\nfunction addAsset(assets, asset) {\n  if (asset) {\n    assets.push(asset);\n  }\n}\n\nfunction titleAsset(id, params, defaultLen) {\n  if (params) {\n    return {\n      id,\n      required: params.required ? 1 : 0,\n      title: {\n        len: params.len || defaultLen,\n      },\n    };\n  }\n  return null;\n}\n\nfunction imageAsset(id, params, type, defaultMinWidth, defaultMinHeight) {\n  return params ? {\n    id,\n    required: params.required ? 1 : 0,\n    img: {\n      type,\n      wmin: params.wmin || defaultMinWidth,\n      hmin: params.hmin || defaultMinHeight,\n    }\n  } : null;\n}\n\nfunction dataAsset(id, params, type, defaultLen) {\n  return params ? {\n    id,\n    required: params.required ? 1 : 0,\n    data: {\n      type,\n      len: params.len || defaultLen,\n    }\n  } : null;\n}\n\nfunction site(bidderRequest) {\n  const pubId = bidderRequest && bidderRequest.length > 0 ? bidderRequest[0].params.publisherId : '0';\n  const appParams = bidderRequest[0].params.app;\n  if (!appParams) {\n    return {\n      publisher: {\n        id: pubId.toString(),\n      },\n      id: pubId.toString(),\n      ref: referrer(),\n      page: getTopWindowLocation().href,\n      domain: getTopWindowLocation().hostname\n    }\n  }\n  return null;\n}\n\nfunction app(bidderRequest) {\n  const pubId = bidderRequest && bidderRequest.length > 0 ? bidderRequest[0].params.publisherId : '0';\n  const appParams = bidderRequest[0].params.app;\n  if (appParams) {\n    return {\n      publisher: {\n        id: pubId.toString(),\n      },\n      bundle: appParams.bundle,\n      storeurl: appParams.storeUrl,\n      domain: appParams.domain,\n    }\n  }\n  return null;\n}\n\nfunction referrer() {\n  try {\n    return window.top.document.referrer;\n  } catch (e) {\n    return document.referrer;\n  }\n}\n\nfunction device() {\n  return {\n    ua: navigator.userAgent,\n    language: (navigator.language || navigator.browserLanguage || navigator.userLanguage || navigator.systemLanguage),\n  };\n}\n\nfunction parse(rawResponse) {\n  try {\n    if (rawResponse) {\n      if (typeof rawResponse === 'object') {\n        return rawResponse\n      } else {\n        return JSON.parse(rawResponse);\n      }\n    }\n  } catch (ex) {\n    logError('readpeakBidAdapter.safeParse', 'ERROR', ex);\n  }\n  return null;\n}\n\nfunction nativeResponse(imp, bid) {\n  if (imp && imp['native']) {\n    const nativeAd = parse(bid.adm);\n    const keys = {};\n    if (nativeAd && nativeAd.assets) {\n      nativeAd.assets.forEach(asset => {\n        keys.title = asset.title ? asset.title.text : keys.title;\n        keys.body = asset.data && asset.id === 4 ? asset.data.value : keys.body;\n        keys.sponsoredBy = asset.data && asset.id === 3 ? asset.data.value : keys.sponsoredBy;\n        keys.image = asset.img && asset.id === 2 ? asset.img.url : keys.image;\n        keys.cta = asset.data && asset.id === 5 ? asset.data.value : keys.cta;\n      });\n      if (nativeAd.link) {\n        keys.clickUrl = encodeURIComponent(nativeAd.link.url);\n      }\n      keys.impressionTrackers = nativeAd.imptrackers;\n      return keys;\n    }\n  }\n  return null;\n}\n\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/readpeakBidAdapter.js"],"sourceRoot":""}