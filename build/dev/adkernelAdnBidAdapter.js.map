{"version":3,"sources":["webpack:///./modules/adkernelAdnBidAdapter.js"],"names":["utils","DEFAULT_ADKERNEL_DSP_DOMAIN","VIDEO_TARGETING","DEFAULT_MIMES","DEFAULT_PROTOCOLS","DEFAULT_APIS","isRtbDebugEnabled","getTopWindowLocation","href","indexOf","buildImp","bidRequest","sizes","imp","id","bidId","tagid","placementCode","mediaType","deepAccess","video","w","h","mimes","protocols","api","params","Object","keys","filter","includes","param","forEach","banner","format","parseSizesInput","buildRequestParams","auctionId","transactionId","tags","loc","tid","site","page","ref","getTopWindowReferrer","secure","protocol","buildBid","tag","bid","requestId","impid","bidderCode","spec","code","cpm","width","height","creativeId","crid","currency","ttl","netRevenue","ad","vast_url","vastUrl","supportedMediaTypes","isBidRequestValid","host","pubId","buildRequests","bidRequests","dispatch","map","reduce","acc","curr","index","push","bidderRequestId","requests","request","method","url","data","JSON","stringify","interpretResponse","serverResponse","response","body","debug","logInfo","getUserSyncs","syncOptions","serverResponses","iframeEnabled","length","rps","rsp","syncpages","a","b","concat","type","sync_url"],"mappings":"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","file":"adkernelAdnBidAdapter.js","sourcesContent":["import * as utils from 'src/utils';\nimport {registerBidder} from 'src/adapters/bidderFactory';\nimport { BANNER, VIDEO } from 'src/mediaTypes';\n\nconst DEFAULT_ADKERNEL_DSP_DOMAIN = 'tag.adkernel.com';\nconst VIDEO_TARGETING = ['mimes', 'protocols', 'api'];\nconst DEFAULT_MIMES = ['video/mp4', 'video/webm', 'application/x-shockwave-flash', 'application/javascript'];\nconst DEFAULT_PROTOCOLS = [2, 3, 5, 6];\nconst DEFAULT_APIS = [1, 2];\n\nfunction isRtbDebugEnabled() {\n  return utils.getTopWindowLocation().href.indexOf('adk_debug=true') !== -1;\n}\n\nfunction buildImp(bidRequest) {\n  const sizes = bidRequest.sizes;\n  let imp = {\n    id: bidRequest.bidId,\n    tagid: bidRequest.placementCode\n  };\n  if (bidRequest.mediaType === 'video' || utils.deepAccess(bidRequest, 'mediaTypes.video')) {\n    imp.video = {\n      w: sizes[0],\n      h: sizes[1],\n      mimes: DEFAULT_MIMES,\n      protocols: DEFAULT_PROTOCOLS,\n      api: DEFAULT_APIS\n    };\n    if (bidRequest.params.video) {\n      Object.keys(bidRequest.params.video)\n        .filter(param => VIDEO_TARGETING.includes(param))\n        .forEach(param => imp.video[param] = bidRequest.params.video[param]);\n    }\n  } else {\n    imp.banner = {\n      format: utils.parseSizesInput(bidRequest.sizes)\n    };\n  }\n  return imp;\n}\n\nfunction buildRequestParams(auctionId, transactionId, tags) {\n  let loc = utils.getTopWindowLocation();\n  return {\n    id: auctionId,\n    tid: transactionId,\n    site: {\n      page: loc.href,\n      ref: utils.getTopWindowReferrer(),\n      secure: ~~(loc.protocol === 'https:')\n    },\n    imp: tags\n  };\n}\n\nfunction buildBid(tag) {\n  let bid = {\n    requestId: tag.impid,\n    bidderCode: spec.code,\n    cpm: tag.bid,\n    width: tag.w,\n    height: tag.h,\n    creativeId: tag.crid,\n    currency: 'USD',\n    ttl: 720,\n    netRevenue: true\n  };\n  if (tag.tag) {\n    bid.ad = `<!DOCTYPE html><html><head><title></title><body style='margin:0px;padding:0px;'>${tag.tag}</body></head>`;\n    bid.mediaType = BANNER;\n  } else if (tag.vast_url) {\n    bid.vastUrl = tag.vast_url;\n    bid.mediaType = VIDEO;\n  }\n  return bid;\n}\n\nexport const spec = {\n\n  code: 'adkernelAdn',\n\n  supportedMediaTypes: [VIDEO],\n\n  isBidRequestValid: function(bidRequest) {\n    return 'params' in bidRequest && (typeof bidRequest.params.host === 'undefined' || typeof bidRequest.params.host === 'string') &&\n      typeof bidRequest.params.pubId === 'number';\n  },\n\n  buildRequests: function(bidRequests) {\n    let transactionId;\n    let auctionId;\n    let dispatch = bidRequests.map(buildImp)\n      .reduce((acc, curr, index) => {\n        let bidRequest = bidRequests[index];\n        let pubId = bidRequest.params.pubId;\n        let host = bidRequest.params.host || DEFAULT_ADKERNEL_DSP_DOMAIN;\n        acc[host] = acc[host] || {};\n        acc[host][pubId] = acc[host][pubId] || [];\n        acc[host][pubId].push(curr);\n        transactionId = bidRequest.transactionId;\n        auctionId = bidRequest.bidderRequestId;\n        return acc;\n      }, {});\n    let requests = [];\n    Object.keys(dispatch).forEach(host => {\n      Object.keys(dispatch[host]).forEach(pubId => {\n        let request = buildRequestParams(auctionId, transactionId, dispatch[host][pubId]);\n        requests.push({\n          method: 'POST',\n          url: `//${host}/tag?account=${pubId}&pb=1${isRtbDebugEnabled() ? '&debug=1' : ''}`,\n          data: JSON.stringify(request)\n        })\n      });\n    });\n    return requests;\n  },\n\n  interpretResponse: function(serverResponse) {\n    let response = serverResponse.body;\n    if (!response.tags) {\n      return [];\n    }\n    if (response.debug) {\n      utils.logInfo(`ADKERNEL DEBUG:\\n${response.debug}`);\n    }\n    return response.tags.map(buildBid);\n  },\n\n  getUserSyncs: function(syncOptions, serverResponses) {\n    if (!syncOptions.iframeEnabled || !serverResponses || serverResponses.length === 0) {\n      return [];\n    }\n    return serverResponses.filter(rps => 'syncpages' in rps.body)\n      .map(rsp => rsp.body.syncpages)\n      .reduce((a, b) => a.concat(b), [])\n      .map(sync_url => {\n        return {\n          type: 'iframe',\n          url: sync_url\n        }\n      });\n  }\n};\n\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/adkernelAdnBidAdapter.js"],"sourceRoot":""}