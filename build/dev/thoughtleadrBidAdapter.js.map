{"version":3,"sources":["webpack:///./modules/thoughtleadrBidAdapter.js"],"names":["bidfactory","require","bidmanager","utils","ajax_1","adaptermanager","COOKIE_SYNC_ID","UID_KEY","URL_API","window","tldr","config","root_url","URL_CDN","cdn_url","BID_AVAILABLE","BID_UNAVAILABLE","storageAvailable","type","storage","x","setItem","removeItem","e","DOMException","code","name","length","getVal","key","localStorage","sessionStorage","setVal","val","getUid","uid","generateUUID","writeFriendlyFrame","html","container","iframe","document","createElement","style","width","height","border","src","appendChild","doc","contentWindow","body","innerHTML","scripts","getElementsByTagName","i","scriptEl","item","nodeName","executeScript","newEl","innerText","text","textContent","attrs","attributes","setAttribute","value","parentNode","replaceChild","ThoughtleadrAdapter","prototype","callBids","params","bids","filter","bid","valid","_i","bids_1","requestPlacement","_this","size","getSizes","sizes","ajax","placementId","response","wonBid","JSON","parse","cookie_syncs","syncCookies","script","header_bid_token","bidObject","amount","createBid","bidderCode","cpm","ad","outerHTML","addBidResponse","placementCode","tags","getElementById","id","tags_1","tag","first","Array","isArray","registerBidAdapter","module","exports"],"mappings":"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","file":"thoughtleadrBidAdapter.js","sourcesContent":["const bidfactory = require('src/bidfactory');\nconst bidmanager = require('src/bidmanager');\nconst utils = require('src/utils');\nconst ajax_1 = require('src/ajax');\nconst adaptermanager = require('src/adaptermanager');\n\nconst COOKIE_SYNC_ID = 'tldr-cookie-sync-div';\nconst UID_KEY = 'tldr_uid';\nconst URL_API = 'tldr' in window && tldr.config.root_url ? tldr.config.root_url : '//a.thoughtleadr.com/v4/';\nconst URL_CDN = 'tldr' in window && tldr.config.cdn_url ? tldr.config.cdn_url : '//cdn.thoughtleadr.com/v4/';\nconst BID_AVAILABLE = 1;\nconst BID_UNAVAILABLE = 2;\n\nfunction storageAvailable(type) {\n  try {\n    const storage = window[type];\n    const x = '__storage_test__';\n    storage.setItem(x, x);\n    storage.removeItem(x);\n    return true;\n  } catch (e) {\n    return e instanceof DOMException && (\n      // everything except Firefox\n      e.code === 22 ||\n      // Firefox\n      e.code === 1014 ||\n      // test name field too, because code might not be present\n      // everything except Firefox\n      e.name === 'QuotaExceededError' ||\n      // Firefox\n      e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&\n      // acknowledge QuotaExceededError only if there's something already stored\n      storage.length !== 0;\n  }\n}\n\nfunction getVal(key) {\n  if (storageAvailable('localStorage')) {\n    return localStorage[key];\n  }\n  if (storageAvailable('sessionStorage')) {\n    return sessionStorage[key];\n  }\n  return null;\n}\n\nfunction setVal(key, val) {\n  if (storageAvailable('localStorage')) {\n    localStorage[key] = val;\n  }\n  if (storageAvailable('sessionStorage')) {\n    sessionStorage[key] = val;\n  }\n}\n\nfunction getUid() {\n  let uid = getVal(UID_KEY);\n  if (!uid) {\n    uid = utils.generateUUID(null);\n    setVal(UID_KEY, uid);\n  }\n  return uid;\n}\n\nfunction writeFriendlyFrame(html, container) {\n  const iframe = document.createElement('iframe');\n  iframe.style.width = '0';\n  iframe.style.height = '0';\n  iframe.style.border = '0';\n\n  iframe.src = 'javascript:false';\n  container.appendChild(iframe);\n\n  const doc = iframe.contentWindow.document;\n  doc.body.innerHTML = html;\n\n  const scripts = doc.body.getElementsByTagName('script');\n\n  for (let i = 0; i < scripts.length; i++) {\n    const scriptEl = scripts.item(i);\n    if (scriptEl.nodeName === 'SCRIPT') {\n      executeScript(scriptEl);\n    }\n  }\n\n  return iframe;\n}\n\nfunction executeScript(scriptEl) {\n  const newEl = document.createElement('script');\n  newEl.innerText = scriptEl.text || scriptEl.textContent || scriptEl.innerHTML || '';\n\n  // ie-compatible copy-paste attributes\n  const attrs = scriptEl.attributes;\n  for (let i = attrs.length; i--;) {\n    newEl.setAttribute(attrs[i].name, attrs[i].value);\n  }\n\n  if (scriptEl.parentNode) {\n    scriptEl.parentNode.replaceChild(newEl, scriptEl);\n  }\n}\n\nconst ThoughtleadrAdapter = (function () {\n  function ThoughtleadrAdapter() {\n  }\n\n  ThoughtleadrAdapter.prototype.callBids = function (params) {\n    const bids = (params.bids || []).filter(function (bid) {\n      return ThoughtleadrAdapter.valid(bid);\n    });\n\n    for (let _i = 0, bids_1 = bids; _i < bids_1.length; _i++) {\n      const bid = bids_1[_i];\n      this.requestPlacement(bid);\n    }\n  };\n\n  ThoughtleadrAdapter.prototype.requestPlacement = function (bid) {\n    const _this = this;\n    const uid = getUid();\n    const size = ThoughtleadrAdapter.getSizes(bid.sizes);\n\n    ajax_1.ajax('' + URL_API + bid.params.placementId + '/header-bid.json?uid=' + uid, function (response) {\n      const wonBid = JSON.parse(response);\n      if (wonBid.cookie_syncs) {\n        _this.syncCookies(wonBid.cookie_syncs);\n      }\n\n      const script = document.createElement('script');\n      script.src = URL_CDN + 'bid.js';\n      script.setAttribute('header-bid-token', wonBid.header_bid_token);\n\n      let bidObject;\n      if (wonBid && wonBid.amount) {\n        bidObject = bidfactory.createBid(BID_AVAILABLE);\n        bidObject.bidderCode = 'thoughtleadr';\n        bidObject.cpm = wonBid.amount;\n        bidObject.ad = script.outerHTML;\n        bidObject.width = size.width;\n        bidObject.height = size.height;\n      } else {\n        bidObject = bidfactory.createBid(BID_UNAVAILABLE);\n        bidObject.bidderCode = 'thoughtleadr';\n      }\n      bidmanager.addBidResponse(bid.placementCode, bidObject);\n    }, null);\n  };\n\n  ThoughtleadrAdapter.prototype.syncCookies = function (tags) {\n    if (!tags || !tags.length) {\n      return;\n    }\n\n    let container = document.getElementById(COOKIE_SYNC_ID);\n    if (!container) {\n      container = document.createElement('div');\n      container.id = COOKIE_SYNC_ID;\n      container.style.width = '0';\n      container.style.height = '0';\n      document.body.appendChild(container);\n    }\n\n    for (let _i = 0, tags_1 = tags; _i < tags_1.length; _i++) {\n      const tag = tags_1[_i];\n      writeFriendlyFrame(tag, container);\n    }\n  };\n\n  ThoughtleadrAdapter.valid = function (bid) {\n    return !!(bid && bid.params && typeof bid.params.placementId === 'string');\n  };\n\n  ThoughtleadrAdapter.getSizes = function (sizes) {\n    const first = sizes[0];\n    if (Array.isArray(first)) {\n      return ThoughtleadrAdapter.getSizes(first);\n    }\n\n    return {\n      width: sizes[0],\n      height: sizes[1]\n    };\n  };\n\n  return ThoughtleadrAdapter;\n}());\n\nadaptermanager.registerBidAdapter(new ThoughtleadrAdapter(), 'thoughtleadr');\n\nmodule.exports = ThoughtleadrAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/thoughtleadrBidAdapter.js"],"sourceRoot":""}