{"version":3,"sources":["webpack:///./modules/appnexusAstBidAdapter.js"],"names":["utils","BIDDER_CODE","URL","VIDEO_TARGETING","USER_PARAMS","NATIVE_MAPPING","body","cta","image","serverName","requiredParams","required","minimumParams","sizes","icon","sponsoredBy","SOURCE","spec","code","supportedMediaTypes","isBidRequestValid","bid","params","placementId","member","invCode","buildRequests","bidRequests","bidderRequest","tags","map","bidToTag","userObjBid","find","hasUserInfo","userObj","Object","keys","user","filter","includes","param","forEach","memberIdBid","hasMemberId","parseInt","payload","sdk","source","version","member_id","payloadString","JSON","stringify","method","url","data","interpretResponse","serverResponse","bids","error","errorMessage","bidderCode","logError","rtbBid","getRtbBid","serverBid","cpm","ad_type","newBid","mediaType","parseMediaType","push","getUserSyncs","syncOptions","iframeEnabled","type","newRenderer","adUnitCode","renderer","install","id","renderer_id","renderer_url","config","adText","loaded","setRender","outstreamRender","err","logWarn","setEventHandlers","impression","logMessage","ended","document","querySelector","style","display","getKeywords","keywords","arrs","_each","v","k","isArray","values","val","getValueString","isStr","key","value","requestId","uuid","creativeId","creative_id","dealId","deal_id","currency","netRevenue","ttl","rtb","video","width","player_width","height","player_height","vastUrl","asset_url","adResponse","ad","ads","nativeAd","title","desc","ctatext","sponsored","main_img","clickUrl","link","clickTrackers","click_trackers","impressionTrackers","impression_trackers","banner","content","trackers","impression_urls","tracker","createTrackPixelHtml","tag","transformSizes","primary_size","ad_types","bidId","allow_smaller_sizes","allowSmallerSizes","use_pmt_rule","usePaymentRule","prebid","disable_psa","reserve","position","trafficSourceCode","traffic_source_code","privateSizes","private_sizes","getSizes","supplyType","supply_type","pubClick","pubclick","extInvCode","ext_inv_code","externalImpId","external_imp_id","isEmpty","deepAccess","nativeParams","nativeRequest","buildNativeRequest","layouts","videoMediaType","context","require_asset_url","mediaTypes","requestSizes","sizeObj","length","i","size","request","requestKey","adunitKeys","requiredKeys","remaining","window","ANOutstreamVideo","renderAd","tagId","tag_id","getSize","split","targetId","rendererOptions","getConfig","handleOutstreamRendererEvents","bind","eventName","handleVideoEvent","adType"],"mappings":"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","file":"appnexusAstBidAdapter.js","sourcesContent":["import { Renderer } from 'src/Renderer';\nimport * as utils from 'src/utils';\nimport { registerBidder } from 'src/adapters/bidderFactory';\nimport { BANNER, NATIVE, VIDEO } from 'src/mediaTypes';\n\nconst BIDDER_CODE = 'appnexusAst';\nconst URL = '//ib.adnxs.com/ut/v3/prebid';\nconst VIDEO_TARGETING = ['id', 'mimes', 'minduration', 'maxduration',\n  'startdelay', 'skippable', 'playback_method', 'frameworks'];\nconst USER_PARAMS = ['age', 'external_uid', 'segments', 'gender', 'dnt', 'language'];\nconst NATIVE_MAPPING = {\n  body: 'description',\n  cta: 'ctatext',\n  image: {\n    serverName: 'main_image',\n    requiredParams: { required: true },\n    minimumParams: { sizes: [{}] },\n  },\n  icon: {\n    serverName: 'icon',\n    requiredParams: { required: true },\n    minimumParams: { sizes: [{}] },\n  },\n  sponsoredBy: 'sponsored_by',\n};\nconst SOURCE = 'pbjs';\n\nexport const spec = {\n  code: BIDDER_CODE,\n  supportedMediaTypes: [BANNER, VIDEO, NATIVE],\n\n  /**\n   * Determines whether or not the given bid request is valid.\n   *\n   * @param {object} bid The bid to validate.\n   * @return boolean True if this is a valid bid, and false otherwise.\n   */\n  isBidRequestValid: function(bid) {\n    return !!(bid.params.placementId || (bid.params.member && bid.params.invCode));\n  },\n\n  /**\n   * Make a server request from the list of BidRequests.\n   *\n   * @param {BidRequest[]} bidRequests A non-empty list of bid requests which should be sent to the Server.\n   * @return ServerRequest Info describing the request to the server.\n   */\n  buildRequests: function(bidRequests, bidderRequest) {\n    const tags = bidRequests.map(bidToTag);\n    const userObjBid = bidRequests.find(hasUserInfo);\n    let userObj;\n    if (userObjBid) {\n      userObj = {};\n      Object.keys(userObjBid.params.user)\n        .filter(param => USER_PARAMS.includes(param))\n        .forEach(param => userObj[param] = userObjBid.params.user[param]);\n    }\n\n    const memberIdBid = bidRequests.find(hasMemberId);\n    const member = memberIdBid ? parseInt(memberIdBid.params.member, 10) : 0;\n\n    const payload = {\n      tags: [...tags],\n      user: userObj,\n      sdk: {\n        source: SOURCE,\n        version: '0.34.1'\n      }\n    };\n    if (member > 0) {\n      payload.member_id = member;\n    }\n    const payloadString = JSON.stringify(payload);\n    return {\n      method: 'POST',\n      url: URL,\n      data: payloadString,\n      bidderRequest\n    };\n  },\n\n  /**\n   * Unpack the response from the server into a list of bids.\n   *\n   * @param {*} serverResponse A successful response from the server.\n   * @return {Bid[]} An array of bids which were nested inside the server.\n   */\n  interpretResponse: function(serverResponse, {bidderRequest}) {\n    serverResponse = serverResponse.body;\n    const bids = [];\n    if (!serverResponse || serverResponse.error) {\n      let errorMessage = `in response for ${bidderRequest.bidderCode} adapter`;\n      if (serverResponse && serverResponse.error) { errorMessage += `: ${serverResponse.error}`; }\n      utils.logError(errorMessage);\n      return bids;\n    }\n\n    if (serverResponse.tags) {\n      serverResponse.tags.forEach(serverBid => {\n        const rtbBid = getRtbBid(serverBid);\n        if (rtbBid) {\n          if (rtbBid.cpm !== 0 && this.supportedMediaTypes.includes(rtbBid.ad_type)) {\n            const bid = newBid(serverBid, rtbBid);\n            bid.mediaType = parseMediaType(rtbBid);\n            bids.push(bid);\n          }\n        }\n      });\n    }\n    return bids;\n  },\n\n  getUserSyncs: function(syncOptions) {\n    if (syncOptions.iframeEnabled) {\n      return [{\n        type: 'iframe',\n        url: '//acdn.adnxs.com/ib/static/usersync/v3/async_usersync.html'\n      }];\n    }\n  }\n}\n\nfunction newRenderer(adUnitCode, rtbBid) {\n  const renderer = Renderer.install({\n    id: rtbBid.renderer_id,\n    url: rtbBid.renderer_url,\n    config: { adText: `AppNexus Outstream Video Ad via Prebid.js` },\n    loaded: false,\n  });\n\n  try {\n    renderer.setRender(outstreamRender);\n  } catch (err) {\n    utils.logWarn('Prebid Error calling setRender on renderer', err);\n  }\n\n  renderer.setEventHandlers({\n    impression: () => utils.logMessage('AppNexus outstream video impression event'),\n    loaded: () => utils.logMessage('AppNexus outstream video loaded event'),\n    ended: () => {\n      utils.logMessage('AppNexus outstream renderer video event');\n      document.querySelector(`#${adUnitCode}`).style.display = 'none';\n    }\n  });\n  return renderer;\n}\n\n/* Turn keywords parameter into ut-compatible format */\nfunction getKeywords(keywords) {\n  let arrs = [];\n\n  utils._each(keywords, (v, k) => {\n    if (utils.isArray(v)) {\n      let values = [];\n      utils._each(v, (val) => {\n        val = utils.getValueString('keywords.' + k, val);\n        if (val) { values.push(val); }\n      });\n      v = values;\n    } else {\n      v = utils.getValueString('keywords.' + k, v);\n      if (utils.isStr(v)) {\n        v = [v];\n      } else {\n        return;\n      } // unsuported types - don't send a key\n    }\n    arrs.push({key: k, value: v});\n  });\n\n  return arrs;\n}\n\n/**\n * Unpack the Server's Bid into a Prebid-compatible one.\n * @param serverBid\n * @param rtbBid\n * @return Bid\n */\nfunction newBid(serverBid, rtbBid) {\n  const bid = {\n    requestId: serverBid.uuid,\n    cpm: rtbBid.cpm,\n    creativeId: rtbBid.creative_id,\n    dealId: rtbBid.deal_id,\n    currency: 'USD',\n    netRevenue: true,\n    ttl: 300\n  };\n\n  if (rtbBid.rtb.video) {\n    Object.assign(bid, {\n      width: rtbBid.rtb.video.player_width,\n      height: rtbBid.rtb.video.player_height,\n      vastUrl: rtbBid.rtb.video.asset_url,\n      ttl: 3600\n    });\n    // This supports Outstream Video\n    if (rtbBid.renderer_url) {\n      Object.assign(bid, {\n        adResponse: serverBid,\n        renderer: newRenderer(bid.adUnitCode, rtbBid)\n      });\n      bid.adResponse.ad = bid.adResponse.ads[0];\n      bid.adResponse.ad.video = bid.adResponse.ad.rtb.video;\n    }\n  } else if (rtbBid.rtb[NATIVE]) {\n    const nativeAd = rtbBid.rtb[NATIVE];\n    bid[NATIVE] = {\n      title: nativeAd.title,\n      body: nativeAd.desc,\n      cta: nativeAd.ctatext,\n      sponsoredBy: nativeAd.sponsored,\n      image: {\n        url: nativeAd.main_img && nativeAd.main_img.url,\n        height: nativeAd.main_img && nativeAd.main_img.height,\n        width: nativeAd.main_img && nativeAd.main_img.width,\n      },\n      icon: {\n        url: nativeAd.icon && nativeAd.icon.url,\n        height: nativeAd.icon && nativeAd.icon.height,\n        width: nativeAd.icon && nativeAd.icon.width,\n      },\n      clickUrl: nativeAd.link.url,\n      clickTrackers: nativeAd.link.click_trackers,\n      impressionTrackers: nativeAd.impression_trackers,\n    };\n  } else {\n    Object.assign(bid, {\n      width: rtbBid.rtb.banner.width,\n      height: rtbBid.rtb.banner.height,\n      ad: rtbBid.rtb.banner.content\n    });\n    try {\n      const url = rtbBid.rtb.trackers[0].impression_urls[0];\n      const tracker = utils.createTrackPixelHtml(url);\n      bid.ad += tracker;\n    } catch (error) {\n      utils.logError('Error appending tracking pixel', error);\n    }\n  }\n\n  return bid;\n}\n\nfunction bidToTag(bid) {\n  const tag = {};\n  tag.sizes = transformSizes(bid.sizes);\n  tag.primary_size = tag.sizes[0];\n  tag.ad_types = [];\n  tag.uuid = bid.bidId;\n  if (bid.params.placementId) {\n    tag.id = parseInt(bid.params.placementId, 10);\n  } else {\n    tag.code = bid.params.invCode;\n  }\n  tag.allow_smaller_sizes = bid.params.allowSmallerSizes || false;\n  tag.use_pmt_rule = bid.params.usePaymentRule || false\n  tag.prebid = true;\n  tag.disable_psa = true;\n  if (bid.params.reserve) {\n    tag.reserve = bid.params.reserve;\n  }\n  if (bid.params.position) {\n    tag.position = {'above': 1, 'below': 2}[bid.params.position] || 0;\n  }\n  if (bid.params.trafficSourceCode) {\n    tag.traffic_source_code = bid.params.trafficSourceCode;\n  }\n  if (bid.params.privateSizes) {\n    tag.private_sizes = getSizes(bid.params.privateSizes);\n  }\n  if (bid.params.supplyType) {\n    tag.supply_type = bid.params.supplyType;\n  }\n  if (bid.params.pubClick) {\n    tag.pubclick = bid.params.pubClick;\n  }\n  if (bid.params.extInvCode) {\n    tag.ext_inv_code = bid.params.extInvCode;\n  }\n  if (bid.params.externalImpId) {\n    tag.external_imp_id = bid.params.externalImpId;\n  }\n  if (!utils.isEmpty(bid.params.keywords)) {\n    tag.keywords = getKeywords(bid.params.keywords);\n  }\n\n  if (bid.mediaType === NATIVE || utils.deepAccess(bid, 'mediaTypes.native')) {\n    tag.ad_types.push(NATIVE);\n\n    if (bid.nativeParams) {\n      const nativeRequest = buildNativeRequest(bid.nativeParams);\n      tag[NATIVE] = {layouts: [nativeRequest]};\n    }\n  }\n\n  const videoMediaType = utils.deepAccess(bid, 'mediaTypes.video');\n  const context = utils.deepAccess(bid, 'mediaTypes.video.context');\n\n  if (bid.mediaType === VIDEO || videoMediaType) {\n    tag.ad_types.push(VIDEO);\n  }\n\n  // instream gets vastUrl, outstream gets vastXml\n  if (bid.mediaType === VIDEO || (videoMediaType && context !== 'outstream')) {\n    tag.require_asset_url = true;\n  }\n\n  if (bid.params.video) {\n    tag.video = {};\n    // place any valid video params on the tag\n    Object.keys(bid.params.video)\n      .filter(param => VIDEO_TARGETING.includes(param))\n      .forEach(param => tag.video[param] = bid.params.video[param]);\n  }\n\n  if (\n    (utils.isEmpty(bid.mediaType) && utils.isEmpty(bid.mediaTypes)) ||\n    (bid.mediaType === BANNER || (bid.mediaTypes && bid.mediaTypes[BANNER]))\n  ) {\n    tag.ad_types.push(BANNER);\n  }\n\n  return tag;\n}\n\n/* Turn bid request sizes into ut-compatible format */\nfunction transformSizes(requestSizes) {\n  let sizes = [];\n  let sizeObj = {};\n\n  if (utils.isArray(requestSizes) && requestSizes.length === 2 &&\n    !utils.isArray(requestSizes[0])) {\n    sizeObj.width = parseInt(requestSizes[0], 10);\n    sizeObj.height = parseInt(requestSizes[1], 10);\n    sizes.push(sizeObj);\n  } else if (typeof requestSizes === 'object') {\n    for (let i = 0; i < requestSizes.length; i++) {\n      let size = requestSizes[i];\n      sizeObj = {};\n      sizeObj.width = parseInt(size[0], 10);\n      sizeObj.height = parseInt(size[1], 10);\n      sizes.push(sizeObj);\n    }\n  }\n\n  return sizes;\n}\n\nfunction hasUserInfo(bid) {\n  return !!bid.params.user;\n}\n\nfunction hasMemberId(bid) {\n  return !!parseInt(bid.params.member, 10);\n}\n\nfunction getRtbBid(tag) {\n  return tag && tag.ads && tag.ads.length && tag.ads.find(ad => ad.rtb);\n}\n\nfunction buildNativeRequest(params) {\n  const request = {};\n\n  // map standard prebid native asset identifier to /ut parameters\n  // e.g., tag specifies `body` but /ut only knows `description`.\n  // mapping may be in form {tag: '<server name>'} or\n  // {tag: {serverName: '<server name>', requiredParams: {...}}}\n  Object.keys(params).forEach(key => {\n    // check if one of the <server name> forms is used, otherwise\n    // a mapping wasn't specified so pass the key straight through\n    const requestKey =\n      (NATIVE_MAPPING[key] && NATIVE_MAPPING[key].serverName) ||\n      NATIVE_MAPPING[key] ||\n      key;\n\n    // required params are always passed on request\n    const requiredParams = NATIVE_MAPPING[key] && NATIVE_MAPPING[key].requiredParams;\n    request[requestKey] = Object.assign({}, requiredParams, params[key]);\n\n    // minimum params are passed if no non-required params given on adunit\n    const minimumParams = NATIVE_MAPPING[key] && NATIVE_MAPPING[key].minimumParams;\n\n    if (requiredParams && minimumParams) {\n      // subtract required keys from adunit keys\n      const adunitKeys = Object.keys(params[key]);\n      const requiredKeys = Object.keys(requiredParams);\n      const remaining = adunitKeys.filter(key => !requiredKeys.includes(key));\n\n      // if none are left over, the minimum params needs to be sent\n      if (remaining.length === 0) {\n        request[requestKey] = Object.assign({}, request[requestKey], minimumParams);\n      }\n    }\n  });\n\n  return request;\n}\n\nfunction outstreamRender(bid) {\n  // push to render queue because ANOutstreamVideo may not be loaded yet\n  bid.renderer.push(() => {\n    window.ANOutstreamVideo.renderAd({\n      tagId: bid.adResponse.tag_id,\n      sizes: [bid.getSize().split('x')],\n      targetId: bid.adUnitCode, // target div id to render video\n      uuid: bid.adResponse.uuid,\n      adResponse: bid.adResponse,\n      rendererOptions: bid.renderer.getConfig()\n    }, handleOutstreamRendererEvents.bind(null, bid));\n  });\n}\n\nfunction handleOutstreamRendererEvents(bid, id, eventName) {\n  bid.renderer.handleVideoEvent({ id, eventName });\n}\n\nfunction parseMediaType(rtbBid) {\n  const adType = rtbBid.ad_type;\n  if (adType === VIDEO) {\n    return VIDEO;\n  } else if (adType === NATIVE) {\n    return NATIVE;\n  } else {\n    return BANNER;\n  }\n}\n\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/appnexusAstBidAdapter.js"],"sourceRoot":""}