{"version":3,"sources":["webpack:///./modules/rubiconBidAdapter.js"],"names":["masSizeOrdering","resetUserSync","utils","INTEGRATION","isSecure","location","protocol","FASTLANE_ENDPOINT","VIDEO_ENDPOINT","SYNC_ENDPOINT","TIMEOUT_BUFFER","sizeMap","_each","item","key","spec","code","aliases","supportedMediaTypes","isBidRequestValid","bid","params","test","accountId","parsedSizes","parseSizes","length","mediaType","video","size_id","buildRequests","bidRequests","bidderRequest","map","bidRequest","startTime","Date","getTime","size","data","page_url","referrer","getTopWindowUrl","resolution","_getScreenResolution","account_id","integration","timeout","now","auctionStart","stash_creatives","ae_pass_through_parameters","aeParams","slots","slotData","site_id","siteId","zone_id","zoneId","position","floor","parseFloat","element_id","adUnitCode","name","language","width","height","inventory","keywords","Array","isArray","visitor","push","method","url","userId","pageUrl","slice","join","undefined","transactionId","Math","random","concat","_getDigiTrustQueryParams","reduce","memo","curr","index","encodeURIComponent","interpretResponse","responseObj","body","ads","status","sort","_adCpmSort","bids","ad","requestId","bidId","currency","creativeId","creative_id","cpm","dealId","deal","ttl","netRevenue","getConfig","playerWidth","playerHeight","vastUrl","creative_depot_url","impression_id","_renderCreative","script","split","Number","num","rubiconTargeting","targeting","values","getUserSyncs","syncOptions","hasSynced","iframeEnabled","type","adA","adB","window","screen","getDigiTrustId","digiTrustUser","DigiTrust","getUser","member","success","identity","digiTrustId","privacy","optout","id","keyv","impId","sizes","MAS_SIZE_PRIORITY","parseSizesInput","result","mappedSize","parseInt","first","second","firstPriority","indexOf","secondPriority"],"mappings":"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","file":"rubiconBidAdapter.js","sourcesContent":["import * as utils from 'src/utils';\nimport { registerBidder } from 'src/adapters/bidderFactory';\nimport { config } from 'src/config';\n\nconst INTEGRATION = 'pbjs_lite_v0.34.1';\n\nfunction isSecure() {\n  return location.protocol === 'https:';\n}\n\n// use protocol relative urls for http or https\nconst FASTLANE_ENDPOINT = '//fastlane.rubiconproject.com/a/api/fastlane.json';\nconst VIDEO_ENDPOINT = '//fastlane-adv.rubiconproject.com/v1/auction/video';\nconst SYNC_ENDPOINT = 'https://tap-secure.rubiconproject.com/partner/scripts/rubicon/emily.html?rtb_ext=1';\n\nconst TIMEOUT_BUFFER = 500;\n\nvar sizeMap = {\n  1: '468x60',\n  2: '728x90',\n  5: '120x90',\n  8: '120x600',\n  9: '160x600',\n  10: '300x600',\n  13: '200x200',\n  14: '250x250',\n  15: '300x250',\n  16: '336x280',\n  19: '300x100',\n  31: '980x120',\n  32: '250x360',\n  33: '180x500',\n  35: '980x150',\n  37: '468x400',\n  38: '930x180',\n  43: '320x50',\n  44: '300x50',\n  48: '300x300',\n  54: '300x1050',\n  55: '970x90',\n  57: '970x250',\n  58: '1000x90',\n  59: '320x80',\n  60: '320x150',\n  61: '1000x1000',\n  65: '640x480',\n  67: '320x480',\n  68: '1800x1000',\n  72: '320x320',\n  73: '320x160',\n  78: '980x240',\n  79: '980x300',\n  80: '980x400',\n  83: '480x300',\n  94: '970x310',\n  96: '970x210',\n  101: '480x320',\n  102: '768x1024',\n  103: '480x280',\n  108: '320x240',\n  113: '1000x300',\n  117: '320x100',\n  125: '800x250',\n  126: '200x600',\n  144: '980x600',\n  195: '600x300',\n  199: '640x200',\n  213: '1030x590',\n  214: '980x360',\n};\nutils._each(sizeMap, (item, key) => sizeMap[item] = key);\n\nexport const spec = {\n  code: 'rubicon',\n  aliases: ['rubiconLite'],\n  supportedMediaTypes: ['video'],\n  /**\n   * @param {object} bid\n   * @return boolean\n   */\n  isBidRequestValid: function(bid) {\n    if (typeof bid.params !== 'object') {\n      return false;\n    }\n    let params = bid.params;\n\n    if (!/^\\d+$/.test(params.accountId)) {\n      return false;\n    }\n\n    let parsedSizes = parseSizes(bid);\n    if (parsedSizes.length < 1) {\n      return false;\n    }\n\n    if (bid.mediaType === 'video') {\n      if (typeof params.video !== 'object' || !params.video.size_id) {\n        return false;\n      }\n    }\n    return true;\n  },\n  /**\n   * @param {BidRequest[]} bidRequests\n   * @param bidderRequest\n   * @return ServerRequest[]\n   */\n  buildRequests: function(bidRequests, bidderRequest) {\n    return bidRequests.map(bidRequest => {\n      bidRequest.startTime = new Date().getTime();\n\n      if (bidRequest.mediaType === 'video') {\n        let params = bidRequest.params;\n        let size = parseSizes(bidRequest);\n\n        let data = {\n          page_url: !params.referrer ? utils.getTopWindowUrl() : params.referrer,\n          resolution: _getScreenResolution(),\n          account_id: params.accountId,\n          integration: INTEGRATION,\n          timeout: bidderRequest.timeout - (Date.now() - bidderRequest.auctionStart + TIMEOUT_BUFFER),\n          stash_creatives: true,\n          ae_pass_through_parameters: params.video.aeParams,\n          slots: []\n        };\n\n        // Define the slot object\n        let slotData = {\n          site_id: params.siteId,\n          zone_id: params.zoneId,\n          position: params.position || 'btf',\n          floor: parseFloat(params.floor) > 0.01 ? params.floor : 0.01,\n          element_id: bidRequest.adUnitCode,\n          name: bidRequest.adUnitCode,\n          language: params.video.language,\n          width: size[0],\n          height: size[1],\n          size_id: params.video.size_id\n        };\n\n        if (params.inventory && typeof params.inventory === 'object') {\n          slotData.inventory = params.inventory;\n        }\n\n        if (params.keywords && Array.isArray(params.keywords)) {\n          slotData.keywords = params.keywords;\n        }\n\n        if (params.visitor && typeof params.visitor === 'object') {\n          slotData.visitor = params.visitor;\n        }\n\n        data.slots.push(slotData);\n\n        return {\n          method: 'POST',\n          url: VIDEO_ENDPOINT,\n          data,\n          bidRequest\n        }\n      }\n\n      // non-video request builder\n      let {\n        accountId,\n        siteId,\n        zoneId,\n        position,\n        floor,\n        keywords,\n        visitor,\n        inventory,\n        userId,\n        referrer: pageUrl\n      } = bidRequest.params;\n\n      // defaults\n      floor = (floor = parseFloat(floor)) > 0.01 ? floor : 0.01;\n      position = position || 'btf';\n\n      // use rubicon sizes if provided, otherwise adUnit.sizes\n      let parsedSizes = parseSizes(bidRequest);\n\n      // using array to honor ordering. if order isn't important (it shouldn't be), an object would probably be preferable\n      let data = [\n        'account_id', accountId,\n        'site_id', siteId,\n        'zone_id', zoneId,\n        'size_id', parsedSizes[0],\n        'alt_size_ids', parsedSizes.slice(1).join(',') || undefined,\n        'p_pos', position,\n        'rp_floor', floor,\n        'rp_secure', isSecure() ? '1' : '0',\n        'tk_flint', INTEGRATION,\n        'tid', bidRequest.transactionId,\n        'p_screen_res', _getScreenResolution(),\n        'kw', keywords,\n        'tk_user_key', userId\n      ];\n\n      if (visitor !== null && typeof visitor === 'object') {\n        utils._each(visitor, (item, key) => data.push(`tg_v.${key}`, item));\n      }\n\n      if (inventory !== null && typeof inventory === 'object') {\n        utils._each(inventory, (item, key) => data.push(`tg_i.${key}`, item));\n      }\n\n      data.push(\n        'rand', Math.random(),\n        'rf', !pageUrl ? utils.getTopWindowUrl() : pageUrl\n      );\n\n      data = data.concat(_getDigiTrustQueryParams());\n\n      data = data.reduce(\n        (memo, curr, index) =>\n          index % 2 === 0 && data[index + 1] !== undefined\n            ? memo + curr + '=' + encodeURIComponent(data[index + 1]) + '&' : memo,\n        ''\n      ).slice(0, -1); // remove trailing &\n\n      return {\n        method: 'GET',\n        url: FASTLANE_ENDPOINT,\n        data,\n        bidRequest\n      };\n    });\n  },\n  /**\n   * @param {*} responseObj\n   * @param {BidRequest} bidRequest\n   * @return {Bid[]} An array of bids which\n   */\n  interpretResponse: function(responseObj, {bidRequest}) {\n    responseObj = responseObj.body\n    let ads = responseObj.ads;\n\n    // check overall response\n    if (typeof responseObj !== 'object' || responseObj.status !== 'ok') {\n      return [];\n    }\n\n    // video ads array is wrapped in an object\n    if (typeof bidRequest === 'object' && bidRequest.mediaType === 'video' && typeof ads === 'object') {\n      ads = ads[bidRequest.adUnitCode];\n    }\n\n    // check the ad response\n    if (!Array.isArray(ads) || ads.length < 1) {\n      return [];\n    }\n\n    // if there are multiple ads, sort by CPM\n    ads = ads.sort(_adCpmSort);\n\n    return ads.reduce((bids, ad) => {\n      if (ad.status !== 'ok') {\n        return [];\n      }\n\n      let bid = {\n        requestId: bidRequest.bidId,\n        currency: 'USD',\n        creativeId: ad.creative_id,\n        cpm: ad.cpm || 0,\n        dealId: ad.deal,\n        ttl: 300, // 5 minutes\n        netRevenue: config.getConfig('rubicon.netRevenue') || false\n      };\n      if (bidRequest.mediaType === 'video') {\n        bid.width = bidRequest.params.video.playerWidth;\n        bid.height = bidRequest.params.video.playerHeight;\n        bid.vastUrl = ad.creative_depot_url;\n        bid.impression_id = ad.impression_id;\n      } else {\n        bid.ad = _renderCreative(ad.script, ad.impression_id);\n        [bid.width, bid.height] = sizeMap[ad.size_id].split('x').map(num => Number(num));\n      }\n\n      // add server-side targeting\n      bid.rubiconTargeting = (Array.isArray(ad.targeting) ? ad.targeting : [])\n        .reduce((memo, item) => {\n          memo[item.key] = item.values[0];\n          return memo;\n        }, {'rpfl_elemid': bidRequest.adUnitCode});\n\n      bids.push(bid);\n\n      return bids;\n    }, []);\n  },\n  getUserSyncs: function(syncOptions) {\n    if (!hasSynced && syncOptions.iframeEnabled) {\n      hasSynced = true;\n      return {\n        type: 'iframe',\n        url: SYNC_ENDPOINT\n      };\n    }\n  }\n};\n\nfunction _adCpmSort(adA, adB) {\n  return (adB.cpm || 0.0) - (adA.cpm || 0.0);\n}\n\nfunction _getScreenResolution() {\n  return [window.screen.width, window.screen.height].join('x');\n}\n\nfunction _getDigiTrustQueryParams() {\n  function getDigiTrustId() {\n    let digiTrustUser = window.DigiTrust && (config.getConfig('digiTrustId') || window.DigiTrust.getUser({member: 'T9QSFKPDN9'}));\n    return (digiTrustUser && digiTrustUser.success && digiTrustUser.identity) || null;\n  }\n  let digiTrustId = getDigiTrustId();\n  // Verify there is an ID and this user has not opted out\n  if (!digiTrustId || (digiTrustId.privacy && digiTrustId.privacy.optout)) {\n    return [];\n  }\n  return [\n    'dt.id', digiTrustId.id,\n    'dt.keyv', digiTrustId.keyv,\n    'dt.pref', 0\n  ];\n}\n\nfunction _renderCreative(script, impId) {\n  return `<html>\n<head><script type='text/javascript'>inDapIF=true;</script></head>\n<body style='margin : 0; padding: 0;'>\n<!-- Rubicon Project Ad Tag -->\n<div data-rp-impression-id='${impId}'>\n<script type='text/javascript'>${script}</script>\n</div>\n</body>\n</html>`;\n}\n\nfunction parseSizes(bid) {\n  let params = bid.params;\n  if (bid.mediaType === 'video') {\n    let size = [];\n    if (params.video.playerWidth && params.video.playerHeight) {\n      size = [\n        params.video.playerWidth,\n        params.video.playerHeight\n      ];\n    } else if (\n      Array.isArray(bid.sizes) && bid.sizes.length > 0 &&\n        Array.isArray(bid.sizes[0]) && bid.sizes[0].length > 1\n    ) {\n      size = bid.sizes[0];\n    }\n    return size;\n  }\n  return masSizeOrdering(Array.isArray(params.sizes)\n    ? params.sizes.map(size => (sizeMap[size] || '').split('x')) : bid.sizes\n  );\n}\n\nexport function masSizeOrdering(sizes) {\n  const MAS_SIZE_PRIORITY = [15, 2, 9];\n\n  return utils.parseSizesInput(sizes)\n    // map sizes while excluding non-matches\n    .reduce((result, size) => {\n      let mappedSize = parseInt(sizeMap[size], 10);\n      if (mappedSize) {\n        result.push(mappedSize);\n      }\n      return result;\n    }, [])\n    .sort((first, second) => {\n      // sort by MAS_SIZE_PRIORITY priority order\n      const firstPriority = MAS_SIZE_PRIORITY.indexOf(first);\n      const secondPriority = MAS_SIZE_PRIORITY.indexOf(second);\n\n      if (firstPriority > -1 || secondPriority > -1) {\n        if (firstPriority === -1) {\n          return 1;\n        }\n        if (secondPriority === -1) {\n          return -1;\n        }\n        return firstPriority - secondPriority;\n      }\n\n      // and finally ascending order\n      return first - second;\n    });\n}\n\nvar hasSynced = false;\nexport function resetUserSync() {\n  hasSynced = false;\n}\n\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/rubiconBidAdapter.js"],"sourceRoot":""}