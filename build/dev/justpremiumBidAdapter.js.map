{"version":3,"sources":["webpack:///./modules/justpremiumBidAdapter.js"],"names":["BIDDER_CODE","ENDPOINT_URL","protocol","pixels","spec","code","time","isBidRequestValid","bid","params","zone","buildRequests","validBidRequests","c","preparePubCond","dim","getWebsiteDim","payload","map","parseInt","b","filter","value","index","self","indexOf","hostname","replace","sw","screenWidth","sh","screenHeight","ww","innerWidth","wh","innerHeight","id","sizes","forEach","push","apply","payloadString","JSON","stringify","method","url","Date","data","bids","interpretResponse","serverResponse","bidRequests","body","bidResponses","findBid","adUnit","size","length","bidResponse","requestId","bidId","creativeId","width","height","ad","adm","cpm","price","netRevenue","currency","ttl","getUserSyncs","syncOptions","iframeEnabled","type","src","tagId","len","passCond","splice","pop","format","allow","exclude","cond","count","formats","arrayUnique","concat","e","Object","keys","r","idx","array","a","i","j","top","window","screen"],"mappings":"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","file":"justpremiumBidAdapter.js","sourcesContent":["import { registerBidder } from 'src/adapters/bidderFactory'\nimport { getTopWindowLocation } from 'src/utils'\n\nconst BIDDER_CODE = 'justpremium'\nconst ENDPOINT_URL = getTopWindowLocation().protocol + '//pre.ads.justpremium.com/v/2.0/t/xhr'\nconst pixels = []\n\nexport const spec = {\n  code: BIDDER_CODE,\n  time: 60000,\n\n  isBidRequestValid: (bid) => {\n    return !!(bid && bid.params && bid.params.zone)\n  },\n\n  buildRequests: (validBidRequests) => {\n    const c = preparePubCond(validBidRequests)\n    const dim = getWebsiteDim()\n    const payload = {\n      zone: validBidRequests.map(b => {\n        return parseInt(b.params.zone)\n      }).filter((value, index, self) => {\n        return self.indexOf(value) === index\n      }),\n      hostname: getTopWindowLocation().hostname,\n      protocol: getTopWindowLocation().protocol.replace(':', ''),\n      sw: dim.screenWidth,\n      sh: dim.screenHeight,\n      ww: dim.innerWidth,\n      wh: dim.innerHeight,\n      c: c,\n      id: validBidRequests[0].params.zone,\n      sizes: {}\n    }\n    validBidRequests.forEach(b => {\n      const zone = b.params.zone\n      const sizes = payload.sizes\n      sizes[zone] = sizes[zone] || []\n      sizes[zone].push.apply(sizes[zone], b.sizes)\n    })\n    const payloadString = JSON.stringify(payload)\n\n    return {\n      method: 'POST',\n      url: ENDPOINT_URL + '?i=' + (+new Date()),\n      data: payloadString,\n      bids: validBidRequests\n    }\n  },\n\n  interpretResponse: (serverResponse, bidRequests) => {\n    const body = serverResponse.body\n    let bidResponses = []\n    bidRequests.bids.forEach(adUnit => {\n      let bid = findBid(adUnit.params, body.bid)\n      if (bid) {\n        let size = (adUnit.sizes && adUnit.sizes.length && adUnit.sizes[0]) || []\n        let bidResponse = {\n          requestId: adUnit.bidId,\n          creativeId: bid.id,\n          width: size[0] || bid.width,\n          height: size[1] || bid.height,\n          ad: bid.adm,\n          cpm: bid.price,\n          netRevenue: true,\n          currency: bid.currency || 'USD',\n          ttl: bid.ttl || spec.time\n        }\n        bidResponses.push(bidResponse)\n      }\n    })\n\n    return bidResponses\n  },\n\n  getUserSyncs: (syncOptions) => {\n    if (syncOptions.iframeEnabled) {\n      pixels.push({\n        type: 'iframe',\n        src: '//us-u.openx.net/w/1.0/pd?plm=10&ph=26e53f82-d199-49df-9eca-7b350c0f9646'\n      })\n    }\n    return pixels\n  }\n}\n\nfunction findBid (params, bids) {\n  const tagId = params.zone\n  if (bids[tagId]) {\n    let len = bids[tagId].length\n    while (len--) {\n      if (passCond(params, bids[tagId][len])) {\n        return bids[tagId].splice(len, 1).pop()\n      }\n    }\n  }\n\n  return false\n}\n\nfunction passCond (params, bid) {\n  const format = bid.format\n\n  if (params.allow && params.allow.length) {\n    return params.allow.indexOf(format) > -1\n  }\n\n  if (params.exclude && params.exclude.length) {\n    return params.exclude.indexOf(format) < 0\n  }\n\n  return true\n}\n\nfunction preparePubCond (bids) {\n  const cond = {}\n  const count = {}\n\n  bids.forEach((bid) => {\n    const params = bid.params\n    const zone = params.zone\n\n    if (cond[zone] === 1) {\n      return\n    }\n\n    const allow = params.allow || params.formats || []\n    const exclude = params.exclude || []\n\n    if (allow.length === 0 && exclude.length === 0) {\n      return cond[params.zone] = 1\n    }\n\n    cond[zone] = cond[zone] || [[], {}]\n    cond[zone][0] = arrayUnique(cond[zone][0].concat(allow))\n    exclude.forEach((e) => {\n      if (!cond[zone][1][e]) {\n        cond[zone][1][e] = 1\n      } else {\n        cond[zone][1][e]++\n      }\n    })\n\n    count[zone] = count[zone] || 0\n    if (exclude.length) {\n      count[zone]++\n    }\n  })\n\n  Object.keys(count).forEach((zone) => {\n    if (cond[zone] === 1) return\n\n    const exclude = []\n    Object.keys(cond[zone][1]).forEach((format) => {\n      if (cond[zone][1][format] === count[zone]) {\n        exclude.push(format)\n      }\n    })\n    cond[zone][1] = exclude\n  })\n\n  Object.keys(cond).forEach((zone) => {\n    if (cond[zone] !== 1 && cond[zone][1].length) {\n      cond[zone][0].forEach((r) => {\n        let idx = cond[zone][1].indexOf(r)\n        if (idx > -1) {\n          cond[zone][1].splice(idx, 1)\n        }\n      })\n      cond[zone][0].length = 0\n    }\n\n    if (cond[zone] !== 1 && !cond[zone][0].length && !cond[zone][1].length) {\n      cond[zone] = 1\n    }\n  })\n\n  return cond\n}\n\nfunction arrayUnique (array) {\n  const a = array.concat()\n  for (let i = 0; i < a.length; ++i) {\n    for (let j = i + 1; j < a.length; ++j) {\n      if (a[i] === a[j]) {\n        a.splice(j--, 1)\n      }\n    }\n  }\n\n  return a\n}\n\nfunction getWebsiteDim () {\n  let top\n  try {\n    top = window.top\n  } catch (e) {\n    top = window\n  }\n\n  return {\n    screenWidth: top.screen.width,\n    screenHeight: top.screen.height,\n    innerWidth: top.innerWidth,\n    innerHeight: top.innerHeight\n  }\n}\n\nregisterBidder(spec)\n\n\n\n// WEBPACK FOOTER //\n// ./modules/justpremiumBidAdapter.js"],"sourceRoot":""}