{"version":3,"sources":["webpack:///./modules/adformBidAdapter.js"],"names":["utils","require","adloader","bidmanager","bidfactory","STATUSCODES","STATUS","adaptermanager","Adapter","ADFORM_BIDDER_CODE","AdformAdapter","baseAdapter","_callBids","params","bid","_value","_key","i","j","k","l","reqParams","bids","request","callbackName","getUniqueIdentifierStr","globalParams","length","transactionId","push","formRequestUrl","unshift","requestId","encodeURIComponent","pbjs","handleCallback","loadScript","join","reqData","key","url","hasOwnProperty","encode64","slice","handleResponse","adItems","bidObject","bidder","getBidderCode","adItem","response","verifySize","sizes","createBid","GOOD","bidderCode","cpm","win_bid","cur","win_cur","ad","banner","width","height","dealId","deal_id","addBidResponse","placementCode","NO_BID","validSizes","input","out","chr1","chr2","chr3","enc1","enc2","enc3","enc4","_keyStr","utf8_encode","charCodeAt","isNaN","charAt","string","replace","utftext","n","c","String","fromCharCode","callBids","registerBidAdapter","module","exports"],"mappings":"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","file":"adformBidAdapter.js","sourcesContent":["var utils = require('src/utils');\nvar adloader = require('src/adloader');\nvar bidmanager = require('src/bidmanager');\nvar bidfactory = require('src/bidfactory');\nvar STATUSCODES = require('src/constants.json').STATUS;\nvar adaptermanager = require('src/adaptermanager');\nvar Adapter = require('src/adapter').default;\n\nconst ADFORM_BIDDER_CODE = 'adform';\n\nfunction AdformAdapter() {\n  let baseAdapter = new Adapter(ADFORM_BIDDER_CODE);\n\n  function _callBids(params) {\n    var bid, _value, _key, i, j, k, l, reqParams;\n    var bids = params.bids;\n    var request = [];\n    var callbackName = '_adf_' + utils.getUniqueIdentifierStr();\n    var globalParams = [ [ 'adxDomain', 'adx.adform.net' ], ['fd', 1], [ 'url', null ], [ 'tid', null ], [ 'callback', 'pbjs.' + callbackName ] ];\n\n    for (i = 0, l = bids.length; i < l; i++) {\n      bid = bids[i];\n\n      for (j = 0, k = globalParams.length; j < k; j++) {\n        _key = globalParams[j][0];\n        _value = bid[_key] || bid.params[_key];\n        if (_value) {\n          bid[_key] = bid.params[_key] = null;\n          globalParams[j][1] = _value;\n        }\n      }\n\n      reqParams = bid.params;\n      reqParams.transactionId = bid.transactionId;\n      request.push(formRequestUrl(reqParams));\n    }\n\n    request.unshift('//' + globalParams[0][1] + '/adx/?rp=4');\n\n    request.push('auctionId=' + params.requestId);\n    for (i = 1, l = globalParams.length; i < l; i++) {\n      _key = globalParams[i][0];\n      _value = globalParams[i][1];\n      if (_value) {\n        request.push(globalParams[i][0] + '=' + encodeURIComponent(_value));\n      }\n    }\n\n    pbjs[callbackName] = handleCallback(bids);\n\n    adloader.loadScript(request.join('&'));\n  };\n\n  function formRequestUrl(reqData) {\n    var key;\n    var url = [];\n\n    for (key in reqData) {\n      if (reqData.hasOwnProperty(key) && reqData[key]) { url.push(key, '=', reqData[key], '&'); }\n    }\n\n    return encode64(url.join('').slice(0, -1));\n  }\n\n  function handleCallback(bids) {\n    return function handleResponse(adItems) {\n      var bidObject;\n      var bidder = baseAdapter.getBidderCode();\n      var adItem;\n      var bid;\n      for (var i = 0, l = adItems.length; i < l; i++) {\n        adItem = adItems[i];\n        bid = bids[i];\n        if (adItem && adItem.response === 'banner' &&\n            verifySize(adItem, bid.sizes)) {\n          bidObject = bidfactory.createBid(STATUSCODES.GOOD, bid);\n          bidObject.bidderCode = bidder;\n          bidObject.cpm = adItem.win_bid;\n          bidObject.cur = adItem.win_cur;\n          bidObject.ad = adItem.banner;\n          bidObject.width = adItem.width;\n          bidObject.height = adItem.height;\n          bidObject.dealId = adItem.deal_id;\n          bidObject.transactionId = bid.transactionId;\n          bidmanager.addBidResponse(bid.placementCode, bidObject);\n        } else {\n          bidObject = bidfactory.createBid(STATUSCODES.NO_BID, bid);\n          bidObject.bidderCode = bidder;\n          bidmanager.addBidResponse(bid.placementCode, bidObject);\n        }\n      }\n    };\n\n    function verifySize(adItem, validSizes) {\n      for (var j = 0, k = validSizes.length; j < k; j++) {\n        if (adItem.width === validSizes[j][0] &&\n            adItem.height === validSizes[j][1]) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n  }\n\n  function encode64(input) {\n    var out = [];\n    var chr1;\n    var chr2;\n    var chr3;\n    var enc1;\n    var enc2;\n    var enc3;\n    var enc4;\n    var i = 0;\n    var _keyStr = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=';\n\n    input = utf8_encode(input);\n\n    while (i < input.length) {\n      chr1 = input.charCodeAt(i++);\n      chr2 = input.charCodeAt(i++);\n      chr3 = input.charCodeAt(i++);\n\n      enc1 = chr1 >> 2;\n      enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n      enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n      enc4 = chr3 & 63;\n\n      if (isNaN(chr2)) {\n        enc3 = enc4 = 64;\n      } else if (isNaN(chr3)) {\n        enc4 = 64;\n      }\n\n      out.push(_keyStr.charAt(enc1), _keyStr.charAt(enc2));\n      if (enc3 !== 64) { out.push(_keyStr.charAt(enc3)); }\n      if (enc4 !== 64) { out.push(_keyStr.charAt(enc4)); }\n    }\n\n    return out.join('');\n  }\n\n  function utf8_encode(string) {\n    string = string.replace(/\\r\\n/g, '\\n');\n    var utftext = '';\n\n    for (var n = 0; n < string.length; n++) {\n      var c = string.charCodeAt(n);\n\n      if (c < 128) {\n        utftext += String.fromCharCode(c);\n      } else if ((c > 127) && (c < 2048)) {\n        utftext += String.fromCharCode((c >> 6) | 192);\n        utftext += String.fromCharCode((c & 63) | 128);\n      } else {\n        utftext += String.fromCharCode((c >> 12) | 224);\n        utftext += String.fromCharCode(((c >> 6) & 63) | 128);\n        utftext += String.fromCharCode((c & 63) | 128);\n      }\n    }\n\n    return utftext;\n  }\n\n  return Object.assign(this, baseAdapter, {\n    callBids: _callBids\n  });\n}\n\nadaptermanager.registerBidAdapter(new AdformAdapter(), ADFORM_BIDDER_CODE);\nmodule.exports = AdformAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/adformBidAdapter.js"],"sourceRoot":""}