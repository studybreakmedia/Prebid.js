{"version":3,"sources":["webpack:///./modules/unrulyBidAdapter.js"],"names":["utils","createRenderHandler","bidResponseBid","rendererConfig","createApi","parent","window","unruly","prebid","uq","render","push","onLoaded","siteId","api","onRendererLoad","createBidResponseHandler","bidRequestBids","onBidResponse","responseBody","exchangeResponse","JSON","parse","bids","forEach","exchangeBid","createBid","ext","statusCode","renderer","rendererParams","renderHandler","config","install","callback","setRender","addBidResponse","placementCode","error","logError","NO_BID","bidRequestBid","UnrulyAdapter","adapter","exchangeUrl","callBids","length","videoMediaType","deepAccess","context","payload","bidRequests","bidResponseHandler","stringify","contentType","withCredentials","registerBidAdapter","supportedMediaTypes","module","exports"],"mappings":"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","file":"unrulyBidAdapter.js","sourcesContent":["import { ajax } from 'src/ajax'\nimport bidfactory from 'src/bidfactory'\nimport bidmanager from 'src/bidmanager'\nimport * as utils from 'src/utils'\nimport { STATUS } from 'src/constants'\nimport { Renderer } from 'src/Renderer'\nimport adaptermanager from 'src/adaptermanager'\n\nfunction createRenderHandler({ bidResponseBid, rendererConfig }) {\n  function createApi() {\n    parent.window.unruly['native'].prebid = parent.window.unruly['native'].prebid || {}\n    parent.window.unruly['native'].prebid.uq = parent.window.unruly['native'].prebid.uq || []\n\n    return {\n      render(bidResponseBid) {\n        parent.window.unruly['native'].prebid.uq.push(['render', bidResponseBid])\n      },\n      onLoaded(bidResponseBid) {}\n    }\n  }\n\n  parent.window.unruly = parent.window.unruly || {}\n  parent.window.unruly['native'] = parent.window.unruly['native'] || {}\n  parent.window.unruly['native'].siteId = parent.window.unruly['native'].siteId || rendererConfig.siteId\n\n  const api = createApi()\n  return {\n    render() {\n      api.render(bidResponseBid)\n    },\n    onRendererLoad() {\n      api.onLoaded(bidResponseBid)\n    }\n  }\n}\n\nfunction createBidResponseHandler(bidRequestBids) {\n  return {\n    onBidResponse(responseBody) {\n      try {\n        const exchangeResponse = JSON.parse(responseBody)\n        exchangeResponse.bids.forEach((exchangeBid) => {\n          const bidResponseBid = bidfactory.createBid(exchangeBid.ext.statusCode, exchangeBid)\n\n          Object.assign(\n            bidResponseBid,\n            exchangeBid\n          )\n\n          if (exchangeBid.ext.renderer) {\n            const rendererParams = exchangeBid.ext.renderer\n            const renderHandler = createRenderHandler({\n              bidResponseBid,\n              rendererConfig: rendererParams.config\n            })\n\n            bidResponseBid.renderer = Renderer.install(\n              Object.assign(\n                {},\n                rendererParams,\n                { callback: () => renderHandler.onRendererLoad() }\n              )\n            )\n            bidResponseBid.renderer.setRender(() => renderHandler.render())\n          }\n\n          bidmanager.addBidResponse(exchangeBid.ext.placementCode, bidResponseBid)\n        })\n      } catch (error) {\n        utils.logError(error);\n        bidRequestBids.forEach(bidRequestBid => {\n          const bidResponseBid = bidfactory.createBid(STATUS.NO_BID)\n          bidmanager.addBidResponse(bidRequestBid.placementCode, bidResponseBid)\n        })\n      }\n    }\n  }\n}\n\nfunction UnrulyAdapter() {\n  const adapter = {\n    exchangeUrl: 'https://targeting.unrulymedia.com/prebid',\n    callBids({ bids: bidRequestBids }) {\n      if (!bidRequestBids || bidRequestBids.length === 0) {\n        return\n      }\n\n      const videoMediaType = utils.deepAccess(bidRequestBids[0], 'mediaTypes.video')\n      const context = utils.deepAccess(bidRequestBids[0], 'mediaTypes.video.context')\n      if (videoMediaType && context !== 'outstream') {\n        return\n      }\n\n      const payload = {\n        bidRequests: bidRequestBids\n      }\n\n      const bidResponseHandler = createBidResponseHandler(bidRequestBids)\n\n      ajax(\n        adapter.exchangeUrl,\n        bidResponseHandler.onBidResponse,\n        JSON.stringify(payload),\n        {\n          contentType: 'application/json',\n          withCredentials: true\n        }\n      )\n    }\n  }\n\n  return adapter\n}\n\nadaptermanager.registerBidAdapter(new UnrulyAdapter(), 'unruly', {\n  supportedMediaTypes: ['video']\n});\n\nmodule.exports = UnrulyAdapter\n\n\n\n// WEBPACK FOOTER //\n// ./modules/unrulyBidAdapter.js"],"sourceRoot":""}