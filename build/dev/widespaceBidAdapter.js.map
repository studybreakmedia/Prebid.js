{"version":3,"sources":["webpack:///./modules/widespaceBidAdapter.js"],"names":["utils","require","adloader","bidmanager","bidfactory","adaptermanager","WS_ADAPTER_VERSION","WidespaceAdapter","useSSL","document","location","protocol","baseURL","callbackName","_callBids","params","bids","i","length","bid","callbackUid","bidId","sid","currency","cur","sizeQueryString","parsedSizes","parseSizesInput","sizes","reduce","prev","curr","requestURL","tryAppendQueryString","demo","demoFields","paramKeys","Object","keys","k","key","pbjs","widespaceHandleCB","window","handleCallback","loadScript","bidsArray","bidObject","bidCode","l","placementCode","validSizes","height","width","inBid","getBidRequest","bidder","status","verifySize","createBid","bidderCode","cpm","creative_id","adId","ad","code","addBidResponse","j","callBids","registerBidAdapter","module","exports"],"mappings":"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","file":"widespaceBidAdapter.js","sourcesContent":["\nconst utils = require('src/utils.js');\nconst adloader = require('src/adloader.js');\nconst bidmanager = require('src/bidmanager.js');\nconst bidfactory = require('src/bidfactory.js');\nconst adaptermanager = require('src/adaptermanager');\nconst WS_ADAPTER_VERSION = '1.0.3';\n\nfunction WidespaceAdapter() {\n  const useSSL = document.location.protocol === 'https:';\n  const baseURL = (useSSL ? 'https:' : 'http:') + '//engine.widespace.com/map/engine/hb/dynamic?';\n  const callbackName = 'pbjs.widespaceHandleCB';\n\n  function _callBids(params) {\n    let bids = (params && params.bids) || [];\n\n    for (var i = 0; i < bids.length; i++) {\n      const bid = bids[i];\n      const callbackUid = bid.bidId;\n      const sid = bid.params.sid;\n      const currency = bid.params.cur || bid.params.currency;\n\n      // Handle Sizes string\n      let sizeQueryString = '';\n      let parsedSizes = utils.parseSizesInput(bid.sizes);\n\n      sizeQueryString = parsedSizes.reduce((prev, curr) => {\n        return prev ? `${prev},${curr}` : curr;\n      }, sizeQueryString);\n\n      let requestURL = baseURL;\n      requestURL = utils.tryAppendQueryString(requestURL, 'hb.ver', WS_ADAPTER_VERSION);\n\n      const params = {\n        'hb': '1',\n        'hb.name': 'prebidjs',\n        'hb.callback': callbackName,\n        'hb.callbackUid': callbackUid,\n        'hb.sizes': sizeQueryString,\n        'hb.currency': currency,\n        'sid': sid\n      };\n\n      if (bid.params.demo) {\n        let demoFields = ['gender', 'country', 'region', 'postal', 'city', 'yob'];\n        for (let i = 0; i < demoFields.length; i++) {\n          if (!bid.params.demo[demoFields[i]]) {\n            continue;\n          }\n          params['hb.demo.' + demoFields[i]] = bid.params.demo[demoFields[i]];\n        }\n      }\n\n      requestURL += '#';\n\n      var paramKeys = Object.keys(params);\n\n      for (var k = 0; k < paramKeys.length; k++) {\n        var key = paramKeys[k];\n        requestURL += key + '=' + params[key] + '&';\n      }\n\n      // Expose the callback\n      pbjs.widespaceHandleCB = window[callbackName] = handleCallback;\n\n      adloader.loadScript(requestURL);\n    }\n  }\n\n  // Handle our callback\n  var handleCallback = function handleCallback(bidsArray) {\n    if (!bidsArray) { return; }\n\n    let bidObject;\n    let bidCode = 'widespace';\n\n    for (var i = 0, l = bidsArray.length; i < l; i++) {\n      const bid = bidsArray[i];\n      let placementCode = '';\n      let validSizes = [];\n\n      bid.sizes = {height: bid.height, width: bid.width};\n\n      var inBid = utils.getBidRequest(bid.callbackUid);\n\n      if (inBid) {\n        bidCode = inBid.bidder;\n        placementCode = inBid.placementCode;\n        validSizes = inBid.sizes;\n      }\n\n      if (bid && bid.callbackUid && bid.status !== 'noad' && verifySize(bid.sizes, validSizes)) {\n        bidObject = bidfactory.createBid(1);\n        bidObject.bidderCode = bidCode;\n        bidObject.cpm = bid.cpm;\n        bidObject.cur = bid.currency;\n        bidObject.creative_id = bid.adId;\n        bidObject.ad = bid.code;\n        bidObject.width = bid.width;\n        bidObject.height = bid.height;\n        bidmanager.addBidResponse(placementCode, bidObject);\n      } else {\n        bidObject = bidfactory.createBid(2);\n        bidObject.bidderCode = bidCode;\n        bidmanager.addBidResponse(placementCode, bidObject);\n      }\n    }\n\n    function verifySize(bid, validSizes) {\n      for (var j = 0, k = validSizes.length; j < k; j++) {\n        if (bid.width === validSizes[j][0] &&\n          bid.height === validSizes[j][1]) {\n          return true;\n        }\n      }\n      return false;\n    }\n  };\n\n  return {\n    callBids: _callBids\n  };\n}\n\nadaptermanager.registerBidAdapter(new WidespaceAdapter(), 'widespace');\n\nmodule.exports = WidespaceAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/widespaceBidAdapter.js"],"sourceRoot":""}