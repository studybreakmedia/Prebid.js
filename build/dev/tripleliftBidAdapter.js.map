{"version":3,"sources":["webpack:///./modules/tripleliftBidAdapter.js"],"names":["utils","require","adloader","bidmanager","bidfactory","adaptermanager","TripleLiftAdapter","usersync","_callBids","params","tlReq","bids","bidsCount","length","i","bidRequest","callbackId","bidId","loadScript","buildTLCall","bid","inventoryCode","getBidIdParameter","floor","tlURI","tlCall","document","location","protocol","tryAppendQueryString","isFlashEnabled","sizeQueryString","parseSizesInput","sizes","referrer","getTopWindowUrl","lastIndexOf","substring","logMessage","startTime","Date","getTime","hasFlash","fo","window","ActiveXObject","e","navigator","mimeTypes","undefined","enabledPlugin","pbjs","TLCB","tlResponseObj","callback_id","bidObj","getBidRequest","placementCode","cpm","createBid","bidderCode","ad","width","height","dealId","deal_id","addBidResponse","iframe","createInvisibleIframe","src","body","appendChild","error","logError","_tlSyncDone","callBids","registerBidAdapter","module","exports"],"mappings":"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","file":"tripleliftBidAdapter.js","sourcesContent":["var utils = require('src/utils.js');\nvar adloader = require('src/adloader.js');\nvar bidmanager = require('src/bidmanager.js');\nvar bidfactory = require('src/bidfactory.js');\nvar adaptermanager = require('src/adaptermanager');\n\n/* TripleLift bidder factory function\n*  Use to create a TripleLiftAdapter object\n*/\n\nvar TripleLiftAdapter = function TripleLiftAdapter() {\n  var usersync = false;\n\n  function _callBids(params) {\n    var tlReq = params.bids;\n    var bidsCount = tlReq.length;\n\n    // set expected bids count for callback execution\n    // bidmanager.setExpectedBidsCount('triplelift',bidsCount);\n\n    for (var i = 0; i < bidsCount; i++) {\n      var bidRequest = tlReq[i];\n      var callbackId = bidRequest.bidId;\n      adloader.loadScript(buildTLCall(bidRequest, callbackId));\n      // store a reference to the bidRequest from the callback id\n      // bidmanager.pbCallbackMap[callbackId] = bidRequest;\n    }\n  }\n\n  function buildTLCall(bid, callbackId) {\n    // determine tag params\n    var inventoryCode = utils.getBidIdParameter('inventoryCode', bid.params);\n    var floor = utils.getBidIdParameter('floor', bid.params);\n\n    // build our base tag, based on if we are http or https\n    var tlURI = '//tlx.3lift.com/header/auction?';\n    var tlCall = document.location.protocol + tlURI;\n\n    tlCall = utils.tryAppendQueryString(tlCall, 'callback', 'pbjs.TLCB');\n    tlCall = utils.tryAppendQueryString(tlCall, 'lib', 'prebid');\n    tlCall = utils.tryAppendQueryString(tlCall, 'v', '0.34.1');\n    tlCall = utils.tryAppendQueryString(tlCall, 'callback_id', callbackId);\n    tlCall = utils.tryAppendQueryString(tlCall, 'inv_code', inventoryCode);\n    tlCall = utils.tryAppendQueryString(tlCall, 'floor', floor);\n\n    // indicate whether flash support exists\n    tlCall = utils.tryAppendQueryString(tlCall, 'fe', isFlashEnabled());\n\n    // sizes takes a bit more logic\n    var sizeQueryString = utils.parseSizesInput(bid.sizes);\n    if (sizeQueryString) {\n      tlCall += 'size=' + sizeQueryString + '&';\n    }\n\n    // append referrer\n    var referrer = utils.getTopWindowUrl();\n    tlCall = utils.tryAppendQueryString(tlCall, 'referrer', referrer);\n\n    // remove the trailing \"&\"\n    if (tlCall.lastIndexOf('&') === tlCall.length - 1) {\n      tlCall = tlCall.substring(0, tlCall.length - 1);\n    }\n\n    // @if NODE_ENV='debug'\n    utils.logMessage('tlCall request built: ' + tlCall);\n    // @endif\n\n    // append a timer here to track latency\n    bid.startTime = new Date().getTime();\n\n    return tlCall;\n  }\n\n  function isFlashEnabled() {\n    var hasFlash = 0;\n    try {\n      // check for Flash support in IE\n      var fo = new window.ActiveXObject('ShockwaveFlash.ShockwaveFlash');\n      if (fo) { hasFlash = 1; }\n    } catch (e) {\n      if (navigator.mimeTypes &&\n        navigator.mimeTypes['application/x-shockwave-flash'] !== undefined &&\n        navigator.mimeTypes['application/x-shockwave-flash'].enabledPlugin) {\n        hasFlash = 1;\n      }\n    }\n    return hasFlash;\n  }\n\n  // expose the callback to the global object:\n  pbjs.TLCB = function(tlResponseObj) {\n    if (tlResponseObj && tlResponseObj.callback_id) {\n      var bidObj = utils.getBidRequest(tlResponseObj.callback_id);\n      var placementCode = bidObj && bidObj.placementCode;\n\n      // @if NODE_ENV='debug'\n      if (bidObj) { utils.logMessage('JSONP callback function called for inventory code: ' + bidObj.params.inventoryCode); }\n      // @endif\n\n      var bid = [];\n      if (tlResponseObj && tlResponseObj.cpm && tlResponseObj.cpm !== 0) {\n        bid = bidfactory.createBid(1, bidObj);\n        bid.bidderCode = 'triplelift';\n        bid.cpm = tlResponseObj.cpm;\n        bid.ad = tlResponseObj.ad;\n        bid.width = tlResponseObj.width;\n        bid.height = tlResponseObj.height;\n        bid.dealId = tlResponseObj.deal_id;\n        bidmanager.addBidResponse(placementCode, bid);\n      } else {\n        // no response data\n        // @if NODE_ENV='debug'\n        if (bidObj) { utils.logMessage('No prebid response from TripleLift for inventory code: ' + bidObj.params.inventoryCode); }\n        // @endif\n        bid = bidfactory.createBid(2, bidObj);\n        bid.bidderCode = 'triplelift';\n        bidmanager.addBidResponse(placementCode, bid);\n      }\n\n      // run usersyncs\n      if (!usersync) {\n        var iframe = utils.createInvisibleIframe();\n        iframe.src = '//ib.3lift.com/sync';\n        try {\n          document.body.appendChild(iframe);\n        } catch (error) {\n          utils.logError(error);\n        }\n        usersync = true;\n        // suppress TL ad tag from running additional usersyncs\n        window._tlSyncDone = true;\n      }\n    } else {\n      // no response data\n      // @if NODE_ENV='debug'\n      utils.logMessage('No prebid response for placement %%PLACEMENT%%');\n      // @endif\n    }\n  };\n\n  return {\n    callBids: _callBids\n\n  };\n};\n\nadaptermanager.registerBidAdapter(new TripleLiftAdapter(), 'triplelift');\n\nmodule.exports = TripleLiftAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/tripleliftBidAdapter.js"],"sourceRoot":""}