{"version":3,"sources":["webpack:///./src/AnalyticsAdapter.js","webpack:///./modules/roxotAnalyticsAdapter.js"],"names":["AnalyticsAdapter","events","require","utils","AUCTION_INIT","EVENTS","AUCTION_END","BID_REQUESTED","BID_TIMEOUT","BID_RESPONSE","BID_WON","BID_ADJUSTMENT","SET_TARGETING","LIBRARY","ENDPOINT","BUNDLE","_sampled","url","analyticsType","global","handler","_queue","_eventCount","_enableCheck","_handlers","_emptyQueue","track","_track","enqueue","_enqueue","enableAnalytics","_enable","disableAnalytics","_disable","getAdapterType","getGlobal","getHandler","getUrl","eventType","args","window","_callEndpoint","arguments","callback","JSON","stringify","_this","push","config","options","sampling","Math","random","parseFloat","getEvents","forEach","event","call","_each","on","logMessage","off","i","length","fn","auctionInitConst","auctionEndConst","bidWonConst","bidRequestConst","bidAdjustmentConst","bidResponseConst","initOptions","publisherIds","utmTagData","adUnits","bidWon","eventStack","auctionStatus","localStoragePrefix","utmTags","utmTimeoutKey","utmTimeout","sessionTimeout","sessionIdStorageKey","sessionTimeoutKey","getParameterByName","param","vars","location","href","replace","hash","m","key","value","undefined","buildSessionIdLocalStorageKey","concat","buildSessionIdTimeoutLocalStorageKey","updateSessionId","isSessionIdTimeoutExpired","newSessionId","generateUUID","localStorage","setItem","sessionId","getSessionId","updateSessionIdTimeout","Date","now","cpmSessionTimestamp","getItem","updateUtmTimeout","buildUtmLocalStorageTimeoutKey","isUtmTimeoutExpired","utmTimestamp","buildUtmLocalStorageKey","utmMarkKey","checkOptions","checkAdUnitConfig","buildBidWon","includes","adUnitCode","buildEventStack","filterBidsByAdUnit","bids","filteredBids","bid","placementCode","isValidEvent","validationEvents","isValidEventStack","some","isValidBidWon","flushEventStack","flushBidWon","roxotAdapter","info","ad","send","pushEvent","originEnableAnalytics","buildUtmTagData","logInfo","utmTagsDetected","utmTagKey","utmTagValue","data","sendDataType","fullUrl","join","hostname","xhr","XMLHttpRequest","open","setRequestHeader","withCredentials","onreadystatechange","result","readyState","registerAnalyticsAdapter","adapter","code"],"mappings":"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","file":"roxotAnalyticsAdapter.js","sourcesContent":["import CONSTANTS from './constants';\nimport { loadScript } from './adloader';\nimport { ajax } from './ajax';\n\nconst events = require('./events');\nconst utils = require('./utils');\n\nconst AUCTION_INIT = CONSTANTS.EVENTS.AUCTION_INIT;\nconst AUCTION_END = CONSTANTS.EVENTS.AUCTION_END;\nconst BID_REQUESTED = CONSTANTS.EVENTS.BID_REQUESTED;\nconst BID_TIMEOUT = CONSTANTS.EVENTS.BID_TIMEOUT;\nconst BID_RESPONSE = CONSTANTS.EVENTS.BID_RESPONSE;\nconst BID_WON = CONSTANTS.EVENTS.BID_WON;\nconst BID_ADJUSTMENT = CONSTANTS.EVENTS.BID_ADJUSTMENT;\nconst SET_TARGETING = CONSTANTS.EVENTS.SET_TARGETING;\n\nconst LIBRARY = 'library';\nconst ENDPOINT = 'endpoint';\nconst BUNDLE = 'bundle';\n\nvar _sampled = true;\n\nexport default function AnalyticsAdapter({ url, analyticsType, global, handler }) {\n  var _queue = [];\n  var _eventCount = 0;\n  var _enableCheck = true;\n  var _handlers;\n\n  if (analyticsType === LIBRARY) {\n    loadScript(url, _emptyQueue);\n  }\n\n  if (analyticsType === ENDPOINT || BUNDLE) {\n    _emptyQueue();\n  }\n\n  return {\n    track: _track,\n    enqueue: _enqueue,\n    enableAnalytics: _enable,\n    disableAnalytics: _disable,\n    getAdapterType: () => analyticsType,\n    getGlobal: () => global,\n    getHandler: () => handler,\n    getUrl: () => url\n  };\n\n  function _track({ eventType, args }) {\n    if (this.getAdapterType() === LIBRARY || BUNDLE) {\n      window[global](handler, eventType, args);\n    }\n\n    if (this.getAdapterType() === ENDPOINT) {\n      _callEndpoint(...arguments);\n    }\n  }\n\n  function _callEndpoint({ eventType, args, callback }) {\n    ajax(url, callback, JSON.stringify({ eventType, args }));\n  }\n\n  function _enqueue({ eventType, args }) {\n    const _this = this;\n\n    if (global && window[global] && eventType && args) {\n      this.track({ eventType, args });\n    } else {\n      _queue.push(function () {\n        _eventCount++;\n        _this.track({ eventType, args });\n      });\n    }\n  }\n\n  function _enable(config) {\n    var _this = this;\n\n    if (typeof config === 'object' && typeof config.options === 'object') {\n      _sampled = typeof config.options.sampling === 'undefined' || Math.random() < parseFloat(config.options.sampling);\n    } else {\n      _sampled = true;\n    }\n\n    if (_sampled) {\n      // first send all events fired before enableAnalytics called\n      events.getEvents().forEach(event => {\n        if (!event) {\n          return;\n        }\n\n        const { eventType, args } = event;\n\n        if (eventType !== BID_TIMEOUT) {\n          _enqueue.call(_this, { eventType, args });\n        }\n      });\n\n      // Next register event listeners to send data immediately\n\n      _handlers = {\n        [BID_REQUESTED]: args => this.enqueue({ eventType: BID_REQUESTED, args }),\n        [BID_RESPONSE]: args => this.enqueue({ eventType: BID_RESPONSE, args }),\n        [BID_TIMEOUT]: args => this.enqueue({ eventType: BID_TIMEOUT, args }),\n        [BID_WON]: args => this.enqueue({ eventType: BID_WON, args }),\n        [BID_ADJUSTMENT]: args => this.enqueue({ eventType: BID_ADJUSTMENT, args }),\n        [SET_TARGETING]: args => this.enqueue({ eventType: SET_TARGETING, args }),\n        [AUCTION_END]: args => this.enqueue({ eventType: AUCTION_END, args }),\n        [AUCTION_INIT]: args => {\n          args.config = config.options; // enableAnaltyics configuration object\n          this.enqueue({ eventType: AUCTION_INIT, args });\n        }\n      };\n\n      utils._each(_handlers, (handler, event) => {\n        events.on(event, handler);\n      });\n    } else {\n      utils.logMessage(`Analytics adapter for \"${global}\" disabled by sampling`);\n    }\n\n    // finally set this function to return log message, prevents multiple adapter listeners\n    this.enableAnalytics = function _enable() {\n      return utils.logMessage(`Analytics adapter for \"${global}\" already enabled, unnecessary call to \\`enableAnalytics\\`.`);\n    };\n  }\n\n  function _disable() {\n    utils._each(_handlers, (handler, event) => {\n      events.off(event, handler);\n    });\n  }\n\n  function _emptyQueue() {\n    if (_enableCheck) {\n      for (var i = 0; i < _queue.length; i++) {\n        _queue[i]();\n      }\n\n      // override push to execute the command immediately from now on\n      _queue.push = function (fn) {\n        fn();\n      };\n\n      _enableCheck = false;\n    }\n\n    utils.logMessage(`event count sent to ${global}: ${_eventCount}`);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/AnalyticsAdapter.js","import adapter from 'src/AnalyticsAdapter';\nimport CONSTANTS from 'src/constants.json';\nimport adaptermanager from 'src/adaptermanager';\n\nconst utils = require('src/utils');\n\nconst url = '//pa.rxthdr.com/analytic';\nconst analyticsType = 'endpoint';\n\nlet auctionInitConst = CONSTANTS.EVENTS.AUCTION_INIT;\nlet auctionEndConst = CONSTANTS.EVENTS.AUCTION_END;\nlet bidWonConst = CONSTANTS.EVENTS.BID_WON;\nlet bidRequestConst = CONSTANTS.EVENTS.BID_REQUESTED;\nlet bidAdjustmentConst = CONSTANTS.EVENTS.BID_ADJUSTMENT;\nlet bidResponseConst = CONSTANTS.EVENTS.BID_RESPONSE;\n\nlet initOptions = { publisherIds: [], utmTagData: [], adUnits: [] };\nlet bidWon = {options: {}, events: []};\nlet eventStack = {options: {}, events: []};\n\nlet auctionStatus = 'not_started';\n\nlet localStoragePrefix = 'roxot_analytics_';\nlet utmTags = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content'];\nlet utmTimeoutKey = 'utm_timeout';\nlet utmTimeout = 60 * 60 * 1000;\nlet sessionTimeout = 60 * 60 * 1000;\nlet sessionIdStorageKey = 'session_id';\nlet sessionTimeoutKey = 'session_timeout';\n\nfunction getParameterByName(param) {\n  let vars = {};\n  window.location.href.replace(location.hash, '').replace(\n    /[?&]+([^=&]+)=?([^&]*)?/gi,\n    function(m, key, value) {\n      vars[key] = value !== undefined ? value : '';\n    }\n  );\n\n  return vars[param] ? vars[param] : '';\n}\n\nfunction buildSessionIdLocalStorageKey() {\n  return localStoragePrefix.concat(sessionIdStorageKey);\n}\n\nfunction buildSessionIdTimeoutLocalStorageKey() {\n  return localStoragePrefix.concat(sessionTimeoutKey);\n}\n\nfunction updateSessionId() {\n  if (isSessionIdTimeoutExpired()) {\n    let newSessionId = utils.generateUUID();\n    localStorage.setItem(buildSessionIdLocalStorageKey(), newSessionId);\n  }\n  initOptions.sessionId = getSessionId();\n  updateSessionIdTimeout();\n}\n\nfunction updateSessionIdTimeout() {\n  localStorage.setItem(buildSessionIdTimeoutLocalStorageKey(), Date.now());\n}\n\nfunction isSessionIdTimeoutExpired() {\n  let cpmSessionTimestamp = localStorage.getItem(buildSessionIdTimeoutLocalStorageKey());\n  return Date.now() - cpmSessionTimestamp > sessionTimeout;\n}\n\nfunction getSessionId() {\n  return localStorage.getItem(buildSessionIdLocalStorageKey()) ? localStorage.getItem(buildSessionIdLocalStorageKey()) : '';\n}\n\nfunction updateUtmTimeout() {\n  localStorage.setItem(buildUtmLocalStorageTimeoutKey(), Date.now());\n}\n\nfunction isUtmTimeoutExpired() {\n  let utmTimestamp = localStorage.getItem(buildUtmLocalStorageTimeoutKey());\n  return (Date.now() - utmTimestamp) > utmTimeout;\n}\n\nfunction buildUtmLocalStorageTimeoutKey() {\n  return localStoragePrefix.concat(utmTimeoutKey);\n}\n\nfunction buildUtmLocalStorageKey(utmMarkKey) {\n  return localStoragePrefix.concat(utmMarkKey);\n}\n\nfunction checkOptions() {\n  if (typeof initOptions.publisherIds === 'undefined') {\n    return false;\n  }\n\n  return initOptions.publisherIds.length > 0;\n}\n\nfunction checkAdUnitConfig() {\n  if (typeof initOptions.adUnits === 'undefined') {\n    return false;\n  }\n\n  return initOptions.adUnits.length > 0;\n}\n\nfunction buildBidWon(eventType, args) {\n  bidWon.options = initOptions;\n  if (checkAdUnitConfig()) {\n    if (initOptions.adUnits.includes(args.adUnitCode)) {\n      bidWon.events = [{ args: args, eventType: eventType }];\n    }\n  } else {\n    bidWon.events = [{ args: args, eventType: eventType }];\n  }\n}\n\nfunction buildEventStack() {\n  eventStack.options = initOptions;\n}\n\nfunction filterBidsByAdUnit(bids) {\n  var filteredBids = [];\n  bids.forEach(function (bid) {\n    if (initOptions.adUnits.includes(bid.placementCode)) {\n      filteredBids.push(bid);\n    }\n  });\n  return filteredBids;\n}\n\nfunction isValidEvent(eventType, adUnitCode) {\n  if (checkAdUnitConfig()) {\n    let validationEvents = [bidAdjustmentConst, bidResponseConst, bidWonConst];\n    if (!initOptions.adUnits.includes(adUnitCode) && validationEvents.includes(eventType)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction isValidEventStack() {\n  if (eventStack.events.length > 0) {\n    return eventStack.events.some(function(event) {\n      return bidRequestConst === event.eventType || bidWonConst === event.eventType;\n    });\n  }\n  return false;\n}\n\nfunction isValidBidWon() {\n  return bidWon.events.length > 0;\n}\n\nfunction flushEventStack() {\n  eventStack.events = [];\n}\n\nfunction flushBidWon() {\n  bidWon.events = [];\n}\n\nlet roxotAdapter = Object.assign(adapter({url, analyticsType}),\n  {\n    track({eventType, args}) {\n      if (!checkOptions()) {\n        return;\n      }\n\n      let info = Object.assign({}, args);\n\n      if (info && info.ad) {\n        info.ad = '';\n      }\n\n      if (eventType === auctionInitConst) {\n        auctionStatus = 'started';\n        flushEventStack();\n      }\n\n      if (eventType === bidWonConst && auctionStatus === 'not_started') {\n        updateSessionId();\n        buildBidWon(eventType, info);\n        if (isValidBidWon()) {\n          send(eventType, bidWon, 'bidWon');\n        }\n        flushBidWon();\n        return;\n      }\n\n      if (eventType === auctionEndConst) {\n        updateSessionId();\n        buildEventStack(eventType);\n        if (isValidEventStack()) {\n          send(eventType, eventStack, 'eventStack');\n        }\n        flushEventStack();\n        auctionStatus = 'not_started';\n      } else {\n        pushEvent(eventType, info);\n      }\n    },\n\n  });\n\nroxotAdapter.originEnableAnalytics = roxotAdapter.enableAnalytics;\n\nroxotAdapter.enableAnalytics = function (config) {\n  initOptions = config.options;\n  initOptions.utmTagData = this.buildUtmTagData();\n  utils.logInfo('Roxot Analytics enabled with config', initOptions);\n  roxotAdapter.originEnableAnalytics(config);\n};\n\nroxotAdapter.buildUtmTagData = function () {\n  let utmTagData = {};\n  let utmTagsDetected = false;\n  utmTags.forEach(function(utmTagKey) {\n    let utmTagValue = getParameterByName(utmTagKey);\n    if (utmTagValue !== '') {\n      utmTagsDetected = true;\n    }\n    utmTagData[utmTagKey] = utmTagValue;\n  });\n  utmTags.forEach(function(utmTagKey) {\n    if (utmTagsDetected) {\n      localStorage.setItem(buildUtmLocalStorageKey(utmTagKey), utmTagData[utmTagKey]);\n      updateUtmTimeout();\n    } else {\n      if (!isUtmTimeoutExpired()) {\n        utmTagData[utmTagKey] = localStorage.getItem(buildUtmLocalStorageKey(utmTagKey)) ? localStorage.getItem(buildUtmLocalStorageKey(utmTagKey)) : '';\n        updateUtmTimeout();\n      }\n    }\n  });\n  return utmTagData;\n};\n\nfunction send(eventType, data, sendDataType) {\n  let fullUrl = url + '?publisherIds[]=' + initOptions.publisherIds.join('&publisherIds[]=') + '&host=' + window.location.hostname;\n  let xhr = new XMLHttpRequest();\n  xhr.open('POST', fullUrl, true);\n  xhr.setRequestHeader('Content-Type', 'text/plain');\n  xhr.withCredentials = true;\n  xhr.onreadystatechange = function(result) {\n    if (this.readyState != 4) return;\n\n    utils.logInfo('Event ' + eventType + ' sent ' + sendDataType + ' to roxot prebid analytic with result' + result);\n  }\n  xhr.send(JSON.stringify(data));\n};\n\nfunction pushEvent(eventType, args) {\n  if (eventType === bidRequestConst) {\n    if (checkAdUnitConfig()) {\n      args.bids = filterBidsByAdUnit(args.bids);\n    }\n    if (args.bids.length > 0) {\n      eventStack.events.push({ eventType: eventType, args: args });\n    }\n  } else {\n    if (isValidEvent(eventType, args.adUnitCode)) {\n      eventStack.events.push({ eventType: eventType, args: args });\n    }\n  }\n}\n\nadaptermanager.registerAnalyticsAdapter({\n  adapter: roxotAdapter,\n  code: 'roxot'\n});\n\nexport default roxotAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/roxotAnalyticsAdapter.js"],"sourceRoot":""}