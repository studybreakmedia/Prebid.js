{"version":3,"sources":["webpack:///./modules/roxotBidAdapter.js"],"names":["CONSTANTS","require","utils","bidfactory","bidmanager","adloader","adaptermanager","RoxotAdapter","roxotUrl","pbjs","roxotResponseHandler","callBids","_callBids","bidReqs","logInfo","domain","window","location","host","page","pathname","search","hash","roxotBidReqs","id","getUniqueIdentifierStr","bids","site","scriptUrl","REPO_AND_VERSION","encodeURIComponent","JSON","stringify","loadScript","roxotResponseObject","placements","isResponseInvalid","fillPlacementEmptyBid","forEach","pushRoxotBid","allBidResponse","Array","isArray","length","roxotBid","placementCode","bidReq","_bidsRequested","find","bidSet","bidderCode","bid","bidId","pushErrorBid","status","STATUS","GOOD","push","cpm","responseNurl","nurl","createBid","creative_id","ad","decodeURIComponent","adm","width","parseInt","w","height","h","addBidResponse","places","fillIfNotFilled","contains","bidRequest","registerBidAdapter","module","exports"],"mappings":"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","file":"roxotBidAdapter.js","sourcesContent":["var CONSTANTS = require('src/constants.json');\nvar utils = require('src/utils.js');\nvar bidfactory = require('src/bidfactory.js');\nvar bidmanager = require('src/bidmanager.js');\nvar adloader = require('src/adloader');\nvar adaptermanager = require('src/adaptermanager');\n\nvar RoxotAdapter = function RoxotAdapter() {\n  var roxotUrl = 'r.rxthdr.com';\n\n  pbjs.roxotResponseHandler = roxotResponseHandler;\n\n  return {\n    callBids: _callBids\n  };\n\n  function _callBids(bidReqs) {\n    utils.logInfo('callBids roxot adapter invoking');\n\n    var domain = window.location.host;\n    var page = window.location.pathname + location.search + location.hash;\n\n    var roxotBidReqs = {\n      id: utils.getUniqueIdentifierStr(),\n      bids: bidReqs,\n      site: {\n        domain: domain,\n        page: page\n      }\n    };\n\n    var scriptUrl = '//' + roxotUrl + '?callback=pbjs.roxotResponseHandler' +\n      '&src=' + CONSTANTS.REPO_AND_VERSION +\n      '&br=' + encodeURIComponent(JSON.stringify(roxotBidReqs));\n\n    adloader.loadScript(scriptUrl);\n  }\n\n  function roxotResponseHandler(roxotResponseObject) {\n    utils.logInfo('roxotResponseHandler invoking');\n    var placements = [];\n\n    if (isResponseInvalid()) {\n      return fillPlacementEmptyBid();\n    }\n\n    roxotResponseObject.bids.forEach(pushRoxotBid);\n    var allBidResponse = fillPlacementEmptyBid(placements);\n    utils.logInfo('roxotResponse handler finish');\n\n    return allBidResponse;\n\n    function isResponseInvalid() {\n      return !roxotResponseObject || !roxotResponseObject.bids || !Array.isArray(roxotResponseObject.bids) || roxotResponseObject.bids.length <= 0;\n    }\n\n    function pushRoxotBid(roxotBid) {\n      var placementCode = '';\n\n      var bidReq = pbjs\n        ._bidsRequested.find(bidSet => bidSet.bidderCode === 'roxot')\n        .bids.find(bid => bid.bidId === roxotBid.bidId);\n\n      if (!bidReq) {\n        return pushErrorBid(placementCode);\n      }\n\n      bidReq.status = CONSTANTS.STATUS.GOOD;\n\n      placementCode = bidReq.placementCode;\n      placements.push(placementCode);\n\n      var cpm = roxotBid.cpm;\n      var responseNurl = '<img src=\"' + roxotBid.nurl + '\">';\n\n      if (!cpm) {\n        return pushErrorBid(placementCode);\n      }\n\n      var bid = bidfactory.createBid(1, bidReq);\n\n      bid.creative_id = roxotBid.id;\n      bid.bidderCode = 'roxot';\n      bid.cpm = cpm;\n      bid.ad = decodeURIComponent(roxotBid.adm + responseNurl);\n      bid.width = parseInt(roxotBid.w);\n      bid.height = parseInt(roxotBid.h);\n\n      bidmanager.addBidResponse(placementCode, bid);\n    }\n\n    function fillPlacementEmptyBid(places) {\n      pbjs\n        ._bidsRequested.find(bidSet => bidSet.bidderCode === 'roxot')\n        .bids.forEach(fillIfNotFilled);\n\n      function fillIfNotFilled(bid) {\n        if (utils.contains(places, bid.placementCode)) {\n          return null;\n        }\n\n        pushErrorBid(bid);\n      }\n    }\n\n    function pushErrorBid(bidRequest) {\n      var bid = bidfactory.createBid(2, bidRequest);\n      bid.bidderCode = 'roxot';\n      bidmanager.addBidResponse(bidRequest.placementCode, bid);\n    }\n  }\n};\n\nadaptermanager.registerBidAdapter(new RoxotAdapter(), 'roxot');\n\nmodule.exports = RoxotAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/roxotBidAdapter.js"],"sourceRoot":""}