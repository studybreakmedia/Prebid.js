{"version":3,"sources":["webpack:///./modules/spotxBidAdapter.js"],"names":["utils","Spotx","baseAdapter","bidReq","KVP_Object","_defaultBidderSettings","alwaysUseBid","adserverTargeting","key","val","bidResponse","spotx_ad_key","registerDefaultBidderSetting","callBids","bidRequest","bids","length","validateParams","console","log","loadDSDK","channelId","params","video","channel_id","loadScript","initDSDK","options","slot","document","getElementById","video_slot","directAdOS","SpotX","DirectAdOS","getAdServerKVPs","then","adServerKVPs","resp","bid","cmpID","cpm","spotx_bid","url","cur","bidderCode","sizes","isArray","height","width","push","handleResponse","createBid","status","getBidRequest","bidId","bidder","placementCode","requestId","code","GOOD","mediaType","vastUrl","response","addBidResponse","NO_BID","request","undefined","setBidderCode","registerBidAdapter","supportedMediaTypes","module","exports"],"mappings":"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","file":"spotxBidAdapter.js","sourcesContent":["import Adapter from 'src/adapter';\nimport bidfactory from 'src/bidfactory';\nimport bidmanager from 'src/bidmanager';\nimport adLoader from 'src/adloader';\nimport * as utils from 'src/utils';\nimport { STATUS } from 'src/constants';\nimport adaptermanager from 'src/adaptermanager';\n\nfunction Spotx() {\n  let baseAdapter = new Adapter('Spotx');\n  let bidReq;\n  let KVP_Object;\n\n  const _defaultBidderSettings = {\n    alwaysUseBid: true,\n    adserverTargeting: [\n      {\n        key: 'hb_adid',\n        val: function (bidResponse) {\n          return bidResponse.spotx_ad_key;\n        }\n      }\n    ]\n  };\n\n  bidmanager.registerDefaultBidderSetting('spotx', _defaultBidderSettings);\n\n  baseAdapter.callBids = function(bidRequest) {\n    if (!bidRequest || !bidRequest.bids || bidRequest.bids.length === 0) {\n      return;\n    }\n    bidReq = bidRequest.bids[0] || [];\n\n    if (!validateParams(bidReq)) {\n      console.log('Bid Request does not contain valid parameters.');\n      return;\n    }\n\n    loadDSDK();\n  };\n\n  // Load the SpotX Direct AdOS SDK onto the page\n  function loadDSDK() {\n    var channelId = bidReq.params.video.channel_id;\n    adLoader.loadScript('//js.spotx.tv/directsdk/v1/' + channelId + '.js', initDSDK, true);\n  }\n\n  // We have a Direct AdOS SDK! Set options and initialize it!\n  function initDSDK() {\n    var options = bidReq.params.video;\n\n    // If we are passed a id string set the slot and video slot to the element using that id.\n    if (typeof options.slot === 'string') {\n      options.slot = document.getElementById(bidReq.params.video.slot);\n    }\n    if (typeof options.video_slot === 'string') {\n      options.video_slot = document.getElementById(bidReq.params.video.video_slot);\n    }\n\n    var directAdOS = new SpotX.DirectAdOS(options);\n\n    directAdOS.getAdServerKVPs().then(function(adServerKVPs) {\n      // Got an ad back. Build a successful response.\n      var resp = {\n        bids: []\n      };\n      var bid = {};\n\n      bid.cmpID = bidReq.params.video.channel_id;\n      bid.cpm = adServerKVPs.spotx_bid;\n      bid.url = adServerKVPs.spotx_ad_key;\n      bid.cur = 'USD';\n      bid.bidderCode = 'spotx';\n      var sizes = utils.isArray(bidReq.sizes[0]) ? bidReq.sizes[0] : bidReq.sizes;\n      bid.height = sizes[1];\n      bid.width = sizes[0];\n      resp.bids.push(bid);\n      KVP_Object = adServerKVPs;\n      handleResponse(resp);\n    }, function() {\n      // No ad...\n      handleResponse()\n    });\n  }\n\n  function createBid(status) {\n    var bid = bidfactory.createBid(status, utils.getBidRequest(bidReq.bidId));\n\n    // Stuff we have no matter what\n    bid.bidderCode = bidReq.bidder;\n    bid.placementCode = bidReq.placementCode;\n    bid.requestId = bidReq.requestId;\n    bid.code = bidReq.bidder;\n\n    // Stuff we only get with a successful response\n    if (status === STATUS.GOOD && KVP_Object) {\n      let url = '//search.spotxchange.com/ad/vast.html?key=' + KVP_Object.spotx_ad_key;\n      bid.mediaType = 'video';\n\n      bid.cpm = KVP_Object.spotx_bid;\n      bid.vastUrl = url;\n      bid.spotx_ad_key = KVP_Object.spotx_ad_key;\n\n      var sizes = utils.isArray(bidReq.sizes[0]) ? bidReq.sizes[0] : bidReq.sizes;\n      bid.height = sizes[1];\n      bid.width = sizes[0];\n    }\n\n    return bid;\n  }\n\n  /* Notify Prebid of bid responses so bids can get in the auction */\n  function handleResponse(response) {\n    if (!response || !response.bids || !response.bids.length) {\n      bidmanager.addBidResponse(bidReq.placementCode, createBid(STATUS.NO_BID));\n    } else {\n      bidmanager.addBidResponse(bidReq.placementCode, createBid(STATUS.GOOD, response.bids[0]));\n    }\n  }\n\n  function validateParams(request) {\n    if (typeof request.params !== 'object' && typeof request.params.video !== 'object') {\n      return false;\n    }\n\n    // Check that all of our required parameters are defined.\n    if (bidReq.params.video.channel_id === undefined || bidReq.params.video.slot === undefined || bidReq.params.video.video_slot === undefined) {\n      return false;\n    }\n    return true;\n  }\n\n  return Object.assign(this, {\n    callBids: baseAdapter.callBids,\n    setBidderCode: baseAdapter.setBidderCode\n  });\n}\n\nadaptermanager.registerBidAdapter(new Spotx(), 'spotx', {\n  supportedMediaTypes: ['video']\n});\n\nmodule.exports = Spotx;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/spotxBidAdapter.js"],"sourceRoot":""}