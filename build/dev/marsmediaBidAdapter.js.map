{"version":3,"sources":["webpack:///./modules/marsmediaBidAdapter.js"],"names":["utils","MARS_BIDDER_CODE","MARS_BIDDER_URL","MarsmediaBidAdapter","_callBids","bidderRequest","bids","forEach","success","handleBidResponse","error","handleBidError","buildCallParams","bid","err","logError","params","publisherID","res","logMessage","addBid","obj","JSON","parse","Object","keys","length","ad","seatbid","bid_params","createBid","GOOD","sizes","un_id","id","bidderCode","bidder","cpm","Number","price","width","height","adm","cid","seat","addBidResponse","placementCode","bidObj","NO_BID","bidid","bidRequest","floor","isNaN","protocol","window","location","publisher_id","generateUUID","cur","imp","banner","w","h","secure","bidfloor","device","ua","navigator","userAgent","user","app","domain","document","publisher","site","hostname","URL","referrer","stringify","callBids","createNew","registerBidAdapter","module","exports"],"mappings":"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","file":"marsmediaBidAdapter.js","sourcesContent":["import Adapter from 'src/adapter';\nimport bidfactory from 'src/bidfactory';\nimport bidmanager from 'src/bidmanager';\nimport { ajax } from 'src/ajax';\nimport { STATUS } from 'src/constants';\nimport * as utils from 'src/utils';\nimport adaptermanager from 'src/adaptermanager';\n\nconst MARS_BIDDER_CODE = 'marsmedia';\nconst MARS_BIDDER_URL = '//bid306.rtbsrv.com:9306/bidder/?bid=3mhdom';\n\nvar MarsmediaBidAdapter = function MarsmediaBidAdapter() {\n  function _callBids(bidderRequest) {\n    var bids = bidderRequest.bids || [];\n\n    bids.forEach(bid => {\n      try {\n        ajax(\n          MARS_BIDDER_URL,\n          {\n            success: handleBidResponse,\n            error: handleBidError\n          },\n          buildCallParams(bid, bidderRequest),\n          {}\n        );\n      } catch (err) {\n        utils.logError('Error sending marsmedia request for publisher id: ' + bid.params.publisherID, null, err);\n        handleBidError();\n      }\n\n      function handleBidResponse(res) {\n        try {\n          utils.logMessage('Register bid for publisher ID: ' + bid.params.publisherID);\n          addBid(res, bid);\n        } catch (err) {\n          utils.logError('Error processing response for publisher ID: ' + bid.params.publisherID, null, err);\n          handleBidError();\n        }\n      }\n\n      function addBid(res, bid) {\n        var obj;\n        try {\n          obj = JSON.parse(res);\n        } catch (err) {\n          throw 'Faild to parse bid response';\n        }\n\n        if (Object.keys(obj).length === 0 || Object.keys(bid).length === 0) {\n          throw 'Empty Bid';\n        }\n\n        var ad = obj.seatbid[0].bid[0];\n        var bid_params = bidfactory.createBid(STATUS.GOOD, bid);\n        var sizes = bid.sizes[0];\n        bid_params.un_id = obj.id;\n        bid_params.bidderCode = bid.bidder;\n        bid_params.cpm = Number(ad.price);\n        bid_params.price = Number(ad.price);\n        bid_params.width = sizes[0];\n        bid_params.height = sizes[1];\n        bid_params.ad = ad.adm;\n        bid_params.cid = ad.cid;\n        bid_params.seat = obj.seatbid[0].seat;\n\n        bidmanager.addBidResponse(bid.placementCode, bid_params);\n      }\n\n      function handleBidError() {\n        var bidObj = bidfactory.createBid(STATUS.NO_BID, bid);\n        bidObj.bidderCode = bid.bidder;\n        bidmanager.addBidResponse(bid.bidid, bidObj);\n      }\n    });\n  }\n\n  function buildCallParams(bidRequest) {\n    if (typeof bidRequest.params === 'undefined') {\n      throw 'No params';\n    }\n\n    if (typeof bidRequest.sizes === 'undefined' || bidRequest.sizes.length === 0) {\n      throw 'No sizes';\n    }\n\n    if (typeof bidRequest.params.floor === 'undefined') {\n      throw 'No floor';\n    } else if (isNaN(Number(bidRequest.params.floor))) {\n      throw 'Floor must be numeric value';\n    }\n\n    var sizes = bidRequest.sizes[0];\n    var floor = (typeof bidRequest.params.floor !== 'undefined' && bidRequest.params.floor === '') ? 0 : bidRequest.params.floor;\n    var protocol = (window.location.protocol === 'https') ? 1 : 0;\n    var publisher_id = (typeof bidRequest.params.publisherID !== 'undefined') ? bidRequest.params.publisherID : '';\n    var params = {};\n    params.id = utils.generateUUID();\n\n    params.cur = ['USD'];\n\n    params.imp = [{\n      id: params.id,\n      banner: {\n        w: sizes[0],\n        h: sizes[1],\n        secure: protocol\n      },\n      bidfloor: floor\n    }];\n\n    params.device = {\n      ua: navigator.userAgent\n    };\n\n    params.user = {\n      id: publisher_id\n    };\n\n    params.app = {\n      id: params.id,\n      domain: document.domain,\n      publisher: {\n        id: publisher_id\n      }\n    };\n\n    params.site = {\n      'id': publisher_id,\n      'domain': window.location.hostname,\n      'page': document.URL,\n      'ref': document.referrer,\n      'publisher': {\n        'id': publisher_id,\n        'domain': window.location.hostname\n      }\n    };\n\n    params.publisher = {\n      'id': publisher_id,\n      'domain': window.location.hostname\n    };\n\n    return JSON.stringify(params);\n  }\n\n  return Object.assign(new Adapter(MARS_BIDDER_CODE), {\n    callBids: _callBids,\n    createNew: MarsmediaBidAdapter.createNew,\n    buildCallParams: buildCallParams\n  });\n};\n\nMarsmediaBidAdapter.createNew = function() {\n  return new MarsmediaBidAdapter();\n};\n\nadaptermanager.registerBidAdapter(new MarsmediaBidAdapter(), MARS_BIDDER_CODE);\n\nmodule.exports = MarsmediaBidAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/marsmediaBidAdapter.js"],"sourceRoot":""}