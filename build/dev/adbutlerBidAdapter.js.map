{"version":3,"sources":["webpack:///./modules/adbutlerBidAdapter.js"],"names":["utils","BIDDER_CODE","spec","code","pageID","Math","floor","random","isBidRequestValid","bid","params","accountID","zoneID","buildRequests","validBidRequests","i","bidRequest","keyword","domain","requestURI","serverRequests","zoneCounters","length","getBidIdParameter","location","protocol","encodeURIComponent","push","method","url","data","interpretResponse","serverResponse","bidObj","bidResponses","bidResponse","isCorrectSize","isCorrectCPM","CPM","minCPM","maxCPM","width","height","body","status","cpm","parseInt","parseFloat","_each","sizes","size","requestId","bidId","bidderCode","creativeId","placement_id","ad","ad_code","addTrackingPixels","tracking_pixels","currency","netRevenue","ttl","getConfig","referrer","getTopWindowUrl","trackingPixels","trackingPixelMarkup","pixelURL","trackingPixel"],"mappings":"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","file":"adbutlerBidAdapter.js","sourcesContent":["'use strict';\n\nimport * as utils from 'src/utils';\nimport {config} from 'src/config';\nimport {registerBidder} from 'src/adapters/bidderFactory';\n\nconst BIDDER_CODE = 'adbutler';\n\nexport const spec = {\n  code: BIDDER_CODE,\n  pageID: Math.floor(Math.random() * 10e6),\n\n  isBidRequestValid: function (bid) {\n    return !!(bid.params.accountID && bid.params.zoneID);\n  },\n\n  buildRequests: function (validBidRequests) {\n    var i;\n    var zoneID;\n    var bidRequest;\n    var accountID;\n    var keyword;\n    var domain;\n    var requestURI;\n    var serverRequests = [];\n    var zoneCounters = {};\n\n    for (i = 0; i < validBidRequests.length; i++) {\n      bidRequest = validBidRequests[i];\n      zoneID = utils.getBidIdParameter('zoneID', bidRequest.params);\n      accountID = utils.getBidIdParameter('accountID', bidRequest.params);\n      keyword = utils.getBidIdParameter('keyword', bidRequest.params);\n      domain = utils.getBidIdParameter('domain', bidRequest.params);\n\n      if (!(zoneID in zoneCounters)) {\n        zoneCounters[zoneID] = 0;\n      }\n\n      if (typeof domain === 'undefined' || domain.length === 0) {\n        domain = 'servedbyadbutler.com';\n      }\n\n      requestURI = location.protocol + '//' + domain + '/adserve/;type=hbr;';\n      requestURI += 'ID=' + encodeURIComponent(accountID) + ';';\n      requestURI += 'setID=' + encodeURIComponent(zoneID) + ';';\n      requestURI += 'pid=' + encodeURIComponent(spec.pageID) + ';';\n      requestURI += 'place=' + encodeURIComponent(zoneCounters[zoneID]) + ';';\n\n      // append the keyword for targeting if one was passed in\n      if (keyword !== '') {\n        requestURI += 'kw=' + encodeURIComponent(keyword) + ';';\n      }\n\n      zoneCounters[zoneID]++;\n      serverRequests.push({\n        method: 'GET',\n        url: requestURI,\n        data: {},\n        bidRequest: bidRequest\n      });\n    }\n    return serverRequests;\n  },\n\n  interpretResponse: function (serverResponse, bidRequest) {\n    var bidObj = bidRequest.bidRequest;\n    var bidResponses = [];\n    var bidResponse = {};\n    var isCorrectSize = false;\n    var isCorrectCPM = true;\n    var CPM;\n    var minCPM;\n    var maxCPM;\n    var width;\n    var height;\n\n    serverResponse = serverResponse.body;\n    if (serverResponse && serverResponse.status === 'SUCCESS' && bidObj) {\n      CPM = serverResponse.cpm;\n      minCPM = utils.getBidIdParameter('minCPM', bidObj.params);\n      maxCPM = utils.getBidIdParameter('maxCPM', bidObj.params);\n      width = parseInt(serverResponse.width);\n      height = parseInt(serverResponse.height);\n\n      // Ensure response CPM is within the given bounds\n      if (minCPM !== '' && CPM < parseFloat(minCPM)) {\n        isCorrectCPM = false;\n      }\n      if (maxCPM !== '' && CPM > parseFloat(maxCPM)) {\n        isCorrectCPM = false;\n      }\n\n      // Ensure that response ad matches one of the placement sizes.\n      utils._each(bidObj.sizes, function (size) {\n        if (width === size[0] && height === size[1]) {\n          isCorrectSize = true;\n        }\n      });\n      if (isCorrectCPM && isCorrectSize) {\n        bidResponse.requestId = bidObj.bidId;\n        bidResponse.bidderCode = spec.code;\n        bidResponse.creativeId = serverResponse.placement_id;\n        bidResponse.cpm = CPM;\n        bidResponse.width = width;\n        bidResponse.height = height;\n        bidResponse.ad = serverResponse.ad_code;\n        bidResponse.ad += spec.addTrackingPixels(serverResponse.tracking_pixels);\n        bidResponse.currency = 'USD';\n        bidResponse.netRevenue = true;\n        bidResponse.ttl = config.getConfig('_bidderTimeout');\n        bidResponse.referrer = utils.getTopWindowUrl();\n        bidResponses.push(bidResponse);\n      }\n    }\n    return bidResponses;\n  },\n\n  addTrackingPixels: function (trackingPixels) {\n    var trackingPixelMarkup = '';\n    utils._each(trackingPixels, function (pixelURL) {\n      var trackingPixel = '<img height=\"0\" width=\"0\" border=\"0\" style=\"display:none;\" src=\"';\n      trackingPixel += pixelURL;\n      trackingPixel += '\">';\n\n      trackingPixelMarkup += trackingPixel;\n    });\n    return trackingPixelMarkup;\n  }\n};\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/adbutlerBidAdapter.js"],"sourceRoot":""}