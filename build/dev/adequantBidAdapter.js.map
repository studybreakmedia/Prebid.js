{"version":3,"sources":["webpack:///./modules/adequantBidAdapter.js"],"names":["bidfactory","require","bidmanager","adloader","utils","CONSTANTS","adaptermanager","AdequantAdapter","req_url_base","_callBids","params","req_url","publisher_id","sizes","cats","replies","placements","bids","i","length","bid_request","br_params","placementCode","toString","bidfloor","split","br_sizes","parseSizesInput","j","push","join","loadScript","process_bids","placement_code","bid","adequant_creatives","window","seatbid","bid_response","parseInt","impid","createBid","STATUS","GOOD","bidderCode","cpm","price","ad","adm","width","w","height","h","addBidResponse","NO_BID","logMessage","callBids","registerBidAdapter","module","exports"],"mappings":"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","file":"adequantBidAdapter.js","sourcesContent":["var bidfactory = require('src/bidfactory.js');\nvar bidmanager = require('src/bidmanager.js');\nvar adloader = require('src/adloader.js');\nvar utils = require('src/utils.js');\nvar CONSTANTS = require('src/constants.json');\nvar adaptermanager = require('src/adaptermanager');\n\nfunction AdequantAdapter() {\n  var req_url_base = 'https://rex.adequant.com/rex/c2s_prebid?';\n\n  function _callBids(params) {\n    var req_url = [];\n    var publisher_id = null;\n    var sizes = [];\n    var cats = null;\n    var replies = [];\n    var placements = {};\n\n    var bids = params.bids || [];\n    for (var i = 0; i < bids.length; i++) {\n      var bid_request = bids[i];\n      var br_params = bid_request.params || {};\n      placements[bid_request.placementCode] = true;\n\n      publisher_id = br_params.publisher_id.toString() || publisher_id;\n      var bidfloor = br_params.bidfloor || 0.01;\n      cats = br_params.cats || cats;\n      if (typeof (cats) === 'string') { cats = cats.split(' '); }\n      var br_sizes = utils.parseSizesInput(bid_request.sizes);\n      for (var j = 0; j < br_sizes.length; j++) {\n        sizes.push(br_sizes[j] + '_' + bidfloor);\n        replies.push(bid_request.placementCode);\n      }\n    }\n    // send out 1 bid request for all bids\n    if (publisher_id) { req_url.push('a=' + publisher_id); }\n    if (cats) { req_url.push('c=' + cats.join('+')); }\n    if (sizes) { req_url.push('s=' + sizes.join('+')); }\n\n    adloader.loadScript(req_url_base + req_url.join('&'), function() { process_bids(replies, placements); });\n  }\n\n  function process_bids(replies, placements) {\n    var placement_code;\n    var bid;\n    const adequant_creatives = window.adequant_creatives;\n    if (adequant_creatives && adequant_creatives.seatbid) {\n      for (var i = 0; i < adequant_creatives.seatbid.length; i++) {\n        var bid_response = adequant_creatives.seatbid[i].bid[0];\n        placement_code = replies[parseInt(bid_response.impid, 10) - 1];\n        if (!placement_code || !placements[placement_code]) { continue; }\n\n        bid = bidfactory.createBid(CONSTANTS.STATUS.GOOD);\n        bid.bidderCode = 'adequant';\n        bid.cpm = bid_response.price;\n        bid.ad = bid_response.adm;\n        bid.width = bid_response.w;\n        bid.height = bid_response.h;\n        bidmanager.addBidResponse(placement_code, bid);\n        placements[placement_code] = false;\n      }\n    }\n    for (placement_code in placements) {\n      if (placements[placement_code]) {\n        bid = bidfactory.createBid(CONSTANTS.STATUS.NO_BID);\n        bid.bidderCode = 'adequant';\n        bidmanager.addBidResponse(placement_code, bid);\n        utils.logMessage('No bid response from Adequant for placement code ' + placement_code);\n      }\n    }\n  }\n\n  return {\n    callBids: _callBids\n  };\n}\n\nadaptermanager.registerBidAdapter(new AdequantAdapter(), 'adequant');\n\nmodule.exports = AdequantAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/adequantBidAdapter.js"],"sourceRoot":""}