{"version":3,"sources":["webpack:///./modules/smartyadsBidAdapter.js"],"names":["utils","SMARTYADS_BIDDER_CODE","sizeMap","_each","item","key","SmartyadsAdapter","_callBids","bidderRequest","bids","forEach","bid","buildOptimizedCall","bidCallback","undefined","withCredentials","err","logError","placementCode","responseText","logMessage","bidId","handleRpCB","logWarn","badBid","createBid","NO_BID","bidderCode","bidder","error","addBidResponse","startTime","Date","getTime","parsedSizes","masSizeOrdering","Array","isArray","params","sizes","map","size","split","length","secure","window","location","protocol","host","page","pathname","language","navigator","deviceWidth","screen","width","deviceHeight","height","queryString","banner_id","slice","join","reduce","memo","curr","index","encodeURIComponent","bidRequest","ad","JSON","parse","GOOD","creative_id","ad_id","cpm","adm","dealId","deal","callBids","MAS_SIZE_PRIORITY","parseSizesInput","result","mappedSize","parseInt","push","sort","first","second","firstPriority","indexOf","secondPriority","registerBidAdapter","module","exports"],"mappings":"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","file":"smartyadsBidAdapter.js","sourcesContent":["import Adapter from 'src/adapter';\nimport bidfactory from 'src/bidfactory';\nimport bidmanager from 'src/bidmanager';\nimport * as utils from 'src/utils';\nimport {ajax} from 'src/ajax';\nimport {STATUS} from 'src/constants';\nimport adaptermanager from 'src/adaptermanager';\n\nconst SMARTYADS_BIDDER_CODE = 'smartyads';\n\nvar sizeMap = {\n  1: '468x60',\n  2: '728x90',\n  8: '120x600',\n  9: '160x600',\n  10: '300x600',\n  15: '300x250',\n  16: '336x280',\n  19: '300x100',\n  43: '320x50',\n  44: '300x50',\n  48: '300x300',\n  54: '300x1050',\n  55: '970x90',\n  57: '970x250',\n  58: '1000x90',\n  59: '320x80',\n  61: '1000x1000',\n  65: '640x480',\n  67: '320x480',\n  68: '1800x1000',\n  72: '320x320',\n  73: '320x160',\n  83: '480x300',\n  94: '970x310',\n  96: '970x210',\n  101: '480x320',\n  102: '768x1024',\n  113: '1000x300',\n  117: '320x100',\n  125: '800x250',\n  126: '200x600'\n};\n\nutils._each(sizeMap, (item, key) => sizeMap[item] = key);\n\nfunction SmartyadsAdapter() {\n  function _callBids(bidderRequest) {\n    var bids = bidderRequest.bids || [];\n\n    bids.forEach((bid) => {\n      try {\n        ajax(buildOptimizedCall(bid), bidCallback, undefined, { withCredentials: true });\n      } catch (err) {\n        utils.logError('Error sending smartyads request for placement code ' + bid.placementCode, null, err);\n      }\n\n      function bidCallback(responseText) {\n        try {\n          utils.logMessage('XHR callback function called for ad ID: ' + bid.bidId);\n          handleRpCB(responseText, bid);\n        } catch (err) {\n          if (typeof err === 'string') {\n            utils.logWarn(`${err} when processing smartyads response for placement code ${bid.placementCode}`);\n          } else {\n            utils.logError('Error processing smartyads response for placement code ' + bid.placementCode, null, err);\n          }\n\n          // indicate that there is no bid for this placement\n          let badBid = bidfactory.createBid(STATUS.NO_BID, bid);\n          badBid.bidderCode = bid.bidder;\n          badBid.error = err;\n          bidmanager.addBidResponse(bid.placementCode, badBid);\n        }\n      }\n    });\n  }\n\n  function buildOptimizedCall(bid) {\n    bid.startTime = new Date().getTime();\n\n    // use smartyads sizes if provided, otherwise adUnit.sizes\n    var parsedSizes = SmartyadsAdapter.masSizeOrdering(\n      Array.isArray(bid.params.sizes) ? bid.params.sizes.map(size => (sizeMap[size] || '').split('x')) : bid.sizes\n    );\n\n    if (parsedSizes.length < 1) {\n      throw 'no valid sizes';\n    }\n\n    var secure;\n    if (window.location.protocol !== 'http:') {\n      secure = 1;\n    } else {\n      secure = 0;\n    }\n\n    const host = window.location.host;\n    const page = window.location.pathname;\n    const language = navigator.language;\n    const deviceWidth = window.screen.width;\n    const deviceHeight = window.screen.height;\n\n    var queryString = [\n      'banner_id', bid.params.banner_id,\n      'size_ad', parsedSizes[0],\n      'alt_size_ad', parsedSizes.slice(1).join(',') || undefined,\n      'host', host,\n      'page', page,\n      'language', language,\n      'deviceWidth', deviceWidth,\n      'deviceHeight', deviceHeight,\n      'secure', secure,\n      'bidId', bid.bidId,\n      'checkOn', 'rf'\n    ];\n\n    return queryString.reduce(\n      (memo, curr, index) =>\n        index % 2 === 0 && queryString[index + 1] !== undefined\n          ? memo + curr + '=' + encodeURIComponent(queryString[index + 1]) + '&'\n          : memo,\n      '//ssp-nj.webtradehub.com/?'\n    ).slice(0, -1);\n  }\n\n  function handleRpCB(responseText, bidRequest) {\n    let ad = JSON.parse(responseText); // can throw\n\n    var bid = bidfactory.createBid(STATUS.GOOD, bidRequest);\n    bid.creative_id = ad.ad_id;\n    bid.bidderCode = bidRequest.bidder;\n    bid.cpm = ad.cpm || 0;\n    bid.ad = ad.adm;\n    bid.width = ad.width;\n    bid.height = ad.height;\n    bid.dealId = ad.deal;\n\n    bidmanager.addBidResponse(bidRequest.placementCode, bid);\n  }\n\n  return Object.assign(new Adapter(SMARTYADS_BIDDER_CODE), { // SMARTYADS_BIDDER_CODE smartyads\n    callBids: _callBids\n  });\n}\n\nSmartyadsAdapter.masSizeOrdering = function (sizes) {\n  const MAS_SIZE_PRIORITY = [15, 2, 9];\n\n  return utils.parseSizesInput(sizes)\n  // map sizes while excluding non-matches\n    .reduce((result, size) => {\n      let mappedSize = parseInt(sizeMap[size], 10);\n      if (mappedSize) {\n        result.push(mappedSize);\n      }\n      return result;\n    }, [])\n    .sort((first, second) => {\n      // sort by MAS_SIZE_PRIORITY priority order\n      const firstPriority = MAS_SIZE_PRIORITY.indexOf(first);\n      const secondPriority = MAS_SIZE_PRIORITY.indexOf(second);\n\n      if (firstPriority > -1 || secondPriority > -1) {\n        if (firstPriority === -1) {\n          return 1;\n        }\n        if (secondPriority === -1) {\n          return -1;\n        }\n        return firstPriority - secondPriority;\n      }\n\n      return first - second;\n    });\n};\n\nadaptermanager.registerBidAdapter(new SmartyadsAdapter(), 'smartyads');\n\nmodule.exports = SmartyadsAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/smartyadsBidAdapter.js"],"sourceRoot":""}