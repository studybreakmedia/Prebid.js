{"version":3,"sources":["webpack:///./modules/adsupplyBidAdapter.js"],"names":["bidfactory","require","bidmanager","adloader","utils","adaptermanager","ADSUPPLY_CODE","AdSupplyAdapter","_validateParams","params","siteId","zoneId","endpointUrl","clientId","_getRequestUrl","bid","referrerUrl","encodeURIComponent","window","document","referrer","rand","Math","floor","random","time","Date","getTimezoneOffset","pbjs","adSupplyResponseHandler","bidId","bidRequest","getBidRequest","zoneProp","media","Media","Url","Ecpm","noFillbject","createBid","bidderCode","addBidResponse","placementCode","bidObject","cpm","ad","Width","Height","width","height","_makeCallBackHandler","_callBids","bids","i","length","requestUrl","loadScript","callBids","registerBidAdapter","module","exports"],"mappings":"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","file":"adsupplyBidAdapter.js","sourcesContent":["var bidfactory = require('src/bidfactory.js');\nvar bidmanager = require('src/bidmanager.js');\nvar adloader = require('src/adloader');\nvar utils = require('src/utils');\nvar adaptermanager = require('src/adaptermanager');\n\nconst ADSUPPLY_CODE = 'adsupply';\n\nvar AdSupplyAdapter = function AdSupplyAdapter() {\n  function _validateParams(params) {\n    if (!params || !params.siteId || !params.zoneId || !params.endpointUrl || !params.clientId) {\n      return false;\n    }\n\n    if (typeof params.zoneId !== 'number' || params.zoneId <= 0) {\n      return false;\n    }\n\n    return true;\n  }\n\n  function _getRequestUrl(bid) {\n    var referrerUrl = encodeURIComponent(window.document.referrer);\n    var rand = encodeURIComponent(Math.floor(Math.random() * 100000 + 1));\n    var time = encodeURIComponent(new Date().getTimezoneOffset());\n    return '//' + bid.params.endpointUrl + '/banner.engine?id=' + bid.params.siteId + '&z=' + bid.params.zoneId + '&rand=' + rand + '&ver=async' + '&time=' + time + '&referrerurl=' + referrerUrl + '&abr=false' + '&hbt=1&cid=' + encodeURIComponent(bid.params.clientId);\n  }\n\n  pbjs.adSupplyResponseHandler = function (bidId) {\n    if (!bidId) return;\n\n    var bidRequest = utils.getBidRequest(bidId);\n\n    if (!bidRequest || !bidRequest.params) return;\n\n    var clientId = bidRequest.params.clientId;\n    var zoneProp = 'b' + bidRequest.params.zoneId;\n\n    if (!window[clientId] || !window[clientId][zoneProp]) return;\n\n    var media = window[clientId][zoneProp].Media;\n\n    if (!media) return;\n\n    if (!media.Url || !media.Ecpm || typeof media.Ecpm !== 'number' || media.Ecpm <= 0) {\n      var noFillbject = bidfactory.createBid(2, bidRequest);\n      noFillbject.bidderCode = ADSUPPLY_CODE;\n      bidmanager.addBidResponse(bidRequest.placementCode, noFillbject);\n    } else {\n      var bidObject = bidfactory.createBid(1, bidRequest);\n      bidObject.bidderCode = ADSUPPLY_CODE;\n      bidObject.cpm = media.Ecpm;\n      bidObject.ad = '<iframe style=\"z-index: 5000001; margin: 0px; padding: 0px; border: none; width: ' + media.Width + 'px; height: ' + media.Height + 'px; \" src=\"//' + bidRequest.params.endpointUrl + media.Url + '\"></iframe>';\n      bidObject.width = media.Width;\n      bidObject.height = media.Height;\n      bidmanager.addBidResponse(bidRequest.placementCode, bidObject);\n    }\n  };\n\n  function _makeCallBackHandler(bidId) {\n    return function () {\n      pbjs.adSupplyResponseHandler(bidId);\n    };\n  }\n\n  function _callBids(params) {\n    var bids = params.bids || [];\n    for (var i = 0; i < bids.length; i++) {\n      var bid = bids[i];\n      if (!_validateParams(bid.params)) continue;\n\n      var clientId = bid.params.clientId;\n      var zoneProp = 'b' + bid.params.zoneId;\n      window[clientId] = window[clientId] || {};\n      window.window[clientId][zoneProp] = window.window[clientId][zoneProp] || {};\n      window.window[clientId][zoneProp].Media = {};\n\n      var requestUrl = _getRequestUrl(bid);\n      adloader.loadScript(requestUrl, _makeCallBackHandler(bid.bidId));\n    }\n  }\n\n  return {\n    callBids: _callBids\n  };\n};\n\nadaptermanager.registerBidAdapter(new AdSupplyAdapter(), 'adsupply');\n\nmodule.exports = AdSupplyAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/adsupplyBidAdapter.js"],"sourceRoot":""}