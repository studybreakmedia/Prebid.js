{"version":3,"sources":["webpack:///./modules/tapsenseBidAdapter.js"],"names":["bidfactory","require","bidmanager","adloader","utils","adaptermanager","TapSenseAdapter","version","creativeSizes","validParams","SCRIPT_URL","bids","pbjs","tapsense","_callBids","params","i","length","bid","isValidSize","sizes","user","ad_unit_id","parsedSizes","parseSizesInput","k","indexOf","queryString","bidId","generateCallback","keys","Object","j","encodeURIComponent","_requestBids","tapsenseCallback","response","price","bidObj","bidReq","getBidRequest","status","value","count_ad_units","createBid","cpm","width","height","ad","ad_units","html","bidderCode","bidder","addBidResponse","placementCode","logMessage","scriptURL","loadScript","callBids","registerBidAdapter","module","exports"],"mappings":"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","file":"tapsenseBidAdapter.js","sourcesContent":["// v0.0.1\n\nconst bidfactory = require('src/bidfactory.js');\nconst bidmanager = require('src/bidmanager.js');\nconst adloader = require('src/adloader');\nconst utils = require('src/utils.js');\nconst adaptermanager = require('src/adaptermanager');\n\nconst TapSenseAdapter = function TapSenseAdapter() {\n  const version = '0.0.1';\n  const creativeSizes = [\n    '320x50'\n  ];\n  const validParams = [\n    'ufid',\n    'refer',\n    'ad_unit_id', // required\n    'device_id',\n    'lat',\n    'long',\n    'user', // required\n    'price_floor',\n    'test'\n  ];\n  const SCRIPT_URL = 'https://ads04.tapsense.com/ads/headerad';\n  let bids;\n  pbjs.tapsense = {};\n  function _callBids(params) {\n    bids = params.bids || [];\n    for (let i = 0; i < bids.length; i++) {\n      let bid = bids[i];\n      let isValidSize = false;\n      if (!bid.sizes || !bid.params.user || !bid.params.ad_unit_id) {\n        return;\n      }\n      let parsedSizes = utils.parseSizesInput(bid.sizes);\n      for (let k = 0; k < parsedSizes.length; k++) {\n        if (creativeSizes.indexOf(parsedSizes[k]) > -1) {\n          isValidSize = true;\n          break;\n        }\n      }\n      if (isValidSize) {\n        let queryString = `?price=true&jsonp=1&callback=pbjs.tapsense.callback_with_price_${bid.bidId}&version=${version}&`;\n        pbjs.tapsense[`callback_with_price_${bid.bidId}`] = generateCallback(bid.bidId);\n        let keys = Object.keys(bid.params);\n        for (let j = 0; j < keys.length; j++) {\n          if (validParams.indexOf(keys[j]) < 0) continue;\n          queryString += encodeURIComponent(keys[j]) + '=' + encodeURIComponent(bid.params[keys[j]]) + '&';\n        }\n        _requestBids(SCRIPT_URL + queryString);\n      }\n    }\n  }\n\n  function generateCallback(bidId) {\n    return function tapsenseCallback(response, price) {\n      let bidObj;\n      if (response && price) {\n        let bidReq = utils.getBidRequest(bidId);\n        if (response.status.value === 'ok' && response.count_ad_units > 0) {\n          bidObj = bidfactory.createBid(1, bidObj);\n          bidObj.cpm = price;\n          bidObj.width = response.width;\n          bidObj.height = response.height;\n          bidObj.ad = response.ad_units[0].html;\n        } else {\n          bidObj = bidfactory.createBid(2, bidObj);\n        }\n        bidObj.bidderCode = bidReq.bidder;\n        bidmanager.addBidResponse(bidReq.placementCode, bidObj);\n      } else {\n        utils.logMessage('No prebid response');\n      }\n    };\n  }\n\n  function _requestBids(scriptURL) {\n    adloader.loadScript(scriptURL);\n  }\n\n  return {\n    callBids: _callBids\n  };\n};\n\nadaptermanager.registerBidAdapter(new TapSenseAdapter(), 'tapsense');\n\nmodule.exports = TapSenseAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/tapsenseBidAdapter.js"],"sourceRoot":""}