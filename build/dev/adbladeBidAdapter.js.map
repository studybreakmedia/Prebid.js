{"version":3,"sources":["webpack:///./modules/adbladeBidAdapter.js"],"names":["utils","require","bidfactory","bidmanager","adloader","adaptermanager","AdbladeAdapter","BIDDER_CODE","BASE_URI","DEFAULT_BID_FLOOR","_callBids","params","bids","referrer","getTopWindowUrl","loc","getTopWindowLocation","domain","hostname","partnerId","bidRequests","length","_each","bid","sizes","Array","size","key","requestId","window","navigator","userAgent","imp","push","bidId","bidFloor","placementCode","protocol","bidRequest","loadScript","tryAppendQueryString","JSON","stringify","pbjs","adbladeResponse","response","auctionIdRe","auctionPriceRe","clickUrlRe","hasOwnProperty","isEmpty","seatbid","bidsRequested","_bidsRequested","find","bidSet","bidderCode","createBid","addBidResponse","seatbidBid","getBidRequest","impid","ad","adm","createTrackPixelHtml","nurl","replace","price","cpm","width","w","height","h","callBids","registerBidAdapter","module","exports"],"mappings":"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","file":"adbladeBidAdapter.js","sourcesContent":["var utils = require('src/utils.js');\nvar bidfactory = require('src/bidfactory.js');\nvar bidmanager = require('src/bidmanager.js');\nvar adloader = require('src/adloader');\nvar adaptermanager = require('src/adaptermanager');\n\n/**\n * Adapter for requesting bids from Adblade\n * To request an Adblade Header partner account\n * or for additional integration support please\n * register at http://www.adblade.com.\n */\nvar AdbladeAdapter = function AdbladeAdapter() {\n  'use strict';\n\n  const BIDDER_CODE = 'adblade';\n  const BASE_URI = '//rtb.adblade.com/prebidjs/bid?';\n  const DEFAULT_BID_FLOOR = 0.0000000001;\n\n  function _callBids(params) {\n    var bids = params.bids || [];\n    var referrer = utils.getTopWindowUrl();\n    var loc = utils.getTopWindowLocation();\n    var domain = loc.hostname;\n    var partnerId = 0;\n    var bidRequests = {};\n\n    if (bids.length > 0) {\n      partnerId = '' + bids[0].params.partnerId;\n    }\n\n    utils._each(bids, function(bid) {\n      // make sure the \"sizes\" are an array of arrays\n      if (!(bid.sizes[0] instanceof Array)) {\n        bid.sizes = [bid.sizes];\n      }\n      utils._each(bid.sizes, function(size) {\n        let key = size[0] + 'x' + size[1];\n\n        bidRequests[key] = bidRequests[key] || {\n          'site': {\n            'id': partnerId,\n            'page': referrer,\n            'domain': domain,\n            'publisher': {\n              'id': partnerId,\n              'name': referrer,\n              'domain': domain\n            }\n          },\n          'id': params.requestId,\n          'imp': [],\n          'device': {\n            'ua': window.navigator.userAgent,\n          },\n          'cur': ['USD'],\n          'user': {}\n        };\n\n        bidRequests[key].imp.push({\n          'id': bid.bidId,\n          'bidfloor': bid.params.bidFloor || DEFAULT_BID_FLOOR,\n          'tag': bid.placementCode,\n          'banner': {\n            'w': size[0],\n            'h': size[1],\n          },\n          'secure': 0 + (loc.protocol === 'https')\n        });\n      });\n    });\n\n    utils._each(bidRequests, function (bidRequest) {\n      adloader.loadScript(\n        utils.tryAppendQueryString(\n          utils.tryAppendQueryString(\n            BASE_URI,\n            'callback',\n            'pbjs.adbladeResponse'\n          ),\n          'json',\n          JSON.stringify(\n            bidRequest\n          )\n        )\n      );\n    });\n  }\n\n  pbjs.adbladeResponse = function (response) {\n    var auctionIdRe = /\\$(%7B|\\{)AUCTION_ID(%7D|\\})/gi;\n    var auctionPriceRe = /\\$(%7B|\\{)AUCTION_PRICE(%7D|\\})/gi;\n    var clickUrlRe = /\\$(%7B|\\{)CLICK_URL(%7D|\\})/gi;\n\n    if (typeof (response) === 'undefined' || !response.hasOwnProperty('seatbid') || utils.isEmpty(response.seatbid)) {\n      // handle empty bids\n      var bidsRequested = pbjs._bidsRequested.find(bidSet => bidSet.bidderCode === BIDDER_CODE).bids;\n      if (bidsRequested.length > 0) {\n        let bid = bidfactory.createBid(2);\n        bid.bidderCode = BIDDER_CODE;\n        bidmanager.addBidResponse(bidsRequested[0].placementCode, bid);\n      }\n\n      return;\n    }\n\n    utils._each(response.seatbid, function(seatbid) {\n      utils._each(seatbid.bid, function(seatbidBid) {\n        var bidRequest = utils.getBidRequest(seatbidBid.impid);\n        var ad = seatbidBid.adm + utils.createTrackPixelHtml(seatbidBid.nurl);\n\n        ad = ad.replace(auctionIdRe, seatbidBid.impid);\n        ad = ad.replace(clickUrlRe, '');\n        ad = ad.replace(auctionPriceRe, seatbidBid.price);\n\n        let bid = bidfactory.createBid(1);\n\n        bid.bidderCode = BIDDER_CODE;\n        bid.cpm = seatbidBid.price;\n        bid.ad = ad;\n        bid.width = seatbidBid.w;\n        bid.height = seatbidBid.h;\n        bidmanager.addBidResponse(bidRequest.placementCode, bid);\n      });\n    });\n  };\n\n  return {\n    callBids: _callBids\n  };\n};\n\nadaptermanager.registerBidAdapter(new AdbladeAdapter(), 'adblade');\n\nmodule.exports = AdbladeAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/adbladeBidAdapter.js"],"sourceRoot":""}