{"version":3,"sources":["webpack:///./modules/colossussspBidAdapter.js"],"names":["utils","BIDDER_CODE","sizeObj","_each","item","key","ColossusSspAdapter","_callBids","bidderRequest","bids","forEach","bid","bidCallback","responseText","logMessage","bidId","handleRpCB","err","logWarn","placementCode","logError","badBid","createBid","NO_BID","bidderCode","bidder","error","addBidResponse","buildOptimizedCall","undefined","withCredentials","startTime","Date","getTime","parsedSizes","masSizeOrdering","Array","isArray","params","sizes","map","size","split","length","secure","win","window","top","e","location","protocol","host","page","pathname","language","navigator","deviceWidth","screen","width","deviceHeight","height","queryString","placement_id","slice","join","reduce","memo","curr","index","encodeURIComponent","bidRequest","ad","JSON","parse","GOOD","creative_id","ad_id","cpm","adm","dealId","deal","callBids","MAS_SIZE_PRIORITY","parseSizesInput","result","mappedSize","parseInt","push","sort","first","second","firstPriority","indexOf","secondPriority","registerBidAdapter","module","exports"],"mappings":"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","file":"colossussspBidAdapter.js","sourcesContent":["import Adapter from 'src/adapter';\nimport bidfactory from 'src/bidfactory';\nimport bidmanager from 'src/bidmanager';\nimport * as utils from 'src/utils';\nimport {ajax} from 'src/ajax';\nimport {STATUS} from 'src/constants';\nimport adaptermanager from 'src/adaptermanager';\n\nvar BIDDER_CODE = 'colossusssp';\n\nvar sizeObj = {\n  1: '468x60',\n  2: '728x90',\n  10: '300x600',\n  15: '300x250',\n  19: '300x100',\n  43: '320x50',\n  44: '300x50',\n  48: '300x300',\n  54: '300x1050',\n  55: '970x90',\n  57: '970x250',\n  58: '1000x90',\n  59: '320x80',\n  65: '640x480',\n  67: '320x480',\n  72: '320x320',\n  73: '320x160',\n  83: '480x300',\n  94: '970x310',\n  96: '970x210',\n  101: '480x320',\n  102: '768x1024',\n  113: '1000x300',\n  117: '320x100',\n  118: '800x250',\n  119: '200x600'\n};\n\nutils._each(sizeObj, (item, key) => sizeObj[item] = key);\n\nfunction ColossusSspAdapter() {\n  function _callBids(bidderRequest) {\n    var bids = bidderRequest.bids || [];\n\n    bids.forEach((bid) => {\n      function bidCallback(responseText) {\n        try {\n          utils.logMessage('XHR callback function called for ad ID: ' + bid.bidId);\n          handleRpCB(responseText, bid);\n        } catch (err) {\n          if (typeof err === 'string') {\n            utils.logWarn(`${err} when processing colossus response for placement code ${bid.placementCode}`);\n          } else {\n            utils.logError('Error processing colossus response for placement code ' + bid.placementCode, null, err);\n          }\n          var badBid = bidfactory.createBid(STATUS.NO_BID, bid);\n          badBid.bidderCode = bid.bidder;\n          badBid.error = err;\n          bidmanager.addBidResponse(bid.placementCode, badBid);\n        }\n      }\n\n      try {\n        ajax(buildOptimizedCall(bid), bidCallback, undefined, { withCredentials: true });\n      } catch (err) {\n        utils.logError('Error sending colossus request for placement code ' + bid.placementCode, null, err);\n      }\n    });\n  }\n\n  function buildOptimizedCall(bid) {\n    bid.startTime = (new Date()).getTime();\n\n    var parsedSizes = ColossusSspAdapter.masSizeOrdering(\n      Array.isArray(bid.params.sizes) ? bid.params.sizes.map(size => (sizeObj[size] || '').split('x')) : bid.sizes\n    );\n\n    if (parsedSizes.length < 1) {\n      throw 'no valid sizes';\n    }\n\n    var secure = 0;\n    var win;\n    try {\n      win = window.top;\n    } catch (e) {\n      win = window;\n    }\n\n    if (win.location.protocol !== 'http:') {\n      secure = 1;\n    }\n\n    var host = win.location.host;\n    var page = win.location.pathname;\n    var language = navigator.language;\n    var deviceWidth = win.screen.width;\n    var deviceHeight = win.screen.height;\n\n    var queryString = [\n      'banner_id', bid.params.placement_id,\n      'size_ad', parsedSizes[0],\n      'alt_size_ad', parsedSizes.slice(1).join(',') || [],\n      'host', host,\n      'page', page,\n      'language', language,\n      'deviceWidth', deviceWidth,\n      'deviceHeight', deviceHeight,\n      'secure', secure,\n      'bidId', bid.bidId,\n      'checkOn', 'rf'\n    ];\n\n    return queryString.reduce(\n      (memo, curr, index) =>\n        index % 2 === 0 && queryString[index + 1] !== undefined\n          ? memo + curr + '=' + encodeURIComponent(queryString[index + 1]) + '&'\n          : memo,\n      '//colossusssp.com/?'\n    ).slice(0, -1);\n  }\n\n  function handleRpCB(responseText, bidRequest) {\n    var ad = JSON.parse(responseText);\n\n    var bid = bidfactory.createBid(STATUS.GOOD, bidRequest);\n    bid.creative_id = ad.ad_id;\n    bid.bidderCode = bidRequest.bidder;\n    bid.cpm = ad.cpm || 0;\n    bid.ad = ad.adm;\n    bid.width = ad.width;\n    bid.height = ad.height;\n    bid.dealId = ad.deal;\n\n    bidmanager.addBidResponse(bidRequest.placementCode, bid);\n  }\n\n  return Object.assign(new Adapter(BIDDER_CODE), { // BIDDER_CODE colossusssp\n    callBids: _callBids\n  });\n}\n\nColossusSspAdapter.masSizeOrdering = function (sizes) {\n  var MAS_SIZE_PRIORITY = [15, 2, 9];\n  return utils.parseSizesInput(sizes)\n    .reduce((result, size) => {\n      var mappedSize = parseInt(sizeObj[size], 10);\n      if (mappedSize) {\n        result.push(mappedSize);\n      }\n      return result;\n    }, [])\n    .sort((first, second) => {\n      var firstPriority = MAS_SIZE_PRIORITY.indexOf(first);\n      var secondPriority = MAS_SIZE_PRIORITY.indexOf(second);\n\n      if (firstPriority > -1 || secondPriority > -1) {\n        if (firstPriority === -1) {\n          return 1;\n        }\n        if (secondPriority === -1) {\n          return -1;\n        }\n        return firstPriority - secondPriority;\n      }\n\n      return first - second;\n    });\n};\n\nadaptermanager.registerBidAdapter(new ColossusSspAdapter(), BIDDER_CODE);\n\nmodule.exports = ColossusSspAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/colossussspBidAdapter.js"],"sourceRoot":""}