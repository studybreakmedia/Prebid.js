{"version":3,"sources":["webpack:///./modules/mantisBidAdapter.js"],"names":["bidfactory","require","bidmanager","adloader","constants","adaptermanager","MantisAdapter","inIframe","window","self","top","mantis_link","e","isDesktop","ignoreTouch","scope","win","width","innerWidth","document","documentElement","clientWidth","body","supportsTouch","navigator","msMaxTouchPoints","mantis_breakpoint","ex","isSendable","val","undefined","test","isNaN","isObject","value","Object","prototype","toString","call","isAmp","context","tagName","isSecure","location","protocol","isArray","jsonp","callback","mantis_jsonp","push","length","jsonToQuery","data","chain","form","parts","key","queryKey","index","akey","aval","encodeURIComponent","join","buildMantisUrl","path","domain","params","referrer","tz","Date","getTimezoneOffset","buster","getTime","secure","mobile","mantis_uuid","uuid","localStorage","localUuid","getItem","title","url","href","iframe","canonicalUrl","keys","forEach","query","mantis_domain","Prebid","callBids","property","bids","some","bid","resp","ad","ads","bidId","bidObject","createBid","STATUS","GOOD","bidderCode","cpm","html","height","NO_BID","addBidResponse","placementCode","map","config","sizes","size","version","loadScript","registerBidAdapter","module","exports"],"mappings":"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","file":"mantisBidAdapter.js","sourcesContent":["var bidfactory = require('src/bidfactory.js');\nvar bidmanager = require('src/bidmanager.js');\nvar adloader = require('src/adloader');\nvar constants = require('src/constants.json');\nvar adaptermanager = require('src/adaptermanager');\n\nfunction MantisAdapter () {\n  function inIframe() {\n    try {\n      return window.self !== window.top && !window.mantis_link;\n    } catch (e) {\n      return true;\n    }\n  }\n\n  function isDesktop(ignoreTouch) {\n    var scope = function (win) {\n      var width = win.innerWidth || win.document.documentElement.clientWidth || win.document.body.clientWidth;\n      var supportsTouch = !ignoreTouch && ('ontouchstart' in window || navigator.msMaxTouchPoints);\n\n      return !supportsTouch && (!width || width >= (window.mantis_breakpoint || 768));\n    };\n\n    if (inIframe()) {\n      try {\n        return scope(window.top);\n      } catch (ex) {\n      }\n    }\n\n    return scope(window);\n  }\n\n  function isSendable(val) {\n    if (val === null || val === undefined) {\n      return false;\n    }\n\n    if (typeof val === 'string') {\n      return !(!val || /^\\s*$/.test(val));\n    }\n\n    if (typeof val === 'number') {\n      return !isNaN(val);\n    }\n\n    return true;\n  }\n\n  function isObject(value) {\n    return Object.prototype.toString.call(value) === '[object Object]';\n  }\n\n  function isAmp() {\n    return typeof window.context === 'object' && (window.context.tagName === 'AMP-AD' || window.context.tagName === 'AMP-EMBED');\n  }\n\n  function isSecure() {\n    return document.location.protocol === 'https:';\n  }\n\n  function isArray(value) {\n    return Object.prototype.toString.call(value) === '[object Array]';\n  }\n\n  function jsonp(callback) {\n    if (!window.mantis_jsonp) {\n      window.mantis_jsonp = [];\n    }\n\n    window.mantis_jsonp.push(callback);\n\n    return 'mantis_jsonp[' + (window.mantis_jsonp.length - 1) + ']';\n  }\n\n  function jsonToQuery(data, chain, form) {\n    if (!data) {\n      return null;\n    }\n\n    var parts = form || [];\n\n    for (var key in data) {\n      var queryKey = key;\n\n      if (chain) {\n        queryKey = chain + '[' + key + ']';\n      }\n\n      var val = data[key];\n\n      if (isArray(val)) {\n        for (var index = 0; index < val.length; index++) {\n          var akey = queryKey + '[' + index + ']';\n          var aval = val[index];\n\n          if (isObject(aval)) {\n            jsonToQuery(aval, akey, parts);\n          } else if (isSendable(aval)) {\n            parts.push(akey + '=' + encodeURIComponent(aval));\n          }\n        }\n      } else if (isObject(val)) {\n        jsonToQuery(val, queryKey, parts);\n      } else if (isSendable(val)) {\n        parts.push(queryKey + '=' + encodeURIComponent(val));\n      }\n    }\n\n    return parts.join('&');\n  }\n\n  function buildMantisUrl(path, data, domain) {\n    var params = {\n      referrer: document.referrer,\n      tz: new Date().getTimezoneOffset(),\n      buster: new Date().getTime(),\n      secure: isSecure()\n    };\n\n    if (!inIframe() || isAmp()) {\n      params.mobile = !isAmp() && isDesktop(true) ? 'false' : 'true';\n    }\n\n    if (window.mantis_uuid) {\n      params.uuid = window.mantis_uuid;\n    } else if (window.localStorage) {\n      var localUuid = window.localStorage.getItem('mantis:uuid');\n\n      if (localUuid) {\n        params.uuid = localUuid;\n      }\n    }\n\n    if (!inIframe()) {\n      try {\n        params.title = window.top.document.title;\n        params.referrer = window.top.document.referrer;\n        params.url = window.top.document.location.href;\n      } catch (ex) {\n\n      }\n    } else {\n      params.iframe = true;\n    }\n\n    if (isAmp()) {\n      if (!params.url && window.context.canonicalUrl) {\n        params.url = window.context.canonicalUrl;\n      }\n\n      if (!params.url && window.context.location) {\n        params.url = window.context.location.href;\n      }\n\n      if (!params.referrer && window.context.referrer) {\n        params.referrer = window.context.referrer;\n      }\n    }\n\n    Object.keys(data || {}).forEach(function (key) {\n      params[key] = data[key];\n    });\n\n    var query = jsonToQuery(params);\n\n    return (window.mantis_domain === undefined ? domain || 'https://mantodea.mantisadnetwork.com' : window.mantis_domain) + path + '?' + query;\n  }\n\n  var Prebid = function (bidfactory, bidmanager, adloader, constants) {\n    return {\n      callBids: function (params) {\n        var property = null;\n\n        params.bids.some(function (bid) {\n          if (bid.params.property) {\n            property = bid.params.property;\n\n            return true;\n          }\n        });\n\n        var url = {\n          jsonp: jsonp(function (resp) {\n            params.bids.forEach(function (bid) {\n              var ad = resp.ads[bid.bidId];\n\n              var bidObject;\n\n              if (ad) {\n                bidObject = bidfactory.createBid(constants.STATUS.GOOD);\n                bidObject.bidderCode = 'mantis';\n                bidObject.cpm = ad.cpm;\n                bidObject.ad = ad.html;\n                bidObject.width = ad.width;\n                bidObject.height = ad.height;\n              } else {\n                bidObject = bidfactory.createBid(constants.STATUS.NO_BID);\n                bidObject.bidderCode = 'mantis';\n              }\n\n              bidmanager.addBidResponse(bid.placementCode, bidObject);\n            });\n          }),\n          property: property,\n          bids: params.bids.map(function (bid) {\n            return {\n              bidId: bid.bidId,\n              config: bid.params,\n              sizes: bid.sizes.map(function (size) {\n                return {width: size[0], height: size[1]};\n              })\n            };\n          }),\n          version: 1\n        };\n\n        adloader.loadScript(buildMantisUrl('/website/prebid', url));\n      }\n    };\n  };\n\n  return new Prebid(bidfactory, bidmanager, adloader, constants);\n}\n\nadaptermanager.registerBidAdapter(new MantisAdapter(), 'mantis');\n\nmodule.exports = MantisAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/mantisBidAdapter.js"],"sourceRoot":""}