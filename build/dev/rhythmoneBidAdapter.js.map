{"version":3,"sources":["webpack:///./modules/rhythmoneBidAdapter.js"],"names":["RhythmOneBidAdapter","code","supportedMediaTypes","isBidRequestValid","bid","getFirstParam","key","validBidRequests","i","length","params","slotsToBids","that","version","buildRequests","BRs","fallbackPlacementId","undefined","query","w","window","p","k","v","Array","join","push","encodeURIComponent","attempt","valueFunction","defaultValue","ex","d","document","location","ancestorOrigins","top","hostname","l","href","toString","getRMPUrl","url","defaultZone","defaultPath","replace","title","screen","height","width","Date","getTimezoneOffset","test","navigator","userAgent","n","plugins","m","mimeTypes","t","x","ActiveXObject","enabledPlugin","e","heights","widths","floors","mediaTypes","configuredPlacements","fat","pbjs","th","tw","adUnitCode","placementCode","sizes","j","video","floor","method","interpretResponse","serverResponse","responses","body","bids","seatbid","temp","bidRequest","impid","bidResponse","requestId","bidId","bidderCode","cpm","parseFloat","price","h","creativeId","crid","currency","netRevenue","ttl","vastUrl","nurl","ad","adm","spec"],"mappings":";;;;;;;;;;;;;;;AAAA;;;;;;;AAEA;;AACA;;AAEA,SAASA,mBAAT,GAA+B;AAC7B,OAAKC,IAAL,GAAY,WAAZ;AACA,OAAKC,mBAAL,GAA2B,uCAA3B;;AAEA,OAAKC,iBAAL,GAAyB,UAAUC,GAAV,EAAe;AACtC,WAAO,IAAP;AACD,GAFD;;AAIA,WAASC,aAAT,CAAuBC,GAAvB,EAA4BC,gBAA5B,EAA8C;AAC5C,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,iBAAiBE,MAArC,EAA6CD,GAA7C,EAAkD;AAChD,UAAID,iBAAiBC,CAAjB,EAAoBE,MAApB,IAA8BH,iBAAiBC,CAAjB,EAAoBE,MAApB,CAA2BJ,GAA3B,CAAlC,EAAmE;AACjE,eAAOC,iBAAiBC,CAAjB,EAAoBE,MAApB,CAA2BJ,GAA3B,CAAP;AACD;AACF;AACF;;AAED,MAAIK,cAAc,EAAlB;AACA,MAAIC,OAAO,IAAX;AACA,MAAIC,UAAU,SAAd;;AAEA,OAAKC,aAAL,GAAqB,UAAUC,GAAV,EAAe;AAClC,QAAIC,sBAAsBX,cAAc,aAAd,EAA6BU,GAA7B,CAA1B;AACA,QAAIC,wBAAwBC,SAAxB,IAAqCF,IAAIN,MAAJ,GAAa,CAAtD,EAAyD;AACvD,aAAO,EAAP;AACD;;AAEDE,kBAAc,EAAd;;AAEA,QAAIO,QAAQ,EAAZ;AACA,QAAIC,IAAK,OAAOC,MAAP,KAAkB,WAAlB,GAAgCA,MAAhC,GAAyC,EAAlD;;AAEA,aAASC,CAAT,CAAWC,CAAX,EAAcC,CAAd,EAAiB;AACf,UAAIA,aAAaC,KAAjB,EAAwB;AAAED,YAAIA,EAAEE,IAAF,CAAO,GAAP,CAAJ;AAAkB;AAC5C,UAAI,OAAOF,CAAP,KAAa,WAAjB,EAA8B;AAAEL,cAAMQ,IAAN,CAAWC,mBAAmBL,CAAnB,IAAwB,GAAxB,GAA8BK,mBAAmBJ,CAAnB,CAAzC;AAAkE;AACnG;;AAED,aAASK,OAAT,CAAiBC,aAAjB,EAAgCC,YAAhC,EAA8C;AAC5C,UAAI;AACF,eAAOD,eAAP;AACD,OAFD,CAEE,OAAOE,EAAP,EAAW,CAAG;AAChB,aAAOD,YAAP;AACD;;AAEDT,MAAE,QAAF,EAAYO,QAAQ,YAAW;AAC7B,UAAII,IAAIb,EAAEc,QAAF,CAAWC,QAAX,CAAoBC,eAA5B;AACA,UAAIH,KAAKA,EAAEvB,MAAF,GAAW,CAApB,EAAuB;AACrB,eAAOuB,EAAEA,EAAEvB,MAAF,GAAW,CAAb,CAAP;AACD;AACD,aAAOU,EAAEiB,GAAF,CAAMH,QAAN,CAAeC,QAAf,CAAwBG,QAA/B,CAL6B,CAKY;AAC1C,KANW,EAMT,EANS,CAAZ;AAOAhB,MAAE,KAAF,EAASO,QAAQ,YAAW;AAC1B,UAAIU,CAAJ;AACA;AACA,UAAI;AACFA,YAAInB,EAAEiB,GAAF,CAAMH,QAAN,CAAeC,QAAf,CAAwBK,IAAxB,CAA6BC,QAA7B,EAAJ;AACD,OAFD,CAEE,OAAOT,EAAP,EAAW;AACXO,YAAInB,EAAEc,QAAF,CAAWC,QAAX,CAAoBK,IAApB,CAAyBC,QAAzB,EAAJ;AACD;AACD,aAAOF,CAAP;AACD,KATQ,EASN,EATM,CAAT;;AAWA,aAASG,SAAT,GAAqB;AACnB,UAAIC,MAAMrC,cAAc,UAAd,EAA0BU,GAA1B,KAAkC,kDAA5C;AACA,UAAI4B,cAActC,cAAc,MAAd,EAAsBU,GAAtB,KAA8B,IAAhD;AACA,UAAI6B,cAAcvC,cAAc,MAAd,EAAsBU,GAAtB,KAA8B,KAAhD;;AAEA2B,YAAMA,IAAIG,OAAJ,CAAY,kBAAZ,EAAgC7B,mBAAhC,CAAN;AACA0B,YAAMA,IAAIG,OAAJ,CAAY,WAAZ,EAAyBF,WAAzB,CAAN;AACAD,YAAMA,IAAIG,OAAJ,CAAY,WAAZ,EAAyBD,WAAzB,CAAN;;AAEAvB,QAAE,OAAF,EAAWO,QAAQ,YAAW;AAAE,eAAOT,EAAEiB,GAAF,CAAMH,QAAN,CAAea,KAAtB;AAA8B,OAAnD,EAAqD,EAArD,CAAX,EATmB,CASmD;AACtEzB,QAAE,KAAF,EAAUF,EAAE4B,MAAF,GAAW5B,EAAE4B,MAAF,CAASC,MAApB,GAA6B,EAAvC;AACA3B,QAAE,KAAF,EAAUF,EAAE4B,MAAF,GAAW5B,EAAE4B,MAAF,CAASE,KAApB,GAA4B,EAAtC;AACA5B,QAAE,IAAF,EAAS,IAAI6B,IAAJ,EAAD,CAAaC,iBAAb,EAAR;AACA9B,QAAE,OAAF,EAAa,iCAAD,CAAoC+B,IAApC,CAAyCjC,EAAEkC,SAAF,CAAYC,SAArD,IAAkE,CAAlE,GAAwE,8GAAD,CAAiHF,IAAjH,CAAsHjC,EAAEkC,SAAF,CAAYC,SAAlI,IAA+I,CAA/I,GAAmJ,CAAtO;AACAjC,QAAE,OAAF,EAAWO,QAAQ,YAAW;AAC5B,YAAI2B,IAAIpC,EAAEkC,SAAV;AACA,YAAIhC,IAAIkC,EAAEC,OAAV;AACA,YAAIC,IAAIF,EAAEG,SAAV;AACA,YAAIC,IAAI,+BAAR;AACA,YAAIC,IAAIzC,EAAE0C,aAAV;;AAEA,YAAIxC,KACFA,EAAE,iBAAF,CADE,IAEFoC,CAFE,IAGFA,EAAEE,CAAF,CAHE,IAIFF,EAAEE,CAAF,EAAKG,aAJP,EAIsB;AACpB,iBAAO,CAAP;AACD;;AAED,YAAIF,CAAJ,EAAO;AACL,cAAI;AACF,gBAAK,IAAIzC,EAAE0C,aAAN,CAAoB,+BAApB,CAAL,EAA4D;AAC1D,qBAAO,CAAP;AACD;AACF,WAJD,CAIE,OAAOE,CAAP,EAAU,CACX;AACF;;AAED,eAAO,CAAP;AACD,OAzBU,EAyBR,CAzBQ,CAAX;;AA2BA,UAAIC,UAAU,EAAd;AACA,UAAIC,SAAS,EAAb;AACA,UAAIC,SAAS,EAAb;AACA,UAAIC,aAAa,EAAjB;AACA,UAAI3D,IAAI,CAAR;AACA,UAAI4D,uBAAuB,EAA3B;AACA,UAAIC,MAAM,gBAAV;;AAEAhD,QAAE,KAAF,EAASF,EAAEmD,IAAF,CAAOzD,OAAP,CAAegC,OAAf,CAAuBwB,GAAvB,EAA4B,EAA5B,IAAkC,GAAlC,GAAwCxD,QAAQgC,OAAR,CAAgBwB,GAAhB,EAAqB,EAArB,CAAjD;;AAEA,aAAO7D,IAAIO,IAAIN,MAAf,EAAuBD,GAAvB,EAA4B;AAC1B,YAAI+D,KAAK,EAAT;AACA,YAAIC,KAAK,EAAT;AACA,YAAI9D,SAASK,IAAIP,CAAJ,EAAOE,MAAP,IAAiB,EAA9B;;AAEAC,oBAAYI,IAAIP,CAAJ,EAAOiE,UAAP,IAAqB1D,IAAIP,CAAJ,EAAOkE,aAAxC,IAAyD3D,IAAIP,CAAJ,CAAzD;;AAEA,YAAIO,IAAIP,CAAJ,EAAOmE,KAAP,CAAalE,MAAb,GAAsB,CAAtB,IAA2B,OAAOM,IAAIP,CAAJ,EAAOmE,KAAP,CAAa,CAAb,CAAP,KAA2B,QAA1D,EAAoE;AAClE5D,cAAIP,CAAJ,EAAOmE,KAAP,GAAe,CAAC5D,IAAIP,CAAJ,EAAOmE,KAAR,CAAf;AACD;;AAED,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI7D,IAAIP,CAAJ,EAAOmE,KAAP,CAAalE,MAAjC,EAAyCmE,GAAzC,EAA8C;AAC5CJ,aAAG9C,IAAH,CAAQX,IAAIP,CAAJ,EAAOmE,KAAP,CAAaC,CAAb,EAAgB,CAAhB,CAAR;AACAL,aAAG7C,IAAH,CAAQX,IAAIP,CAAJ,EAAOmE,KAAP,CAAaC,CAAb,EAAgB,CAAhB,CAAR;AACD;AACDR,6BAAqB1C,IAArB,CAA0BX,IAAIP,CAAJ,EAAOiE,UAAP,IAAqB1D,IAAIP,CAAJ,EAAOkE,aAAtD;AACAV,gBAAQtC,IAAR,CAAa6C,GAAG9C,IAAH,CAAQ,GAAR,CAAb;AACAwC,eAAOvC,IAAP,CAAY8C,GAAG/C,IAAH,CAAQ,GAAR,CAAZ;AACA0C,mBAAWzC,IAAX,CAAiBX,IAAIP,CAAJ,EAAO2D,UAAP,IAAqBpD,IAAIP,CAAJ,EAAO2D,UAAP,CAAkBU,KAAvC,GAA+C,GAA/C,GAAqD,GAAtE;AACAX,eAAOxC,IAAP,CAAYhB,OAAOoE,KAAP,IAAgB,CAA5B;AACD;;AAEDzD,QAAE,KAAF,EAAS+C,oBAAT;AACA/C,QAAE,GAAF,EAAO4C,MAAP;AACA5C,QAAE,GAAF,EAAO2C,OAAP;AACA3C,QAAE,OAAF,EAAW6C,MAAX;AACA7C,QAAE,GAAF,EAAO8C,UAAP;;AAEAzB,aAAO,MAAMxB,MAAMO,IAAN,CAAW,GAAX,CAAN,GAAwB,GAA/B;;AAEA,aAAOiB,GAAP;AACD;;AAED,WAAO,CAAC;AACNqC,cAAQ,KADF;AAENrC,WAAKD;AAFC,KAAD,CAAP;AAID,GAjID;;AAmIA,OAAKuC,iBAAL,GAAyB,UAAUC,cAAV,EAA0B;AACjD,QAAIC,YAAYD,eAAeE,IAAf,IAAuB,EAAvC;AACA,QAAIC,OAAO,EAAX;AACA,QAAI5E,IAAI,CAAR;;AAEA,QAAI0E,UAAUG,OAAd,EAAuB;AACrB,UAAIC,OAAO,EAAX;AACA,WAAK9E,IAAI,CAAT,EAAYA,IAAI0E,UAAUG,OAAV,CAAkB5E,MAAlC,EAA0CD,GAA1C,EAA+C;AAC7C,aAAK,IAAIoE,IAAI,CAAb,EAAgBA,IAAIM,UAAUG,OAAV,CAAkB7E,CAAlB,EAAqBJ,GAArB,CAAyBK,MAA7C,EAAqDmE,GAArD,EAA0D;AACxDU,eAAK5D,IAAL,CAAUwD,UAAUG,OAAV,CAAkB7E,CAAlB,EAAqBJ,GAArB,CAAyBwE,CAAzB,CAAV;AACD;AACF;AACDM,kBAAYI,IAAZ;AACD;;AAED,SAAK9E,IAAI,CAAT,EAAYA,IAAI0E,UAAUzE,MAA1B,EAAkCD,GAAlC,EAAuC;AACrC,UAAIJ,MAAM8E,UAAU1E,CAAV,CAAV;AACA,UAAI+E,aAAa5E,YAAYP,IAAIoF,KAAhB,CAAjB;AACA,UAAIC,cAAc;AAChBC,mBAAWH,WAAWI,KADN;AAEhBC,oBAAYhF,KAAKX,IAFD;AAGhB4F,aAAKC,WAAW1F,IAAI2F,KAAf,CAHW;AAIhB9C,eAAO7C,IAAIe,CAJK;AAKhB6B,gBAAQ5C,IAAI4F,CALI;AAMhBC,oBAAY7F,IAAI8F,IANA;AAOhBC,kBAAU,KAPM;AAQhBC,oBAAY,IARI;AAShBC,aAAK;AATW,OAAlB;;AAYA,UAAId,WAAWpB,UAAX,IAAyBoB,WAAWpB,UAAX,CAAsBU,KAAnD,EAA0D;AACxDY,oBAAYa,OAAZ,GAAsBlG,IAAImG,IAA1B;AACAd,oBAAYY,GAAZ,GAAkB,KAAlB;AACD,OAHD,MAGO;AACLZ,oBAAYe,EAAZ,GAAiBpG,IAAIqG,GAArB;AACD;AACDrB,WAAK1D,IAAL,CAAU+D,WAAV;AACD;AACD,WAAOL,IAAP;AACD,GAvCD;AAwCD;;AAEM,IAAMsB,sBAAO,IAAI1G,mBAAJ,EAAb;AACP,mCAAe0G,IAAf,E","file":"rhythmoneBidAdapter.js","sourcesContent":["'use strict';\n\nimport {registerBidder} from 'src/adapters/bidderFactory';\nimport { BANNER, VIDEO } from 'src/mediaTypes';\n\nfunction RhythmOneBidAdapter() {\n  this.code = 'rhythmone';\n  this.supportedMediaTypes = [VIDEO, BANNER];\n\n  this.isBidRequestValid = function (bid) {\n    return true;\n  };\n\n  function getFirstParam(key, validBidRequests) {\n    for (let i = 0; i < validBidRequests.length; i++) {\n      if (validBidRequests[i].params && validBidRequests[i].params[key]) {\n        return validBidRequests[i].params[key];\n      }\n    }\n  }\n\n  let slotsToBids = {};\n  let that = this;\n  let version = '1.0.0.0';\n\n  this.buildRequests = function (BRs) {\n    let fallbackPlacementId = getFirstParam('placementId', BRs);\n    if (fallbackPlacementId === undefined || BRs.length < 1) {\n      return [];\n    }\n\n    slotsToBids = {};\n\n    let query = [];\n    let w = (typeof window !== 'undefined' ? window : {});\n\n    function p(k, v) {\n      if (v instanceof Array) { v = v.join(','); }\n      if (typeof v !== 'undefined') { query.push(encodeURIComponent(k) + '=' + encodeURIComponent(v)); }\n    }\n\n    function attempt(valueFunction, defaultValue) {\n      try {\n        return valueFunction();\n      } catch (ex) { }\n      return defaultValue;\n    }\n\n    p('domain', attempt(function() {\n      var d = w.document.location.ancestorOrigins;\n      if (d && d.length > 0) {\n        return d[d.length - 1];\n      }\n      return w.top.document.location.hostname; // try/catch is in the attempt function\n    }, ''));\n    p('url', attempt(function() {\n      var l;\n      // try/catch is in the attempt function\n      try {\n        l = w.top.document.location.href.toString();\n      } catch (ex) {\n        l = w.document.location.href.toString();\n      }\n      return l;\n    }, ''));\n\n    function getRMPUrl() {\n      let url = getFirstParam('endpoint', BRs) || '//tag.1rx.io/rmp/{placementId}/0/{path}?z={zone}';\n      let defaultZone = getFirstParam('zone', BRs) || '1r';\n      let defaultPath = getFirstParam('path', BRs) || 'mvo';\n\n      url = url.replace(/\\{placementId\\}/i, fallbackPlacementId);\n      url = url.replace(/\\{zone\\}/i, defaultZone);\n      url = url.replace(/\\{path\\}/i, defaultPath);\n\n      p('title', attempt(function() { return w.top.document.title; }, '')); // try/catch is in the attempt function\n      p('dsh', (w.screen ? w.screen.height : ''));\n      p('dsw', (w.screen ? w.screen.width : ''));\n      p('tz', (new Date()).getTimezoneOffset());\n      p('dtype', ((/(ios|ipod|ipad|iphone|android)/i).test(w.navigator.userAgent) ? 1 : ((/(smart[-]?tv|hbbtv|appletv|googletv|hdmi|netcast\\.tv|viera|nettv|roku|\\bdtv\\b|sonydtv|inettvbrowser|\\btv\\b)/i).test(w.navigator.userAgent) ? 3 : 2)));\n      p('flash', attempt(function() {\n        let n = w.navigator;\n        let p = n.plugins;\n        let m = n.mimeTypes;\n        let t = 'application/x-shockwave-flash';\n        let x = w.ActiveXObject;\n\n        if (p &&\n          p['Shockwave Flash'] &&\n          m &&\n          m[t] &&\n          m[t].enabledPlugin) {\n          return 1;\n        }\n\n        if (x) {\n          try {\n            if ((new w.ActiveXObject('ShockwaveFlash.ShockwaveFlash'))) {\n              return 1;\n            }\n          } catch (e) {\n          }\n        }\n\n        return 0;\n      }, 0));\n\n      let heights = [];\n      let widths = [];\n      let floors = [];\n      let mediaTypes = [];\n      let i = 0;\n      let configuredPlacements = [];\n      let fat = /(^v|(\\.0)+$)/gi;\n\n      p('hbv', w.pbjs.version.replace(fat, '') + ',' + version.replace(fat, ''));\n\n      for (; i < BRs.length; i++) {\n        let th = [];\n        let tw = [];\n        let params = BRs[i].params || {};\n\n        slotsToBids[BRs[i].adUnitCode || BRs[i].placementCode] = BRs[i];\n\n        if (BRs[i].sizes.length > 0 && typeof BRs[i].sizes[0] === 'number') {\n          BRs[i].sizes = [BRs[i].sizes];\n        }\n\n        for (let j = 0; j < BRs[i].sizes.length; j++) {\n          tw.push(BRs[i].sizes[j][0]);\n          th.push(BRs[i].sizes[j][1]);\n        }\n        configuredPlacements.push(BRs[i].adUnitCode || BRs[i].placementCode);\n        heights.push(th.join('|'));\n        widths.push(tw.join('|'));\n        mediaTypes.push((BRs[i].mediaTypes && BRs[i].mediaTypes.video ? 'v' : 'd'));\n        floors.push(params.floor || 0);\n      }\n\n      p('imp', configuredPlacements);\n      p('w', widths);\n      p('h', heights);\n      p('floor', floors);\n      p('t', mediaTypes);\n\n      url += '&' + query.join('&') + '&';\n\n      return url;\n    }\n\n    return [{\n      method: 'GET',\n      url: getRMPUrl()\n    }];\n  };\n\n  this.interpretResponse = function (serverResponse) {\n    let responses = serverResponse.body || [];\n    let bids = [];\n    let i = 0;\n\n    if (responses.seatbid) {\n      let temp = [];\n      for (i = 0; i < responses.seatbid.length; i++) {\n        for (let j = 0; j < responses.seatbid[i].bid.length; j++) {\n          temp.push(responses.seatbid[i].bid[j]);\n        }\n      }\n      responses = temp;\n    }\n\n    for (i = 0; i < responses.length; i++) {\n      let bid = responses[i];\n      let bidRequest = slotsToBids[bid.impid];\n      let bidResponse = {\n        requestId: bidRequest.bidId,\n        bidderCode: that.code,\n        cpm: parseFloat(bid.price),\n        width: bid.w,\n        height: bid.h,\n        creativeId: bid.crid,\n        currency: 'USD',\n        netRevenue: true,\n        ttl: 1000\n      };\n\n      if (bidRequest.mediaTypes && bidRequest.mediaTypes.video) {\n        bidResponse.vastUrl = bid.nurl;\n        bidResponse.ttl = 10000;\n      } else {\n        bidResponse.ad = bid.adm;\n      }\n      bids.push(bidResponse);\n    }\n    return bids;\n  };\n}\n\nexport const spec = new RhythmOneBidAdapter();\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/rhythmoneBidAdapter.js"],"sourceRoot":""}