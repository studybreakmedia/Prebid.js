{"version":3,"sources":["webpack:///./modules/openxBidAdapter.js"],"names":["utils","SUPPORTED_AD_TYPES","BIDDER_CODE","BIDDER_CONFIG","BIDDER_VERSION","spec","code","supportedMediaTypes","isBidRequestValid","bid","mediaType","params","video","url","unit","delDomain","buildRequests","bids","isIfr","inIframe","currentURL","window","parent","document","referrer","location","href","length","requests","bannerRequests","videoRequests","bannerBids","videoBids","forEach","push","configuredBc","bc","buildOXRequest","ju","jr","ch","charSet","characterSet","res","screen","width","height","colorDepth","ifr","tz","Date","getTimezoneOffset","tws","getViewportDimensions","ef","be","nocache","getTime","buildOXVideoRequest","concat","interpretResponse","bidRequest","oxResponseObj","body","bidResponses","payload","pixels","registerSync","createVideoBidResponses","adUnits","ads","ad","createBidResponses","responseIds","map","bidResponse","requestId","indexOf","bidId","cpm","creativeId","dealId","currency","netRevenue","ttl","startTime","shouldSendBoPixel","sendBoPixel","undefined","i","adUnit","j","String","adunitid","adUnitHasValidSizeFromBid","matched","pub_rev","Number","creative","id","html","deal_id","tbd","ts","bt","getConfig","PREBID_TIMEOUT","Math","min","beaconParams","bd","br","bs","hostname","bp","boUrl","getBoUrl","recordPixel","tracking","impression","boBase","match","buildQueryStringFromParams","key","hasOwnProperty","_map","Object","keys","join","sizes","parseSizesInput","found","creative_size","isArray","size","tWin","tDoc","docEl","documentElement","top","e","innerWidth","clientWidth","innerHeight","clientHeight","formatCustomParms","customKey","customParams","value","toLowerCase","replace","oxParams","auid","dddid","transactionId","aus","customParamsForAllBids","hasCustomParam","customParamsForBid","formattedCustomParams","btoa","tps","customFloorsForAllBids","hasCustomFloor","customFloor","aumfs","method","data","oxVideoParams","generateVideoParameters","oxVideo","JSON","stringify","response","vastUrl","bidderCode","adid"],"mappings":"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","file":"openxBidAdapter.js","sourcesContent":["import { config } from 'src/config';\nimport {registerBidder} from 'src/adapters/bidderFactory';\nimport * as utils from 'src/utils';\nimport {userSync} from 'src/userSync';\nimport { BANNER, VIDEO } from 'src/mediaTypes';\n\nconst SUPPORTED_AD_TYPES = [BANNER, VIDEO];\nconst BIDDER_CODE = 'openx';\nconst BIDDER_CONFIG = 'hb_pb';\nconst BIDDER_VERSION = '2.0.0';\n\nexport const spec = {\n  code: BIDDER_CODE,\n  supportedMediaTypes: SUPPORTED_AD_TYPES,\n  isBidRequestValid: function(bid) {\n    if (bid.mediaType === VIDEO) {\n      if (typeof bid.params.video !== 'object' || !bid.params.video.url) {\n        return false;\n      }\n    }\n    return !!(bid.params.unit && bid.params.delDomain);\n  },\n  buildRequests: function(bids) {\n    let isIfr = utils.inIframe();\n    let currentURL = (window.parent !== window) ? document.referrer : window.location.href;\n    if (bids.length === 0) {\n      return;\n    }\n\n    let requests = [];\n    let bannerRequests = [];\n    let videoRequests = [];\n    let bannerBids = [];\n    let videoBids = [];\n    bids.forEach(function (bid) {\n      if (bid.mediaType === VIDEO) {\n        videoBids.push(bid);\n      } else {\n        bannerBids.push(bid);\n      }\n    });\n\n    // build banner requests\n    if (bannerBids.length !== 0) {\n      let delDomain = bannerBids[0].params.delDomain;\n      let configuredBc = bannerBids[0].params.bc;\n      let bc = configuredBc || `${BIDDER_CONFIG}_${BIDDER_VERSION}`;\n      bannerRequests = [ buildOXRequest(bannerBids, {\n        ju: currentURL,\n        jr: currentURL,\n        ch: document.charSet || document.characterSet,\n        res: `${screen.width}x${screen.height}x${screen.colorDepth}`,\n        ifr: isIfr,\n        tz: new Date().getTimezoneOffset(),\n        tws: getViewportDimensions(isIfr),\n        ef: 'bt%2Cdb',\n        be: 1,\n        bc: bc,\n        nocache: new Date().getTime()\n      },\n      delDomain)];\n    }\n    // build video requests\n    if (videoBids.length !== 0) {\n      videoRequests = buildOXVideoRequest(videoBids);\n    }\n\n    requests = bannerRequests.concat(videoRequests);\n    return requests;\n  },\n  interpretResponse: function({body: oxResponseObj}, bidRequest) {\n    let bidResponses = [];\n    let mediaType = BANNER;\n    if (bidRequest && bidRequest.payload) {\n      if (bidRequest.payload.bids) {\n        mediaType = bidRequest.payload.bids[0].mediaType;\n      } else if (bidRequest.payload.bid) {\n        mediaType = bidRequest.payload.bid.mediaType;\n      }\n    }\n\n    if (mediaType === VIDEO) {\n      if (oxResponseObj && oxResponseObj.pixels) {\n        userSync.registerSync('iframe', 'openx', oxResponseObj.pixels);\n      }\n      bidResponses = createVideoBidResponses(oxResponseObj, bidRequest.payload);\n      return bidResponses;\n    }\n\n    let adUnits = oxResponseObj.ads.ad;\n    if (oxResponseObj.ads && oxResponseObj.ads.pixels) {\n      userSync.registerSync('iframe', BIDDER_CODE, oxResponseObj.ads.pixels);\n    }\n    if (!adUnits) {\n      adUnits = [];\n    }\n    bidResponses = createBidResponses(adUnits, bidRequest.payload);\n\n    // Create an empty bidResponse for all bids that did not come back.\n    const responseIds = bidResponses.map((bidResponse) => bidResponse.requestId);\n    bidRequest.payload.bids.forEach((bid) => {\n      if (responseIds.indexOf(bid.bidId) === -1) {\n        bidResponses.push({\n          requestId: bid.bidId,\n          cpm: 0,\n          width: 1,\n          height: 1,\n          creativeId: null,\n          dealId: null,\n          currency: 'USD',\n          netRevenue: true,\n          mediaType: BANNER,\n          ttl: 60000,\n          ad: null\n        })\n      }\n    });\n    return bidResponses;\n  }\n};\n\nfunction createBidResponses(adUnits, {bids, startTime}) {\n  let bidResponses = [];\n  let shouldSendBoPixel = bids[0].params.sendBoPixel;\n  if (shouldSendBoPixel === undefined) {\n    // Not specified, default to turned on\n    shouldSendBoPixel = true;\n  }\n  for (let i = 0; i < adUnits.length; i++) {\n    let adUnit = adUnits[i];\n    let bidResponse = {};\n    if (adUnits.length == bids.length) {\n      // request and response length match, directly assign the request id based on positioning\n      bidResponse.requestId = bids[i].bidId;\n    } else {\n      for (let j = i; j < bids.length; j++) {\n        let bid = bids[j];\n        if (String(bid.params.unit) === String(adUnit.adunitid) && adUnitHasValidSizeFromBid(adUnit, bid) && !bid.matched) {\n        // ad unit and size match, this is the correct bid response to bid\n          bidResponse.requestId = bid.bidId;\n          bid.matched = true;\n          break;\n        }\n      }\n    }\n\n    if (adUnit.pub_rev) {\n      bidResponse.cpm = Number(adUnit.pub_rev) / 1000;\n    } else {\n      // No fill, do not add the bidresponse\n      continue;\n    }\n    let creative = adUnit.creative[0];\n    if (creative) {\n      bidResponse.width = creative.width;\n      bidResponse.height = creative.height;\n    }\n    bidResponse.creativeId = creative.id;\n    bidResponse.ad = adUnit.html;\n    if (adUnit.deal_id) {\n      bidResponse.dealId = adUnit.deal_id;\n    }\n    // default 5 mins\n    bidResponse.ttl = 300;\n    // true is net, false is gross\n    bidResponse.netRevenue = true;\n    bidResponse.currency = adUnit.currency;\n\n    // additional fields to add\n    if (adUnit.tbd) {\n      bidResponse.tbd = adUnit.tbd;\n    }\n    bidResponse.ts = adUnit.ts;\n\n    let bt = config.getConfig('bidderTimeout');\n    if (window.PREBID_TIMEOUT) {\n      bt = Math.min(window.PREBID_TIMEOUT, bt);\n    }\n    let beaconParams = {\n      bd: +(new Date()) - startTime,\n      br: '0', // may be 0, t, or p\n      bt: bt,\n      bs: window.location.hostname\n    };\n\n    beaconParams.br = beaconParams.bt < beaconParams.bd ? 't' : 'p';\n    beaconParams.bp = adUnit.pub_rev;\n    beaconParams.ts = adUnit.ts;\n    let boUrl;\n    if (shouldSendBoPixel) {\n      boUrl = getBoUrl(adUnit.creative[0], beaconParams);\n    }\n    if (boUrl) {\n      userSync.registerSync('image', BIDDER_CODE, boUrl);\n    }\n    bidResponses.push(bidResponse);\n  }\n  return bidResponses;\n}\n\nfunction getBoUrl(creative, params) {\n  let recordPixel = creative.tracking.impression;\n  let boBase = recordPixel.match(/([^?]+\\/)ri\\?/);\n\n  if (boBase) {\n    return `${boBase[1]}bo?${buildQueryStringFromParams(params)}`;\n  }\n}\n\nfunction buildQueryStringFromParams(params) {\n  for (let key in params) {\n    if (params.hasOwnProperty(key)) {\n      if (!params[key]) {\n        delete params[key];\n      }\n    }\n  }\n  return utils._map(Object.keys(params), key => `${key}=${params[key]}`)\n    .join('&');\n}\n\nfunction adUnitHasValidSizeFromBid(adUnit, bid) {\n  let sizes = utils.parseSizesInput(bid.sizes);\n  if (!sizes) {\n    return false;\n  }\n  let found = false;\n  let creative = adUnit.creative && adUnit.creative[0];\n  let creative_size = String(creative.width) + 'x' + String(creative.height);\n\n  if (utils.isArray(sizes)) {\n    for (let i = 0; i < sizes.length; i++) {\n      let size = sizes[i];\n      if (String(size) === String(creative_size)) {\n        found = true;\n        break;\n      }\n    }\n  }\n  return found;\n}\n\nfunction getViewportDimensions(isIfr) {\n  let width;\n  let height;\n  let tWin = window;\n  let tDoc = document;\n  let docEl = tDoc.documentElement;\n  let body;\n\n  if (isIfr) {\n    try {\n      tWin = window.top;\n      tDoc = window.top.document;\n    } catch (e) {\n      return;\n    }\n    docEl = tDoc.documentElement;\n    body = tDoc.body;\n\n    width = tWin.innerWidth || docEl.clientWidth || body.clientWidth;\n    height = tWin.innerHeight || docEl.clientHeight || body.clientHeight;\n  } else {\n    docEl = tDoc.documentElement;\n    width = tWin.innerWidth || docEl.clientWidth;\n    height = tWin.innerHeight || docEl.clientHeight;\n  }\n\n  return `${width}x${height}`;\n}\n\nfunction formatCustomParms(customKey, customParams) {\n  let value = customParams[customKey];\n  if (utils.isArray(value)) {\n    // if value is an array, join them with commas first\n    value = value.join(',');\n  }\n  // return customKey=customValue format, escaping + to . and / to _\n  return (customKey.toLowerCase() + '=' + value.toLowerCase()).replace('+', '.').replace('/', '_')\n}\n\nfunction buildOXRequest(bids, oxParams, delDomain) {\n  if (!utils.isArray(bids)) {\n    return;\n  }\n\n  oxParams.auid = utils._map(bids, bid => bid.params.unit).join(',');\n  oxParams.dddid = utils._map(bids, bid => bid.transactionId).join(',');\n  oxParams.aus = utils._map(bids, bid => {\n    return utils.parseSizesInput(bid.sizes).join(',');\n  }).join('|');\n\n  let customParamsForAllBids = [];\n  let hasCustomParam = false;\n  bids.forEach(function (bid) {\n    if (bid.params.customParams) {\n      let customParamsForBid = utils._map(Object.keys(bid.params.customParams), customKey => formatCustomParms(customKey, bid.params.customParams));\n      let formattedCustomParams = window.btoa(customParamsForBid.join('&'));\n      hasCustomParam = true;\n      customParamsForAllBids.push(formattedCustomParams);\n    } else {\n      customParamsForAllBids.push('');\n    }\n  });\n  if (hasCustomParam) {\n    oxParams.tps = customParamsForAllBids.join(',');\n  }\n\n  let customFloorsForAllBids = [];\n  let hasCustomFloor = false;\n  bids.forEach(function (bid) {\n    if (bid.params.customFloor) {\n      customFloorsForAllBids.push(bid.params.customFloor * 1000);\n      hasCustomFloor = true;\n    } else {\n      customFloorsForAllBids.push(0);\n    }\n  });\n  if (hasCustomFloor) {\n    oxParams.aumfs = customFloorsForAllBids.join(',');\n  }\n\n  let url = `//${delDomain}/w/1.0/arj`;\n  return {\n    method: 'GET',\n    url: url,\n    data: oxParams,\n    payload: {'bids': bids, 'startTime': new Date()}\n  };\n}\n\nfunction buildOXVideoRequest(bids) {\n  return bids.map(function(bid) {\n    let url = 'http://' + bid.params.delDomain + '/v/1.0/avjp';\n    let oxVideoParams = generateVideoParameters(bid);\n    return {\n      method: 'GET',\n      url: url,\n      data: oxVideoParams,\n      payload: {'bid': bid, 'startTime': new Date()}\n    };\n  });\n}\n\nfunction generateVideoParameters(bid) {\n  let oxVideo = bid.params.video;\n  let oxVideoParams = { auid: bid.params.unit };\n\n  Object.keys(oxVideo).forEach(function(key) {\n    if (key === 'openrtb') {\n      oxVideoParams[key] = JSON.stringify(oxVideo[key]);\n    } else {\n      oxVideoParams[key] = oxVideo[key];\n    }\n  });\n  oxVideoParams['be'] = 'true';\n  return oxVideoParams;\n}\n\nfunction createVideoBidResponses(response, {bid, startTime}) {\n  let bidResponses = [];\n\n  if (response !== undefined && response.vastUrl !== '' && response.pub_rev !== '') {\n    let bidResponse = {};\n    bidResponse.requestId = bid.bidId;\n    bidResponse.bidderCode = BIDDER_CODE;\n    // default 5 mins\n    bidResponse.ttl = 300;\n    // true is net, false is gross\n    bidResponse.netRevenue = true;\n    bidResponse.currency = response.currency;\n    bidResponse.cpm = Number(response.pub_rev) / 1000;\n    bidResponse.width = response.width;\n    bidResponse.height = response.height;\n    bidResponse.creativeId = response.adid;\n    bidResponse.vastUrl = response.vastUrl;\n    bidResponse.mediaType = VIDEO;\n\n    bidResponses.push(bidResponse);\n  }\n\n  return bidResponses;\n}\n\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/openxBidAdapter.js"],"sourceRoot":""}