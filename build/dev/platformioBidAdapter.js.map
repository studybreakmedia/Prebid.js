{"version":3,"sources":["webpack:///./modules/platformioBidAdapter.js"],"names":["spec","code","isBidRequestValid","bid","params","pubId","siteId","buildRequests","request","id","bidRequests","bidderRequestId","at","imp","map","impression","slot","site","device","method","url","data","JSON","stringify","interpretResponse","response","bidResponseAvailable","body","bidRequest","bidResponse","idToImpMap","idToBidMap","ortbRequest","parse","forEach","seatbid","seatBid","impid","bids","Object","keys","requestId","creativeId","adid","cpm","price","currency","cur","ttl","netRevenue","ad","adm","replace","bidid","width","banner","w","height","h","push","bidId","bidfloor","bidFloor","tagid","placementId","toString","size","toUpperCase","split","parseInt","bidderRequest","length","appParams","app","publisher","domain","hostname","ref","referrer","page","href","window","top","document","e","ua","navigator","userAgent","language","browserLanguage","userLanguage","systemLanguage","screen","innerWidth","innerHeigh","rawResponse","ex"],"mappings":"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","file":"platformioBidAdapter.js","sourcesContent":["\nimport {logError, getTopWindowLocation} from 'src/utils';\nimport { registerBidder } from 'src/adapters/bidderFactory';\n\nexport const spec = {\n\n  code: 'platformio',\n\n  isBidRequestValid: bid => (\n    !!(bid && bid.params && bid.params.pubId && bid.params.siteId)\n  ),\n  buildRequests: bidRequests => {\n    const request = {\n      id: bidRequests[0].bidderRequestId,\n      at: 2,\n      imp: bidRequests.map(slot => impression(slot)),\n      site: site(bidRequests),\n      device: device(),\n    };\n    return {\n      method: 'POST',\n      url: '//piohbdisp.hb.adx1.com/',\n      data: JSON.stringify(request),\n    };\n  },\n  interpretResponse: (response, request) => (\n    bidResponseAvailable(request, response.body)\n  ),\n};\nfunction bidResponseAvailable(bidRequest, bidResponse) {\n  const idToImpMap = {};\n  const idToBidMap = {};\n  const ortbRequest = parse(bidRequest.data);\n  ortbRequest.imp.forEach(imp => {\n    idToImpMap[imp.id] = imp;\n  });\n  if (bidResponse) {\n    bidResponse.seatbid.forEach(seatBid => seatBid.bid.forEach(bid => {\n      idToBidMap[bid.impid] = bid;\n    }));\n  }\n  const bids = [];\n  Object.keys(idToImpMap).forEach(id => {\n    if (idToBidMap[id]) {\n      const bid = {};\n      bid.requestId = id;\n      bid.creativeId = idToBidMap[id].adid;\n      bid.cpm = idToBidMap[id].price;\n      bid.currency = bidResponse.cur;\n      bid.ttl = 360;\n      bid.netRevenue = true;\n      bid.ad = idToBidMap[id].adm;\n      bid.ad = bid.ad.replace(/\\$(%7B|\\{)AUCTION_IMP_ID(%7D|\\})/gi, idToBidMap[id].impid);\n      bid.ad = bid.ad.replace(/\\$(%7B|\\{)AUCTION_AD_ID(%7D|\\})/gi, idToBidMap[id].adid);\n      bid.ad = bid.ad.replace(/\\$(%7B|\\{)AUCTION_PRICE(%7D|\\})/gi, idToBidMap[id].price);\n      bid.ad = bid.ad.replace(/\\$(%7B|\\{)AUCTION_CURRENCY(%7D|\\})/gi, bidResponse.cur);\n      bid.ad = bid.ad.replace(/\\$(%7B|\\{)AUCTION_BID_ID(%7D|\\})/gi, bidResponse.bidid);\n      bid.width = idToImpMap[id].banner.w;\n      bid.height = idToImpMap[id].banner.h;\n      bids.push(bid);\n    }\n  });\n  return bids;\n}\nfunction impression(slot) {\n  return {\n    id: slot.bidId,\n    banner: banner(slot),\n    bidfloor: slot.params.bidFloor || '0.000001',\n    tagid: slot.params.placementId.toString(),\n  };\n}\nfunction banner(slot) {\n  const size = slot.params.size.toUpperCase().split('X');\n  const width = parseInt(size[0]);\n  const height = parseInt(size[1]);\n  return {\n    w: width,\n    h: height,\n  };\n}\nfunction site(bidderRequest) {\n  const pubId = bidderRequest && bidderRequest.length > 0 ? bidderRequest[0].params.pubId : '0';\n  const siteId = bidderRequest && bidderRequest.length > 0 ? bidderRequest[0].params.siteId : '0';\n  const appParams = bidderRequest[0].params.app;\n  if (!appParams) {\n    return {\n      publisher: {\n        id: pubId.toString(),\n        domain: getTopWindowLocation().hostname,\n      },\n      id: siteId.toString(),\n      ref: referrer(),\n      page: getTopWindowLocation().href,\n    }\n  }\n  return null;\n}\nfunction referrer() {\n  try {\n    return window.top.document.referrer;\n  } catch (e) {\n    return document.referrer;\n  }\n}\nfunction device() {\n  return {\n    ua: navigator.userAgent,\n    language: (navigator.language || navigator.browserLanguage || navigator.userLanguage || navigator.systemLanguage),\n    w: (window.screen.width || window.innerWidth),\n    h: (window.screen.height || window.innerHeigh),\n  };\n}\nfunction parse(rawResponse) {\n  try {\n    if (rawResponse) {\n      return JSON.parse(rawResponse);\n    }\n  } catch (ex) {\n    logError('platformio.parse', 'ERROR', ex);\n  }\n  return null;\n}\n\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/platformioBidAdapter.js"],"sourceRoot":""}