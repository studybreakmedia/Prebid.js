{"version":3,"sources":["webpack:///./modules/centroBidAdapter.js"],"names":["utils","require","bidfactory","bidmanager","adloader","adaptermanager","CentroAdapter","baseUrl","devUrl","bidderCode","handlerPrefix","LOG_ERROR_MESS","noUnit","noAdTag","noBid","anotherCode","undefBid","unitNum","_makeHandler","handlerName","unit","requestedBid","response","window","err","undefined","_responseProcessing","_sendBidRequest","bid","size","sizes","params","logError","query","isDev","toString","push","encodeURIComponent","page_url","location","href","Array","length","join","bidId","loadScript","document","protocol","resp","bidObject","adTag","statusMessage","sectionID","createBid","cpm","value","ad","width","height","addBidResponse","placementCode","_callBids","bids","i","bidder","callBids","registerBidAdapter","module","exports"],"mappings":"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","file":"centroBidAdapter.js","sourcesContent":["var utils = require('src/utils.js');\nvar bidfactory = require('src/bidfactory.js');\nvar bidmanager = require('src/bidmanager.js');\nvar adloader = require('src/adloader');\nvar adaptermanager = require('src/adaptermanager');\n\nvar CentroAdapter = function CentroAdapter() {\n  const baseUrl = '//t.brand-server.com/hb';\n  const devUrl = '//staging.brand-server.com/hb';\n  const bidderCode = 'centro';\n  const handlerPrefix = 'adCentroHandler_';\n\n  const LOG_ERROR_MESS = {\n    noUnit: 'Bid has no unit',\n    noAdTag: 'Bid has missmatch format.',\n    noBid: 'Response has no bid.',\n    anotherCode: 'Bid has another bidderCode - ',\n    undefBid: 'Bid is undefined',\n    unitNum: 'Requested unit is '\n  };\n\n  function _makeHandler(handlerName, unit, requestedBid) {\n    return function(response) {\n      try {\n        delete window[handlerName];\n      } catch (err) { // catching for old IE\n        window[handlerName] = undefined;\n      }\n      _responseProcessing(response, unit, requestedBid);\n    };\n  }\n\n  function _sendBidRequest(requestedBid) {\n    var bid;\n    const size = requestedBid.sizes && requestedBid.sizes[0];\n\n    bid = requestedBid.params;\n    if (!bid.unit) {\n      // throw exception, or call utils.logError\n      utils.logError(LOG_ERROR_MESS.noUnit, bidderCode);\n      return;\n    }\n    var query = ['s=' + bid.unit, 'adapter=prebid'];//, 'url=www.abc15.com','sz=320x50'];\n    var isDev = bid.unit.toString() === '28136';\n\n    query.push('url=' + encodeURIComponent(bid.page_url || location.href));\n    // check size format\n    if (\n      size instanceof Array &&\n      size.length === 2 &&\n      typeof size[0] === 'number' &&\n      typeof size[1] === 'number'\n    ) {\n      query.push('sz=' + size.join('x'));\n    }\n    // make handler name for JSONP request\n    var handlerName = handlerPrefix + bid.unit + size.join('x') + encodeURIComponent(requestedBid.bidId);\n    query.push('callback=' + encodeURIComponent('window[\"' + handlerName + '\"]'));\n\n    // maybe is needed add some random parameter to disable cache\n    // query.push('r='+Math.round(Math.random() * 1e5));\n\n    window[handlerName] = _makeHandler(handlerName, bid.unit, requestedBid);\n\n    adloader.loadScript((document.location.protocol === 'https:' ? 'https:' : 'http:') + (isDev ? devUrl : baseUrl) + '?' + query.join('&'));\n  }\n\n  /*\n   \"sectionID\": 7302,\n   \"height\": 250,\n   \"width\": 300,\n   \"value\": 3.2,\n   \"adTag\":''\n   */\n  function _responseProcessing(resp, unit, requestedBid) {\n    var bidObject;\n    var bid = (resp && resp.bid) || resp;\n\n    if (bid && (bid.adTag || bid.statusMessage === 'No bid') && bid.sectionID && bid.sectionID.toString() === unit.toString()) {\n      if (bid.adTag) {\n        bidObject = bidfactory.createBid(1, requestedBid);\n        bidObject.cpm = bid.value;\n        bidObject.ad = bid.adTag;\n        bidObject.width = bid.width;\n        bidObject.height = bid.height;\n      } else {\n        bidObject = bidfactory.createBid(2, requestedBid);\n      }\n    } else {\n      // throw exception, or call utils.logError with resp.statusMessage\n      utils.logError(LOG_ERROR_MESS.unitNum + unit + '. ' + (bid ? bid.statusMessage || LOG_ERROR_MESS.noAdTag : LOG_ERROR_MESS.noBid), bidderCode);\n      bidObject = bidfactory.createBid(2, requestedBid);\n    }\n    bidmanager.addBidResponse(requestedBid.placementCode, bidObject);\n  }\n\n  /*\n   {\n   bidderCode: \"centro\",\n   bids: [\n   {\n   unit:  '3242432',\n   page_url: \"http://\",\n   size: [300, 250]\n   */\n  function _callBids(params) {\n    var bid;\n    const bids = params.bids || [];\n    for (var i = 0; i < bids.length; i++) {\n      bid = bids[i];\n      if (bid && bid.bidder === bidderCode) {\n        _sendBidRequest(bid);\n      }\n    }\n  }\n\n  return {\n    callBids: _callBids\n  };\n};\n\nadaptermanager.registerBidAdapter(new CentroAdapter(), 'centro');\n\nmodule.exports = CentroAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/centroBidAdapter.js"],"sourceRoot":""}