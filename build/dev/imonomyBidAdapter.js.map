{"version":3,"sources":["webpack:///./modules/imonomyBidAdapter.js"],"names":["utils","require","adloader","bidmanager","bidfactory","adaptermanager","STATUSCODES","STATUS","ImonomyAdapter","callBids","_callBids","params","request","siteRef","screen_w","screen_h","language","pxr","keywords","connectiontype","domain","page","bid","i","l","bids","imonomy_domain","callbackName","getUniqueIdentifierStr","document","referrer","e","window","location","host","devicePixelRatio","screen","width","body","clientWidth","height","clientHeight","pathname","search","hash","meta","getElementsByTagName","content","connection","navigator","mozConnection","webkitConnection","undefined","type","language_tmp","documentElement","lang","userLanguage","split","data","requestId","bidderRequestId","callback","publisher_id","encodeURIComponent","JSON","stringify","protocol","unshift","key","hasOwnProperty","push","length","formRequestUrl","pbjs","handleCallback","loadScript","join","reqData","url","btoa","slice","handleResponse","adItems","bidObject","bidder","adItem","um_list","_processUserMatchings","ads","getAdItem","bidId","createBid","GOOD","bidderCode","ad","cpm","cur","addBidResponse","placementCode","NO_BID","userMatchings","headElem","createdElem","_each","userMatching","createElement","createInvisibleIframe","async","src","decodeURIComponent","Url","insertBefore","firstChild","imp","impression_id","registerBidAdapter","module","exports"],"mappings":"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","file":"imonomyBidAdapter.js","sourcesContent":["/* imonomy.js v3.1.0\nUpdated : 2017-03-15 */\n\nvar utils = require('src/utils.js');\nvar adloader = require('src/adloader.js');\nvar bidmanager = require('src/bidmanager.js');\nvar bidfactory = require('src/bidfactory.js');\nconst adaptermanager = require('src/adaptermanager');\nvar STATUSCODES = require('src/constants.json').STATUS;\n\nfunction ImonomyAdapter() {\n  return {\n    callBids: _callBids\n  };\n\n  function _callBids(params) {\n    var request = [];\n    var siteRef = '';\n    var screen_w = '';\n    var screen_h = '';\n    var language = '';\n    var pxr = '';\n    var keywords = '';\n    var connectiontype = '';\n    var domain = '';\n    var page = '';\n    var bid, i, l;\n    var bids = params.bids;\n    var imonomy_domain = 'b.imonomy.com';\n    var callbackName = '_hb_' + utils.getUniqueIdentifierStr();\n\n    try { siteRef = document.referrer } catch (e) { }\n    try { domain = window.location.host } catch (e) { }\n    try { pxr = window.devicePixelRatio } catch (e) { }\n    try { screen_w = screen.width || document.body.clientWidth || 0 } catch (e) { }\n    try { screen_h = screen.height || document.body.clientHeight || 0 } catch (e) { }\n    try { page = window.location.pathname + location.search + location.hash } catch (e) { }\n\n    try {\n      var meta = document.getElementsByTagName('meta') || {};\n      keywords = ('keywords' in meta) ? meta['keywords'].content : ''\n    } catch (e) {}\n\n    try {\n      var connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\n      connectiontype = (connection != undefined) ? connection.type : '';\n    } catch (e) {}\n\n    try {\n      var language_tmp = document.documentElement.lang || navigator.language || navigator.userLanguage || '';\n      language = language_tmp.split('-')[0]\n    } catch (e) {}\n\n    try {\n      var data = {\n        pxr: pxr,\n        page: page,\n        domain: domain,\n        siteRef: siteRef,\n        screen_w: screen_w,\n        screen_h: screen_h,\n        language: language,\n        keywords: keywords,\n        connectiontype: connectiontype,\n        requestId: params['requestId'],\n        bidderRequestId: params['bidderRequestId'],\n        callback: 'pbjs.' + callbackName,\n        publisher_id: params['bids'][0]['params']['publisher_id'],\n        bids: encodeURIComponent(JSON.stringify(params['bids']))\n      };\n\n      var protocol = (document.location.protocol === 'https:') ? 'https' : 'http';\n      request.unshift(protocol + '://' + imonomy_domain + '/openrtb/hb/' + params['bids'][0]['params']['publisher_id'] + '?id=' + utils.getUniqueIdentifierStr());\n\n      for (var key in data) {\n        if (data.hasOwnProperty(key)) {\n          request.push(key + '=' + encodeURIComponent(data[key]));\n        }\n      }\n\n      for (i = 0, l = bids.length; i < l; i++) {\n        bid = bids[i];\n        request.push(formRequestUrl(bid.params));\n      }\n\n      pbjs[callbackName] = handleCallback(bids);\n\n      adloader.loadScript(request.join('&'));\n    } catch (e) {\n    }\n  }\n\n  function formRequestUrl(reqData) {\n    var key;\n    var url = [];\n\n    for (key in reqData) {\n      if (reqData.hasOwnProperty(key) && reqData[key]) {\n        url.push(key, '=', reqData[key], '&');\n      }\n    }\n\n    return btoa(url.join('').slice(0, -1));\n  }\n\n  function handleCallback(bids) {\n    return function handleResponse(adItems) {\n      try {\n        var bidObject;\n        var bidder = 'imonomy';\n        var adItem;\n        var bid;\n\n        try {\n          if (adItems.um_list) {\n            _processUserMatchings(adItems.um_list);\n          }\n        } catch (e) { }\n\n        adItems = adItems.ads;\n\n        for (var i = 0, l = bids.length; i < l; i++) {\n          bid = bids[i];\n          adItem = getAdItem(adItems, bids[i].bidId);\n\n          if (adItem) {\n            bidObject = bidfactory.createBid(STATUSCODES.GOOD, bid);\n            bidObject.bidderCode = bidder;\n            bidObject.ad = adItem.ad;\n            bidObject.cpm = adItem.cpm;\n            bidObject.cur = adItem.cur;\n            bidObject.width = adItem.width;\n            bidObject.height = adItem.height;\n            bidmanager.addBidResponse(bid.placementCode, bidObject);\n          } else {\n            bidObject = bidfactory.createBid(STATUSCODES.NO_BID, bid);\n            bidObject.bidderCode = bidder;\n            bidmanager.addBidResponse(bid.placementCode, bidObject);\n          }\n        }\n      } catch (e) {\n      }\n    };\n  }\n\n  function _processUserMatchings(userMatchings) {\n    var headElem = document.getElementsByTagName('head')[0];\n    var createdElem;\n\n    utils._each(userMatchings, function (userMatching) {\n      createdElem = undefined;\n      switch (userMatching.type) {\n        case 'redirect':\n          createdElem = document.createElement('img');\n          break;\n        case 'iframe':\n          createdElem = utils.createInvisibleIframe();\n          break;\n        case 'js':\n          createdElem = document.createElement('script');\n          createdElem.type = 'text/javascript';\n          createdElem.async = true;\n          break;\n      }\n      if (createdElem) {\n        createdElem.src = decodeURIComponent(userMatching.Url);\n        headElem.insertBefore(createdElem, headElem.firstChild);\n      }\n    });\n  }\n\n  function getAdItem(adItems, imp) {\n    adItems = adItems || []\n    for (var i = 0, l = adItems.length; i < l; i++) {\n      if (adItems[i].impression_id == imp) {\n        return adItems[i];\n      }\n    }\n\n    return null;\n  }\n}\n\nadaptermanager.registerBidAdapter(new ImonomyAdapter(), 'imonomy');\nmodule.exports = ImonomyAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/imonomyBidAdapter.js"],"sourceRoot":""}