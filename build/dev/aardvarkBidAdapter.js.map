{"version":3,"sources":["webpack:///./modules/aardvarkBidAdapter.js"],"names":["utils","require","bidfactory","bidmanager","adloader","Adapter","constants","adaptermanager","AARDVARK_CALLBACK_NAME","AARDVARK_REQUESTS_MAP","AARDVARK_BIDDER_CODE","DEFAULT_REFERRER","DEFAULT_ENDPOINT","endpoint","requestBids","bidderCode","callbackName","bidReqs","ref","getTopWindowLocation","ai","scs","bidIds","host","i","l","length","bid","_ai","_sc","_endpoint","getBidIdParameter","params","push","bidId","pbjs","logWarn","loadScript","join","registerBidResponse","rawBidResponse","error","cid","bidObj","sc","id","bidResponse","createBid","STATUS","GOOD","bidder","cpm","ad","adm","createTrackPixelHtml","decodeURIComponent","nurl","width","sizes","height","addBidResponse","placementCode","responded","registerAardvarkCallback","rtkResponseObj","forEach","bidRequestId","hasOwnProperty","bidRequest","NO_BID","AardvarkAdapter","baseAdapter","callBids","getBidderCode","bids","setBidderCode","registerBidAdapter","module","exports"],"mappings":"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","file":"aardvarkBidAdapter.js","sourcesContent":["/*\n * Adapter for requesting bids from RTK Aardvark\n * To request an RTK Aardvark Header bidding account\n * or for additional integration support please contact sales@rtk.io\n */\n\nvar utils = require('src/utils.js');\nvar bidfactory = require('src/bidfactory.js');\nvar bidmanager = require('src/bidmanager.js');\nvar adloader = require('src/adloader.js');\nvar Adapter = require('src/adapter.js').default;\nvar constants = require('src/constants.json');\nvar adaptermanager = require('src/adaptermanager');\n\nconst AARDVARK_CALLBACK_NAME = 'aardvarkResponse';\nconst AARDVARK_REQUESTS_MAP = 'aardvarkRequests';\nconst AARDVARK_BIDDER_CODE = 'aardvark';\nconst DEFAULT_REFERRER = 'thor.rtk.io';\nconst DEFAULT_ENDPOINT = 'thor.rtk.io';\n\nvar endpoint = DEFAULT_ENDPOINT;\n\nfunction requestBids(bidderCode, callbackName, bidReqs) {\n  var ref = utils.getTopWindowLocation();\n  var ai = '';\n  const scs = [];\n  const bidIds = [];\n\n  ref = ref ? ref.host : DEFAULT_REFERRER;\n\n  for (var i = 0, l = bidReqs.length, bid, _ai, _sc, _endpoint; i < l; i += 1) {\n    bid = bidReqs[i];\n    _ai = utils.getBidIdParameter('ai', bid.params);\n    _sc = utils.getBidIdParameter('sc', bid.params);\n    if (!_ai || !_ai.length || !_sc || !_sc.length) { continue; }\n\n    _endpoint = utils.getBidIdParameter('host', bid.params);\n    if (_endpoint) { endpoint = _endpoint; }\n\n    if (!ai.length) { ai = _ai; }\n    if (_sc) { scs.push(_sc); }\n\n    bidIds.push(_sc + '=' + bid.bidId);\n\n    // Create the bidIdsMap for easier mapping back later\n    pbjs[AARDVARK_REQUESTS_MAP][bidderCode][bid.bidId] = bid;\n  }\n\n  if (!ai.length || !scs.length) { return utils.logWarn('Bad bid request params given for adapter $' + bidderCode + ' (' + AARDVARK_BIDDER_CODE + ')'); }\n\n  adloader.loadScript([\n    '//' + endpoint + '/', ai, '/', scs.join('_'),\n    '/aardvark/?jsonp=pbjs.', callbackName,\n    '&rtkreferer=', ref, '&', bidIds.join('&')\n  ].join(''));\n}\n\nfunction registerBidResponse(bidderCode, rawBidResponse) {\n  if (rawBidResponse.error) { return utils.logWarn('Aardvark bid received with an error, ignoring... [' + rawBidResponse.error + ']'); }\n\n  if (!rawBidResponse.cid) { return utils.logWarn('Aardvark bid received without a callback id, ignoring...'); }\n\n  var bidObj = pbjs[AARDVARK_REQUESTS_MAP][bidderCode][rawBidResponse.cid];\n  if (!bidObj) { return utils.logWarn('Aardvark request not found: ' + rawBidResponse.cid); }\n\n  if (bidObj.params.sc !== rawBidResponse.id) { return utils.logWarn('Aardvark bid received with a non matching shortcode ' + rawBidResponse.id + ' instead of ' + bidObj.params.sc); }\n\n  var bidResponse = bidfactory.createBid(constants.STATUS.GOOD, bidObj);\n  bidResponse.bidderCode = bidObj.bidder;\n  bidResponse.cpm = rawBidResponse.cpm;\n  bidResponse.ad = rawBidResponse.adm + utils.createTrackPixelHtml(decodeURIComponent(rawBidResponse.nurl));\n  bidResponse.width = bidObj.sizes[0][0];\n  bidResponse.height = bidObj.sizes[0][1];\n\n  bidmanager.addBidResponse(bidObj.placementCode, bidResponse);\n  pbjs[AARDVARK_REQUESTS_MAP][bidderCode][rawBidResponse.cid].responded = true;\n}\n\nfunction registerAardvarkCallback(bidderCode, callbackName) {\n  pbjs[callbackName] = function(rtkResponseObj) {\n    rtkResponseObj.forEach(function(bidResponse) {\n      registerBidResponse(bidderCode, bidResponse);\n    });\n\n    for (var bidRequestId in pbjs[AARDVARK_REQUESTS_MAP][bidderCode]) {\n      if (pbjs[AARDVARK_REQUESTS_MAP][bidderCode].hasOwnProperty(bidRequestId)) {\n        var bidRequest = pbjs[AARDVARK_REQUESTS_MAP][bidderCode][bidRequestId];\n        if (!bidRequest.responded) {\n          var bidResponse = bidfactory.createBid(constants.STATUS.NO_BID, bidRequest);\n          bidResponse.bidderCode = bidRequest.bidder;\n          bidmanager.addBidResponse(bidRequest.placementCode, bidResponse);\n        }\n      }\n    }\n  };\n}\n\nconst AardvarkAdapter = function() {\n  var baseAdapter = new Adapter(AARDVARK_BIDDER_CODE);\n\n  pbjs[AARDVARK_REQUESTS_MAP] = pbjs[AARDVARK_REQUESTS_MAP] || {};\n\n  baseAdapter.callBids = function (params) {\n    const bidderCode = baseAdapter.getBidderCode();\n    var callbackName = AARDVARK_CALLBACK_NAME;\n\n    if (bidderCode !== AARDVARK_BIDDER_CODE) { callbackName = [AARDVARK_CALLBACK_NAME, bidderCode].join('_'); }\n\n    pbjs[AARDVARK_REQUESTS_MAP][bidderCode] = {};\n\n    registerAardvarkCallback(bidderCode, callbackName);\n\n    return requestBids(bidderCode, callbackName, params.bids || []);\n  };\n\n  return Object.assign(this, {\n    callBids: baseAdapter.callBids,\n    setBidderCode: baseAdapter.setBidderCode\n  });\n};\n\nadaptermanager.registerBidAdapter(new AardvarkAdapter(), 'aardvark');\n\nmodule.exports = AardvarkAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/aardvarkBidAdapter.js"],"sourceRoot":""}