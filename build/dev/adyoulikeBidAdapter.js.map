{"version":3,"sources":["webpack:///./modules/adyoulikeBidAdapter.js"],"names":["utils","AdyoulikeAdapter","_VERSION","baseAdapter","callBids","bidRequest","bidRequests","bids","validBids","filter","valid","forEach","bid","params","placement","placements","map","isEmpty","body","createBody","endpoint","createEndpoint","response","handleResponse","contentType","withCredentials","protocol","document","location","host","pathname","search","createEndpointQS","qs","ref","getReferrerUrl","RefererUrl","encodeURIComponent","can","getCanonicalUrl","CanonicalUrl","Version","Placements","TransactionIds","performance","navigation","PageRefreshed","type","TYPE_RELOAD","e","transactionId","JSON","stringify","responses","parse","error","logError","bidResponses","Placement","Object","keys","addResponse","sizes","getSize","width","height","referer","window","self","top","referrer","link","head","querySelector","href","requestSizes","parsed","size","parseSizesInput","parsedSize","toUpperCase","split","parseInt","createBid","placementId","Banner","NO_BID","GOOD","cpm","Price","ad","bidderCode","getBidderCode","placementCode","addBidResponse","setBidderCode","registerBidAdapter","module","exports"],"mappings":"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","file":"adyoulikeBidAdapter.js","sourcesContent":["import Adapter from 'src/adapter';\nimport bidfactory from 'src/bidfactory';\nimport bidmanager from 'src/bidmanager';\nimport * as utils from 'src/utils';\nimport { format } from 'src/url';\nimport { ajax } from 'src/ajax';\nimport { STATUS } from 'src/constants';\nimport adaptermanager from 'src/adaptermanager';\n\nvar AdyoulikeAdapter = function AdyoulikeAdapter() {\n  const _VERSION = '0.2';\n\n  const baseAdapter = new Adapter('adyoulike');\n\n  baseAdapter.callBids = function (bidRequest) {\n    const bidRequests = {};\n    const bids = bidRequest.bids || [];\n\n    const validBids = bids.filter(valid);\n    validBids.forEach(bid => { bidRequests[bid.params.placement] = bid; });\n\n    const placements = validBids.map(bid => bid.params.placement);\n    if (!utils.isEmpty(placements)) {\n      const body = createBody(bidRequests, placements);\n      const endpoint = createEndpoint();\n      ajax(endpoint,\n        (response) => {\n          handleResponse(bidRequests, response);\n        }, body, {\n          contentType: 'text/json',\n          withCredentials: true\n        });\n    }\n  };\n\n  /* Create endpoint url */\n  function createEndpoint() {\n    return format({\n      protocol: (document.location.protocol === 'https:') ? 'https' : 'http',\n      host: 'hb-api.omnitagjs.com',\n      pathname: '/hb-api/prebid',\n      search: createEndpointQS()\n    });\n  }\n\n  /* Create endpoint query string */\n  function createEndpointQS() {\n    const qs = {};\n\n    const ref = getReferrerUrl();\n    if (ref) {\n      qs.RefererUrl = encodeURIComponent(ref);\n    }\n\n    const can = getCanonicalUrl();\n    if (can) {\n      qs.CanonicalUrl = encodeURIComponent(can);\n    }\n\n    return qs;\n  }\n\n  /* Create request body */\n  function createBody(bidRequests, placements) {\n    const body = {\n      Version: _VERSION,\n      Placements: placements,\n      TransactionIds: {}\n    };\n\n    // performance isn't supported by mobile safari iOS7. window.performance works, but\n    // evaluates to true on a unit test which expects false.\n    //\n    // try/catch was added to un-block the Prebid 0.25 release, but the adyoulike adapter\n    // maintainers should revisit this and see if it's really what they want.\n    try {\n      if (performance && performance.navigation) {\n        body.PageRefreshed = performance.navigation.type === performance.navigation.TYPE_RELOAD;\n      }\n    } catch (e) {\n      body.PageRefreshed = false;\n    }\n\n    placements.forEach(placement => { body.TransactionIds[placement] = bidRequests[placement].transactionId; });\n\n    return JSON.stringify(body);\n  }\n\n  /* Response handler */\n  function handleResponse(bidRequests, response) {\n    let responses = [];\n    try {\n      responses = JSON.parse(response);\n    } catch (error) { utils.logError(error); }\n\n    const bidResponses = {};\n    responses.forEach(response => {\n      bidResponses[response.Placement] = response;\n    });\n\n    Object.keys(bidRequests).forEach(placement => {\n      addResponse(placement, bidRequests[placement], bidResponses[placement]);\n    });\n  }\n\n  /* Check that a bid has required parameters */\n  function valid(bid) {\n    const sizes = getSize(bid.sizes);\n    if (!bid.params.placement || !sizes.width || !sizes.height) {\n      return false;\n    }\n    return true;\n  }\n\n  /* Get current page referrer url */\n  function getReferrerUrl() {\n    let referer = '';\n    if (window.self !== window.top) {\n      try {\n        referer = window.top.document.referrer;\n      } catch (e) { }\n    } else {\n      referer = document.referrer;\n    }\n    return referer;\n  }\n\n  /* Get current page canonical url */\n  function getCanonicalUrl() {\n    let link;\n    if (window.self !== window.top) {\n      try {\n        link = window.top.document.head.querySelector('link[rel=\"canonical\"][href]');\n      } catch (e) { }\n    } else {\n      link = document.head.querySelector('link[rel=\"canonical\"][href]');\n    }\n\n    if (link) {\n      return link.href;\n    }\n    return '';\n  }\n\n  /* Get parsed size from request size */\n  function getSize(requestSizes) {\n    const parsed = {};\n    const size = utils.parseSizesInput(requestSizes)[0];\n\n    if (typeof size !== 'string') {\n      return parsed;\n    }\n\n    const parsedSize = size.toUpperCase().split('X');\n    const width = parseInt(parsedSize[0], 10);\n    if (width) {\n      parsed.width = width;\n    }\n\n    const height = parseInt(parsedSize[1], 10);\n    if (height) {\n      parsed.height = height;\n    }\n\n    return parsed;\n  }\n\n  /* Create bid from response */\n  function createBid(placementId, bidRequest, response) {\n    let bid;\n    if (!response || !response.Banner) {\n      bid = bidfactory.createBid(STATUS.NO_BID, bidRequest);\n    } else {\n      bid = bidfactory.createBid(STATUS.GOOD, bidRequest);\n      const size = getSize(bidRequest.sizes);\n      bid.width = size.width;\n      bid.height = size.height;\n      bid.cpm = response.Price;\n      bid.ad = response.Banner;\n    }\n\n    bid.bidderCode = baseAdapter.getBidderCode();\n\n    return bid;\n  }\n\n  /* Add response to bidmanager */\n  function addResponse(placementId, bidRequest, response) {\n    const bid = createBid(placementId, bidRequest, response);\n    const placement = bidRequest.placementCode;\n    bidmanager.addBidResponse(placement, bid);\n  }\n\n  return Object.assign(this, {\n    callBids: baseAdapter.callBids,\n    setBidderCode: baseAdapter.setBidderCode,\n  });\n};\n\nadaptermanager.registerBidAdapter(new AdyoulikeAdapter(), 'adyoulike');\n\nmodule.exports = AdyoulikeAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/adyoulikeBidAdapter.js"],"sourceRoot":""}