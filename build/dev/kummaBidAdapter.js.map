{"version":3,"sources":["webpack:///./modules/kummaBidAdapter.js"],"names":["spec","code","isBidRequestValid","bid","params","pubId","siteId","buildRequests","request","id","bidRequests","bidderRequestId","at","imp","map","impression","slot","site","device","method","url","data","JSON","stringify","interpretResponse","response","bidResponseAvailable","body","bidRequest","bidResponse","idToImpMap","idToBidMap","ortbRequest","parse","ex","forEach","seatbid","seatBid","impid","bids","Object","keys","requestId","creativeId","adid","cpm","price","currency","cur","ttl","netRevenue","ad","adm","replace","bidid","width","banner","w","height","h","push","bidId","bidfloor","bidFloor","tagid","placementId","toString","size","sizes","split","parseInt","bidderRequest","length","appParams","app","publisher","domain","hostname","ref","page","href","ua","navigator","userAgent","language","browserLanguage","userLanguage","systemLanguage","window","screen","innerWidth","innerHeigh"],"mappings":"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","file":"kummaBidAdapter.js","sourcesContent":["\nimport {logError, getTopWindowLocation, getTopWindowReferrer, parseSizesInput} from 'src/utils';\nimport { registerBidder } from 'src/adapters/bidderFactory';\n\nexport const spec = {\n\n  code: 'kumma',\n\n  isBidRequestValid: bid => (\n    !!(bid && bid.params && bid.params.pubId && bid.params.siteId)\n  ),\n  buildRequests: bidRequests => {\n    const request = {\n      id: bidRequests[0].bidderRequestId,\n      at: 2,\n      imp: bidRequests.map(slot => impression(slot)),\n      site: site(bidRequests),\n      device: device(),\n    };\n    return {\n      method: 'POST',\n      url: '//hb.kumma.com/',\n      data: JSON.stringify(request),\n    };\n  },\n  interpretResponse: (response, request) => (\n    bidResponseAvailable(request, response.body)\n  ),\n};\nfunction bidResponseAvailable(bidRequest, bidResponse) {\n  const idToImpMap = {};\n  const idToBidMap = {};\n  let ortbRequest = null;\n  try {\n    ortbRequest = JSON.parse(bidRequest.data);\n  } catch (ex) {\n    logError('kumma.parse', 'ERROR', ex);\n  }\n  ortbRequest.imp.forEach(imp => {\n    idToImpMap[imp.id] = imp;\n  });\n  if (bidResponse) {\n    bidResponse.seatbid.forEach(seatBid => seatBid.bid.forEach(bid => {\n      idToBidMap[bid.impid] = bid;\n    }));\n  }\n  const bids = [];\n  Object.keys(idToImpMap).forEach(id => {\n    if (idToBidMap[id]) {\n      const bid = {};\n      bid.requestId = id;\n      bid.creativeId = idToBidMap[id].adid;\n      bid.cpm = idToBidMap[id].price;\n      bid.currency = bidResponse.cur;\n      bid.ttl = 360;\n      bid.netRevenue = true;\n      bid.ad = idToBidMap[id].adm;\n      bid.ad = bid.ad.replace(/\\$(%7B|\\{)AUCTION_IMP_ID(%7D|\\})/gi, idToBidMap[id].impid);\n      bid.ad = bid.ad.replace(/\\$(%7B|\\{)AUCTION_AD_ID(%7D|\\})/gi, idToBidMap[id].adid);\n      bid.ad = bid.ad.replace(/\\$(%7B|\\{)AUCTION_PRICE(%7D|\\})/gi, idToBidMap[id].price);\n      bid.ad = bid.ad.replace(/\\$(%7B|\\{)AUCTION_CURRENCY(%7D|\\})/gi, bidResponse.cur);\n      bid.ad = bid.ad.replace(/\\$(%7B|\\{)AUCTION_BID_ID(%7D|\\})/gi, bidResponse.bidid);\n      bid.width = idToImpMap[id].banner.w;\n      bid.height = idToImpMap[id].banner.h;\n      bids.push(bid);\n    }\n  });\n  return bids;\n}\nfunction impression(slot) {\n  return {\n    id: slot.bidId,\n    banner: banner(slot),\n    bidfloor: slot.params.bidFloor || '0.000001',\n    tagid: slot.params.placementId.toString(),\n  };\n}\nfunction banner(slot) {\n  const size = parseSizesInput(slot.sizes)[0].split('x');\n  const width = parseInt(size[0]);\n  const height = parseInt(size[1]);\n  return {\n    w: width,\n    h: height,\n  };\n}\nfunction site(bidderRequest) {\n  const pubId = bidderRequest && bidderRequest.length > 0 ? bidderRequest[0].params.pubId : '0';\n  const siteId = bidderRequest && bidderRequest.length > 0 ? bidderRequest[0].params.siteId : '0';\n  const appParams = bidderRequest[0].params.app;\n  if (!appParams) {\n    return {\n      publisher: {\n        id: pubId.toString(),\n        domain: getTopWindowLocation().hostname,\n      },\n      id: siteId.toString(),\n      ref: getTopWindowReferrer(),\n      page: getTopWindowLocation().href,\n    }\n  }\n  return null;\n}\nfunction device() {\n  return {\n    ua: navigator.userAgent,\n    language: (navigator.language || navigator.browserLanguage || navigator.userLanguage || navigator.systemLanguage),\n    w: (window.screen.width || window.innerWidth),\n    h: (window.screen.height || window.innerHeigh),\n  };\n}\n\nregisterBidder(spec);\n\n\n\n// WEBPACK FOOTER //\n// ./modules/kummaBidAdapter.js"],"sourceRoot":""}