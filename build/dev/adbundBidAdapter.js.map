{"version":3,"sources":["webpack:///./modules/adbundBidAdapter.js"],"names":["CONSTANTS","require","utils","bidfactory","bidmanager","adloader","adaptermanager","AdBundAdapter","timezone","Date","getTimezoneOffset","bidAPIs","bidAPI","_stringify","param","result","key","hasOwnProperty","push","encodeURIComponent","join","_createCallback","bid","data","response","cpm","createBid","STATUS","GOOD","bidderCode","NO_BID","addBidResponse","placementCode","_requestBids","info","referrer","getTopWindowUrl","domain","getTopWindowLocation","hostname","ua","window","navigator","userAgent","params","sizes","JSON","stringify","callback","pbjs","adbundResponse","loadScript","_callBids","bids","forEach","callBids","registerBidAdapter","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;AAAA,IAAIA,YAAY,mBAAAC,CAAQ,CAAR,CAAhB;AACA,IAAIC,QAAQ,mBAAAD,CAAQ,CAAR,CAAZ;AACA,IAAIE,aAAa,mBAAAF,CAAQ,CAAR,CAAjB;AACA,IAAIG,aAAa,mBAAAH,CAAQ,CAAR,CAAjB;AACA,IAAII,WAAW,mBAAAJ,CAAQ,CAAR,CAAf;AACA,IAAIK,iBAAiB,mBAAAL,CAAQ,CAAR,CAArB;;AAEA,SAASM,aAAT,GAAyB;AACvB,MAAIC,WAAY,IAAIC,IAAJ,EAAD,CAAaC,iBAAb,EAAf;AACA,MAAIC,UAAU,CACZ,gDADY,EAEZ,gDAFY,CAAd;AAIA;AACA,MAAIC,SAASD,QAAQH,WAAW,CAAX,GAAe,CAAf,GAAmB,CAA3B,CAAb;;AAEA,WAASK,UAAT,CAAoBC,KAApB,EAA2B;AACzB,QAAIC,SAAS,EAAb;AACA,QAAIC,GAAJ;AACA,SAAKA,GAAL,IAAYF,KAAZ,EAAmB;AACjB,UAAIA,MAAMG,cAAN,CAAqBD,GAArB,CAAJ,EAA+B;AAC7BD,eAAOG,IAAP,CAAYF,MAAM,GAAN,GAAYG,mBAAmBL,MAAME,GAAN,CAAnB,CAAxB;AACD;AACF;AACD,WAAOD,OAAOK,IAAP,CAAY,GAAZ,CAAP;AACD;;AAED,WAASC,eAAT,CAAyBC,GAAzB,EAA8B;AAC5B,WAAO,UAAUC,IAAV,EAAgB;AACrB,UAAIC,QAAJ;AACA,UAAID,QAAQA,KAAKE,GAAjB,EAAsB;AACpBD,mBAAWrB,WAAWuB,SAAX,CAAqB1B,UAAU2B,MAAV,CAAiBC,IAAtC,CAAX;AACAJ,iBAASK,UAAT,GAAsB,QAAtB;AACA,iBAAcL,QAAd,EAAwBD,IAAxB;AACD,OAJD,MAIO;AACLC,mBAAWrB,WAAWuB,SAAX,CAAqB1B,UAAU2B,MAAV,CAAiBG,MAAtC,CAAX;AACAN,iBAASK,UAAT,GAAsB,QAAtB;AACD;AACDzB,iBAAW2B,cAAX,CAA0BT,IAAIU,aAA9B,EAA6CR,QAA7C;AACD,KAXD;AAYD;;AAED,WAASS,YAAT,CAAsBX,GAAtB,EAA2B;AACzB,QAAIY,OAAO;AACTC,gBAAUjC,MAAMkC,eAAN,EADD;AAETC,cAAQnC,MAAMoC,oBAAN,GAA6BC,QAF5B;AAGTC,UAAIC,OAAOC,SAAP,CAAiBC;AAHZ,KAAX;AAKA,QAAI7B,QAAQ,SAAc,EAAd,EAAkBQ,IAAIsB,MAAtB,EAA8BV,IAA9B,CAAZ;AACApB,UAAM+B,KAAN,GAAcC,KAAKC,SAAL,CAAejC,MAAM+B,KAAN,IAAevB,IAAIuB,KAAlC,CAAd;AACA/B,UAAMkC,QAAN,GAAiB,qBAAjB;AACAC,SAAKC,cAAL,GAAsB7B,gBAAgBC,GAAhB,CAAtB;AACAjB,aAAS8C,UAAT,CAAoBvC,SAAS,GAAT,GAAeC,WAAWC,KAAX,CAAnC;AACD;;AAED,WAASsC,SAAT,CAAmBR,MAAnB,EAA2B;AACzB,KAACA,OAAOS,IAAP,IAAe,EAAhB,EAAoBC,OAApB,CAA4B,UAAUhC,GAAV,EAAe;AACzCW,mBAAaX,GAAb;AACD,KAFD;AAGD;;AAED,SAAO;AACLiC,cAAUH;AADL,GAAP;AAGD;;AAED9C,eAAekD,kBAAf,CAAkC,IAAIjD,aAAJ,EAAlC,EAAuD,QAAvD;;AAEAkD,OAAOC,OAAP,GAAiBnD,aAAjB,C","file":"adbundBidAdapter.js","sourcesContent":["var CONSTANTS = require('src/constants.json');\nvar utils = require('src/utils.js');\nvar bidfactory = require('src/bidfactory.js');\nvar bidmanager = require('src/bidmanager.js');\nvar adloader = require('src/adloader');\nvar adaptermanager = require('src/adaptermanager');\n\nfunction AdBundAdapter() {\n  var timezone = (new Date()).getTimezoneOffset();\n  var bidAPIs = [\n    'http://us-east-engine.adbund.xyz/prebid/ad/get',\n    'http://us-west-engine.adbund.xyz/prebid/ad/get'\n  ];\n  // Based on the time zone to select the interface to the server\n  var bidAPI = bidAPIs[timezone < 0 ? 0 : 1];\n\n  function _stringify(param) {\n    var result = [];\n    var key;\n    for (key in param) {\n      if (param.hasOwnProperty(key)) {\n        result.push(key + '=' + encodeURIComponent(param[key]));\n      }\n    }\n    return result.join('&');\n  }\n\n  function _createCallback(bid) {\n    return function (data) {\n      var response;\n      if (data && data.cpm) {\n        response = bidfactory.createBid(CONSTANTS.STATUS.GOOD);\n        response.bidderCode = 'adbund';\n        Object.assign(response, data);\n      } else {\n        response = bidfactory.createBid(CONSTANTS.STATUS.NO_BID);\n        response.bidderCode = 'adbund';\n      }\n      bidmanager.addBidResponse(bid.placementCode, response);\n    };\n  }\n\n  function _requestBids(bid) {\n    var info = {\n      referrer: utils.getTopWindowUrl(),\n      domain: utils.getTopWindowLocation().hostname,\n      ua: window.navigator.userAgent\n    };\n    var param = Object.assign({}, bid.params, info);\n    param.sizes = JSON.stringify(param.sizes || bid.sizes);\n    param.callback = 'pbjs.adbundResponse';\n    pbjs.adbundResponse = _createCallback(bid);\n    adloader.loadScript(bidAPI + '?' + _stringify(param));\n  }\n\n  function _callBids(params) {\n    (params.bids || []).forEach(function (bid) {\n      _requestBids(bid);\n    });\n  }\n\n  return {\n    callBids: _callBids\n  };\n}\n\nadaptermanager.registerBidAdapter(new AdBundAdapter(), 'adbund');\n\nmodule.exports = AdBundAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/adbundBidAdapter.js"],"sourceRoot":""}