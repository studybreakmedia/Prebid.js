{"version":3,"sources":["webpack:///./modules/googleAnalyticsAdapter.js"],"names":["events","require","utils","CONSTANTS","adaptermanager","BID_REQUESTED","EVENTS","BID_TIMEOUT","BID_RESPONSE","BID_WON","_disableInteraction","nonInteraction","_analyticsQueue","_gaGlobal","_enableCheck","_category","_eventCount","_enableDistribution","_trackerSend","_sampled","exports","enableAnalytics","provider","options","trackerName","sampling","Math","random","parseFloat","global","enableDistribution","bid","existingEvents","getEvents","_each","eventObj","args","eventType","sendBidRequestToGa","sendBidResponseToGa","bidderArray","sendBidTimeouts","sendBidWonToGa","on","bidRequestObj","logMessage","_enable","getTrackerSend","checkAnalytics","window","i","length","call","push","fn","convertToCents","dollars","floor","getLoadTimeDistribution","time","distribution","getCpmDistribution","cpm","bidderCode","cpmCents","bidder","timeToRespond","dis","cpmDis","timedOutBidders","registerAnalyticsAdapter","adapter","code"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;AAIA,IAAIA,SAAS,mBAAAC,CAAQ,EAAR,CAAb;AACA,IAAIC,QAAQ,mBAAAD,CAAQ,CAAR,CAAZ;AACA,IAAIE,YAAY,mBAAAF,CAAQ,CAAR,CAAhB;AACA,IAAIG,iBAAiB,mBAAAH,CAAQ,CAAR,CAArB;;AAEA,IAAII,gBAAgBF,UAAUG,MAAV,CAAiBD,aAArC;AACA,IAAIE,cAAcJ,UAAUG,MAAV,CAAiBC,WAAnC;AACA,IAAIC,eAAeL,UAAUG,MAAV,CAAiBE,YAApC;AACA,IAAIC,UAAUN,UAAUG,MAAV,CAAiBG,OAA/B;;AAEA,IAAIC,sBAAsB,EAAEC,gBAAgB,IAAlB,EAA1B;AACA,IAAIC,kBAAkB,EAAtB;AACA,IAAIC,YAAY,IAAhB;AACA,IAAIC,eAAe,IAAnB;AACA,IAAIC,YAAY,gBAAhB;AACA,IAAIC,cAAc,CAAlB;AACA,IAAIC,sBAAsB,KAA1B;AACA,IAAIC,eAAe,IAAnB;AACA,IAAIC,WAAW,IAAf;;AAEA;;;;;;AAMAC,QAAQC,eAAR,GAA0B,gBAAiC;AAAA,MAArBC,QAAqB,QAArBA,QAAqB;AAAA,MAAXC,OAAW,QAAXA,OAAW;;AACzDV,cAAYS,YAAY,IAAxB;AACAJ,iBAAeK,WAAWA,QAAQC,WAAnB,GAAiCD,QAAQC,WAAR,GAAsB,OAAvD,GAAiE,MAAhF;AACAL,aAAW,OAAOI,OAAP,KAAmB,WAAnB,IAAkC,OAAOA,QAAQE,QAAf,KAA4B,WAA9D,IACAC,KAAKC,MAAL,KAAgBC,WAAWL,QAAQE,QAAnB,CAD3B;;AAGA,MAAIF,WAAW,OAAOA,QAAQM,MAAf,KAA0B,WAAzC,EAAsD;AACpDhB,gBAAYU,QAAQM,MAApB;AACD;AACD,MAAIN,WAAW,OAAOA,QAAQO,kBAAf,KAAsC,WAArD,EAAkE;AAChEb,0BAAsBM,QAAQO,kBAA9B;AACD;;AAED,MAAIC,MAAM,IAAV;;AAEA,MAAIZ,QAAJ,EAAc;AACZ;;AAEA,QAAIa,iBAAiBhC,OAAOiC,SAAP,EAArB;;AAEA/B,UAAMgC,KAAN,CAAYF,cAAZ,EAA4B,UAAUG,QAAV,EAAoB;AAC9C,UAAI,QAAOA,QAAP,yCAAOA,QAAP,OAAoB,QAAxB,EAAkC;AAChC;AACD;AACD,UAAIC,OAAOD,SAASC,IAApB;;AAEA,UAAID,SAASE,SAAT,KAAuBhC,aAA3B,EAA0C;AACxC0B,cAAMK,IAAN;AACAE,2BAAmBP,GAAnB;AACD,OAHD,MAGO,IAAII,SAASE,SAAT,KAAuB7B,YAA3B,EAAyC;AAC9C;AACAuB,cAAMK,IAAN;AACAG,4BAAoBR,GAApB;AACD,OAJM,MAIA,IAAII,SAASE,SAAT,KAAuB9B,WAA3B,EAAwC;AAC7C,YAAMiC,cAAcJ,IAApB;AACAK,wBAAgBD,WAAhB;AACD,OAHM,MAGA,IAAIL,SAASE,SAAT,KAAuB5B,OAA3B,EAAoC;AACzCsB,cAAMK,IAAN;AACAM,uBAAeX,GAAf;AACD;AACF,KApBD;;AAsBA;;AAEA;AACA/B,WAAO2C,EAAP,CAAUtC,aAAV,EAAyB,UAAUuC,aAAV,EAAyB;AAChDN,yBAAmBM,aAAnB;AACD,KAFD;;AAIA;AACA5C,WAAO2C,EAAP,CAAUnC,YAAV,EAAwB,UAAUuB,GAAV,EAAe;AACrCQ,0BAAoBR,GAApB;AACD,KAFD;;AAIA;AACA/B,WAAO2C,EAAP,CAAUpC,WAAV,EAAuB,UAAUiC,WAAV,EAAuB;AAC5CC,sBAAgBD,WAAhB;AACD,KAFD;;AAIA;AACAxC,WAAO2C,EAAP,CAAUlC,OAAV,EAAmB,UAAUsB,GAAV,EAAe;AAChCW,qBAAeX,GAAf;AACD,KAFD;AAGD,GAhDD,MAgDO;AACL7B,UAAM2C,UAAN,CAAiB,iDAAjB;AACD;;AAED;AACA,OAAKxB,eAAL,GAAuB,SAASyB,OAAT,GAAmB;AACxC,WAAO5C,MAAM2C,UAAN,6EAAP;AACD,GAFD;AAGD,CAvED;;AAyEAzB,QAAQ2B,cAAR,GAAyB,SAASA,cAAT,GAA0B;AACjD,SAAO7B,YAAP;AACD,CAFD;;AAIA;;;AAGA,SAAS8B,cAAT,GAA0B;AACxB,MAAIlC,gBAAgB,OAAOmC,OAAOpC,SAAP,CAAP,KAA6B,UAAjD,EAA6D;AAC3D,SAAK,IAAIqC,IAAI,CAAb,EAAgBA,IAAItC,gBAAgBuC,MAApC,EAA4CD,GAA5C,EAAiD;AAC/CtC,sBAAgBsC,CAAhB,EAAmBE,IAAnB;AACD;;AAED;AACAxC,oBAAgByC,IAAhB,GAAuB,UAAUC,EAAV,EAAc;AACnCA,SAAGF,IAAH;AACD,KAFD;;AAIA;AACAtC,mBAAe,KAAf;AACD;;AAEDZ,QAAM2C,UAAN,CAAiB,6BAA6B7B,WAA9C;AACD;;AAED,SAASuC,cAAT,CAAwBC,OAAxB,EAAiC;AAC/B,MAAIA,OAAJ,EAAa;AACX,WAAO9B,KAAK+B,KAAL,CAAWD,UAAU,GAArB,CAAP;AACD;;AAED,SAAO,CAAP;AACD;;AAED,SAASE,uBAAT,CAAiCC,IAAjC,EAAuC;AACrC,MAAIC,YAAJ;AACA,MAAID,QAAQ,CAAR,IAAaA,OAAO,GAAxB,EAA6B;AAC3BC,mBAAe,SAAf;AACD,GAFD,MAEO,IAAID,QAAQ,GAAR,IAAeA,OAAO,GAA1B,EAA+B;AACpCC,mBAAe,YAAf;AACD,GAFM,MAEA,IAAID,QAAQ,GAAR,IAAeA,OAAO,GAA1B,EAA+B;AACpCC,mBAAe,YAAf;AACD,GAFM,MAEA,IAAID,QAAQ,GAAR,IAAeA,OAAO,GAA1B,EAA+B;AACpCC,mBAAe,YAAf;AACD,GAFM,MAEA,IAAID,QAAQ,GAAR,IAAeA,OAAO,GAA1B,EAA+B;AACpCC,mBAAe,YAAf;AACD,GAFM,MAEA,IAAID,QAAQ,GAAR,IAAeA,OAAO,GAA1B,EAA+B;AACpCC,mBAAe,YAAf;AACD,GAFM,MAEA,IAAID,QAAQ,GAAR,IAAeA,OAAO,IAA1B,EAAgC;AACrCC,mBAAe,aAAf;AACD,GAFM,MAEA,IAAID,QAAQ,IAAR,IAAgBA,OAAO,IAA3B,EAAiC;AACtCC,mBAAe,aAAf;AACD,GAFM,MAEA,IAAID,QAAQ,IAAR,IAAgBA,OAAO,IAA3B,EAAiC;AACtCC,mBAAe,aAAf;AACD,GAFM,MAEA,IAAID,QAAQ,IAAR,IAAgBA,OAAO,IAA3B,EAAiC;AACtCC,mBAAe,aAAf;AACD,GAFM,MAEA,IAAID,QAAQ,IAAZ,EAAkB;AACvBC,mBAAe,cAAf;AACD;;AAED,SAAOA,YAAP;AACD;;AAED,SAASC,kBAAT,CAA4BC,GAA5B,EAAiC;AAC/B,MAAIF,YAAJ;AACA,MAAIE,OAAO,CAAP,IAAYA,MAAM,GAAtB,EAA2B;AACzBF,mBAAe,QAAf;AACD,GAFD,MAEO,IAAIE,OAAO,GAAP,IAAcA,MAAM,CAAxB,EAA2B;AAChCF,mBAAe,QAAf;AACD,GAFM,MAEA,IAAIE,OAAO,CAAP,IAAYA,MAAM,GAAtB,EAA2B;AAChCF,mBAAe,QAAf;AACD,GAFM,MAEA,IAAIE,OAAO,GAAP,IAAcA,MAAM,CAAxB,EAA2B;AAChCF,mBAAe,QAAf;AACD,GAFM,MAEA,IAAIE,OAAO,CAAP,IAAYA,MAAM,GAAtB,EAA2B;AAChCF,mBAAe,QAAf;AACD,GAFM,MAEA,IAAIE,OAAO,GAAP,IAAcA,MAAM,CAAxB,EAA2B;AAChCF,mBAAe,QAAf;AACD,GAFM,MAEA,IAAIE,OAAO,CAAP,IAAYA,MAAM,CAAtB,EAAyB;AAC9BF,mBAAe,MAAf;AACD,GAFM,MAEA,IAAIE,OAAO,CAAP,IAAYA,MAAM,CAAtB,EAAyB;AAC9BF,mBAAe,MAAf;AACD,GAFM,MAEA,IAAIE,OAAO,CAAP,IAAYA,MAAM,CAAtB,EAAyB;AAC9BF,mBAAe,MAAf;AACD,GAFM,MAEA,IAAIE,OAAO,CAAX,EAAc;AACnBF,mBAAe,UAAf;AACD;;AAED,SAAOA,YAAP;AACD;;AAED,SAAStB,kBAAT,CAA4BP,GAA5B,EAAiC;AAC/B,MAAIA,OAAOA,IAAIgC,UAAf,EAA2B;AACzBnD,oBAAgByC,IAAhB,CAAqB,YAAY;AAC/BrC;AACAiC,aAAOpC,SAAP,EAAkBK,YAAlB,EAAgC,OAAhC,EAAyCH,SAAzC,EAAoD,UAApD,EAAgEgB,IAAIgC,UAApE,EAAgF,CAAhF,EAAmFrD,mBAAnF;AACD,KAHD;AAID;;AAED;AACAsC;AACD;;AAED,SAAST,mBAAT,CAA6BR,GAA7B,EAAkC;AAChC,MAAIA,OAAOA,IAAIgC,UAAf,EAA2B;AACzBnD,oBAAgByC,IAAhB,CAAqB,YAAY;AAC/B,UAAIW,WAAWT,eAAexB,IAAI+B,GAAnB,CAAf;AACA,UAAIG,SAASlC,IAAIgC,UAAjB;AACA,UAAI,OAAOhC,IAAImC,aAAX,KAA6B,WAA7B,IAA4CjD,mBAAhD,EAAqE;AACnED;AACA,YAAImD,MAAMT,wBAAwB3B,IAAImC,aAA5B,CAAV;AACAjB,eAAOpC,SAAP,EAAkBK,YAAlB,EAAgC,OAAhC,EAAyC,kCAAzC,EAA6EiD,GAA7E,EAAkFF,MAAlF,EAA0F,CAA1F,EAA6FvD,mBAA7F;AACD;;AAED,UAAIqB,IAAI+B,GAAJ,GAAU,CAAd,EAAiB;AACf9C,sBAAcA,cAAc,CAA5B;AACA,YAAIoD,SAASP,mBAAmB9B,IAAI+B,GAAvB,CAAb;AACA,YAAI7C,mBAAJ,EAAyB;AACvBD;AACAiC,iBAAOpC,SAAP,EAAkBK,YAAlB,EAAgC,OAAhC,EAAyC,4BAAzC,EAAuEkD,MAAvE,EAA+EH,MAA/E,EAAuF,CAAvF,EAA0FvD,mBAA1F;AACD;;AAEDuC,eAAOpC,SAAP,EAAkBK,YAAlB,EAAgC,OAAhC,EAAyCH,SAAzC,EAAoD,MAApD,EAA4DkD,MAA5D,EAAoED,QAApE,EAA8EtD,mBAA9E;AACAuC,eAAOpC,SAAP,EAAkBK,YAAlB,EAAgC,OAAhC,EAAyCH,SAAzC,EAAoD,eAApD,EAAqEkD,MAArE,EAA6ElC,IAAImC,aAAjF,EAAgGxD,mBAAhG;AACD;AACF,KApBD;AAqBD;;AAED;AACAsC;AACD;;AAED,SAASP,eAAT,CAAyB4B,eAAzB,EAA0C;AACxCzD,kBAAgByC,IAAhB,CAAqB,YAAY;AAC/BnD,UAAMgC,KAAN,CAAYmC,eAAZ,EAA6B,UAAUN,UAAV,EAAsB;AACjD/C;AACAiC,aAAOpC,SAAP,EAAkBK,YAAlB,EAAgC,OAAhC,EAAyCH,SAAzC,EAAoD,UAApD,EAAgEgD,UAAhE,EAA4ErD,mBAA5E;AACD,KAHD;AAID,GALD;;AAOAsC;AACD;;AAED,SAASN,cAAT,CAAwBX,GAAxB,EAA6B;AAC3B,MAAIiC,WAAWT,eAAexB,IAAI+B,GAAnB,CAAf;AACAlD,kBAAgByC,IAAhB,CAAqB,YAAY;AAC/BrC;AACAiC,WAAOpC,SAAP,EAAkBK,YAAlB,EAAgC,OAAhC,EAAyCH,SAAzC,EAAoD,MAApD,EAA4DgB,IAAIgC,UAAhE,EAA4EC,QAA5E,EAAsFtD,mBAAtF;AACD,GAHD;;AAKAsC;AACD;;AAED5C,eAAekE,wBAAf,CAAwC;AACtCC,WAASnD,OAD6B;AAEtCoD,QAAM;AAFgC,CAAxC,E","file":"googleAnalyticsAdapter.js","sourcesContent":["/**\n * ga.js - analytics adapter for google analytics\n */\n\nvar events = require('src/events');\nvar utils = require('src/utils');\nvar CONSTANTS = require('src/constants.json');\nvar adaptermanager = require('src/adaptermanager');\n\nvar BID_REQUESTED = CONSTANTS.EVENTS.BID_REQUESTED;\nvar BID_TIMEOUT = CONSTANTS.EVENTS.BID_TIMEOUT;\nvar BID_RESPONSE = CONSTANTS.EVENTS.BID_RESPONSE;\nvar BID_WON = CONSTANTS.EVENTS.BID_WON;\n\nvar _disableInteraction = { nonInteraction: true };\nvar _analyticsQueue = [];\nvar _gaGlobal = null;\nvar _enableCheck = true;\nvar _category = 'Prebid.js Bids';\nvar _eventCount = 0;\nvar _enableDistribution = false;\nvar _trackerSend = null;\nvar _sampled = true;\n\n/**\n * This will enable sending data to google analytics. Only call once, or duplicate data will be sent!\n * @param  {object} provider use to set GA global (if renamed);\n * @param  {object} options use to configure adapter;\n * @return {[type]}    [description]\n */\nexports.enableAnalytics = function ({ provider, options }) {\n  _gaGlobal = provider || 'ga';\n  _trackerSend = options && options.trackerName ? options.trackerName + '.send' : 'send';\n  _sampled = typeof options === 'undefined' || typeof options.sampling === 'undefined' ||\n             Math.random() < parseFloat(options.sampling);\n\n  if (options && typeof options.global !== 'undefined') {\n    _gaGlobal = options.global;\n  }\n  if (options && typeof options.enableDistribution !== 'undefined') {\n    _enableDistribution = options.enableDistribution;\n  }\n\n  var bid = null;\n\n  if (_sampled) {\n    // first send all events fired before enableAnalytics called\n\n    var existingEvents = events.getEvents();\n\n    utils._each(existingEvents, function (eventObj) {\n      if (typeof eventObj !== 'object') {\n        return;\n      }\n      var args = eventObj.args;\n\n      if (eventObj.eventType === BID_REQUESTED) {\n        bid = args;\n        sendBidRequestToGa(bid);\n      } else if (eventObj.eventType === BID_RESPONSE) {\n        // bid is 2nd args\n        bid = args;\n        sendBidResponseToGa(bid);\n      } else if (eventObj.eventType === BID_TIMEOUT) {\n        const bidderArray = args;\n        sendBidTimeouts(bidderArray);\n      } else if (eventObj.eventType === BID_WON) {\n        bid = args;\n        sendBidWonToGa(bid);\n      }\n    });\n\n    // Next register event listeners to send data immediately\n\n    // bidRequests\n    events.on(BID_REQUESTED, function (bidRequestObj) {\n      sendBidRequestToGa(bidRequestObj);\n    });\n\n    // bidResponses\n    events.on(BID_RESPONSE, function (bid) {\n      sendBidResponseToGa(bid);\n    });\n\n    // bidTimeouts\n    events.on(BID_TIMEOUT, function (bidderArray) {\n      sendBidTimeouts(bidderArray);\n    });\n\n    // wins\n    events.on(BID_WON, function (bid) {\n      sendBidWonToGa(bid);\n    });\n  } else {\n    utils.logMessage('Prebid.js google analytics disabled by sampling');\n  }\n\n  // finally set this function to return log message, prevents multiple adapter listeners\n  this.enableAnalytics = function _enable() {\n    return utils.logMessage(`Analytics adapter already enabled, unnecessary call to \\`enableAnalytics\\`.`);\n  };\n};\n\nexports.getTrackerSend = function getTrackerSend() {\n  return _trackerSend;\n};\n\n/**\n * Check if gaGlobal or window.ga is defined on page. If defined execute all the GA commands\n */\nfunction checkAnalytics() {\n  if (_enableCheck && typeof window[_gaGlobal] === 'function') {\n    for (var i = 0; i < _analyticsQueue.length; i++) {\n      _analyticsQueue[i].call();\n    }\n\n    // override push to execute the command immediately from now on\n    _analyticsQueue.push = function (fn) {\n      fn.call();\n    };\n\n    // turn check into NOOP\n    _enableCheck = false;\n  }\n\n  utils.logMessage('event count sent to GA: ' + _eventCount);\n}\n\nfunction convertToCents(dollars) {\n  if (dollars) {\n    return Math.floor(dollars * 100);\n  }\n\n  return 0;\n}\n\nfunction getLoadTimeDistribution(time) {\n  var distribution;\n  if (time >= 0 && time < 200) {\n    distribution = '0-200ms';\n  } else if (time >= 200 && time < 300) {\n    distribution = '0200-300ms';\n  } else if (time >= 300 && time < 400) {\n    distribution = '0300-400ms';\n  } else if (time >= 400 && time < 500) {\n    distribution = '0400-500ms';\n  } else if (time >= 500 && time < 600) {\n    distribution = '0500-600ms';\n  } else if (time >= 600 && time < 800) {\n    distribution = '0600-800ms';\n  } else if (time >= 800 && time < 1000) {\n    distribution = '0800-1000ms';\n  } else if (time >= 1000 && time < 1200) {\n    distribution = '1000-1200ms';\n  } else if (time >= 1200 && time < 1500) {\n    distribution = '1200-1500ms';\n  } else if (time >= 1500 && time < 2000) {\n    distribution = '1500-2000ms';\n  } else if (time >= 2000) {\n    distribution = '2000ms above';\n  }\n\n  return distribution;\n}\n\nfunction getCpmDistribution(cpm) {\n  var distribution;\n  if (cpm >= 0 && cpm < 0.5) {\n    distribution = '$0-0.5';\n  } else if (cpm >= 0.5 && cpm < 1) {\n    distribution = '$0.5-1';\n  } else if (cpm >= 1 && cpm < 1.5) {\n    distribution = '$1-1.5';\n  } else if (cpm >= 1.5 && cpm < 2) {\n    distribution = '$1.5-2';\n  } else if (cpm >= 2 && cpm < 2.5) {\n    distribution = '$2-2.5';\n  } else if (cpm >= 2.5 && cpm < 3) {\n    distribution = '$2.5-3';\n  } else if (cpm >= 3 && cpm < 4) {\n    distribution = '$3-4';\n  } else if (cpm >= 4 && cpm < 6) {\n    distribution = '$4-6';\n  } else if (cpm >= 6 && cpm < 8) {\n    distribution = '$6-8';\n  } else if (cpm >= 8) {\n    distribution = '$8 above';\n  }\n\n  return distribution;\n}\n\nfunction sendBidRequestToGa(bid) {\n  if (bid && bid.bidderCode) {\n    _analyticsQueue.push(function () {\n      _eventCount++;\n      window[_gaGlobal](_trackerSend, 'event', _category, 'Requests', bid.bidderCode, 1, _disableInteraction);\n    });\n  }\n\n  // check the queue\n  checkAnalytics();\n}\n\nfunction sendBidResponseToGa(bid) {\n  if (bid && bid.bidderCode) {\n    _analyticsQueue.push(function () {\n      var cpmCents = convertToCents(bid.cpm);\n      var bidder = bid.bidderCode;\n      if (typeof bid.timeToRespond !== 'undefined' && _enableDistribution) {\n        _eventCount++;\n        var dis = getLoadTimeDistribution(bid.timeToRespond);\n        window[_gaGlobal](_trackerSend, 'event', 'Prebid.js Load Time Distribution', dis, bidder, 1, _disableInteraction);\n      }\n\n      if (bid.cpm > 0) {\n        _eventCount = _eventCount + 2;\n        var cpmDis = getCpmDistribution(bid.cpm);\n        if (_enableDistribution) {\n          _eventCount++;\n          window[_gaGlobal](_trackerSend, 'event', 'Prebid.js CPM Distribution', cpmDis, bidder, 1, _disableInteraction);\n        }\n\n        window[_gaGlobal](_trackerSend, 'event', _category, 'Bids', bidder, cpmCents, _disableInteraction);\n        window[_gaGlobal](_trackerSend, 'event', _category, 'Bid Load Time', bidder, bid.timeToRespond, _disableInteraction);\n      }\n    });\n  }\n\n  // check the queue\n  checkAnalytics();\n}\n\nfunction sendBidTimeouts(timedOutBidders) {\n  _analyticsQueue.push(function () {\n    utils._each(timedOutBidders, function (bidderCode) {\n      _eventCount++;\n      window[_gaGlobal](_trackerSend, 'event', _category, 'Timeouts', bidderCode, _disableInteraction);\n    });\n  });\n\n  checkAnalytics();\n}\n\nfunction sendBidWonToGa(bid) {\n  var cpmCents = convertToCents(bid.cpm);\n  _analyticsQueue.push(function () {\n    _eventCount++;\n    window[_gaGlobal](_trackerSend, 'event', _category, 'Wins', bid.bidderCode, cpmCents, _disableInteraction);\n  });\n\n  checkAnalytics();\n}\n\nadaptermanager.registerAnalyticsAdapter({\n  adapter: exports,\n  code: 'ga'\n});\n\n\n\n// WEBPACK FOOTER //\n// ./modules/googleAnalyticsAdapter.js"],"sourceRoot":""}