{"version":3,"sources":["webpack:///./modules/c1xBidAdapter.js"],"names":["CONSTANTS","require","utils","bidfactory","bidmanager","adloader","adaptermanager","C1XAdapter","ENDPOINT","PIXEL_ENDPOINT","PIXEL_FIRE_DELAY","LOG_MSG","invalidBid","noSite","noBid","bidWin","BIDDER_CODE","pbjs","window","_c1xResponse","c1xResponse","response","JSON","parse","error","logError","i","length","data","bidObject","bid","createBid","STATUS","GOOD","bidderCode","cpm","ad","width","height","logInfo","adId","addBidResponse","noBidResponse","slots","adUnits","logWarn","code","NO_BID","injectAudiencePixel","pixel","pixelId","setTimeout","document","createElement","style","useSSL","location","protocol","src","body","insertBefore","_callBids","params","bids","c1xParams","siteId","options","push","placementCode","sizes","sizeStr","reduce","prev","current","join","floorPriceMap","adUnitSize","Date","getTime","c1xEndpoint","endpoint","dspid","url","loadScript","callBids","registerBidAdapter","module","exports"],"mappings":"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","file":"c1xBidAdapter.js","sourcesContent":["var CONSTANTS = require('src/constants.json');\nvar utils = require('src/utils.js');\nvar bidfactory = require('src/bidfactory.js');\nvar bidmanager = require('src/bidmanager.js');\nvar adloader = require('src/adloader');\nvar adaptermanager = require('src/adaptermanager.js');\n\n/**\n * Adapter for requesting bids from C1X header tag server.\n * v2.0 (c) C1X Inc., 2017\n *\n * @param {Object} options - Configuration options for C1X\n *\n * @returns {{callBids: _callBids}}\n * @constructor\n */\nfunction C1XAdapter() {\n  // default endpoint. Can be overridden by adding an \"endpoint\" property to the first param in bidder config.\n  var ENDPOINT = 'http://ht-integration.c1exchange.com:9000/ht';\n  var PIXEL_ENDPOINT = '//px.c1exchange.com/pubpixel/';\n  var PIXEL_FIRE_DELAY = 3000;\n  var LOG_MSG = {\n    invalidBid: 'C1X: ERROR bidder returns an invalid bid',\n    noSite: 'C1X: ERROR no site id supplied',\n    noBid: 'C1X: INFO creating a NO bid for Adunit: ',\n    bidWin: 'C1X: INFO creating a bid for Adunit: '\n  };\n  var BIDDER_CODE = 'c1x';\n\n  var pbjs = window.pbjs;\n\n  pbjs._c1xResponse = function(c1xResponse) {\n    var response = c1xResponse;\n\n    if (typeof response === 'string') {\n      try {\n        response = JSON.parse(c1xResponse);\n      } catch (error) {\n        utils.logError(error);\n      }\n    }\n\n    if (response && !response.error) {\n      for (var i = 0; i < response.length; i++) {\n        var data = response[i];\n        var bidObject = null;\n        if (data.bid) {\n          bidObject = bidfactory.createBid(CONSTANTS.STATUS.GOOD);\n          bidObject.bidderCode = BIDDER_CODE;\n          bidObject.cpm = data.cpm;\n          bidObject.ad = data.ad;\n          bidObject.width = data.width;\n          bidObject.height = data.height;\n          utils.logInfo(LOG_MSG.bidWin + data.adId + ' size: ' + data.width + 'x' + data.height);\n          bidmanager.addBidResponse(data.adId, bidObject);\n        } else {\n          // no bid\n          utils.logInfo(LOG_MSG.noBid + data.adId);\n          bidmanager.addBidResponse(data.adId, noBidResponse());\n        }\n      }\n    } else {\n      // invalid bid\n      var slots = pbjs.adUnits;\n      utils.logWarn(LOG_MSG.invalidBid);\n      for (i = 0; i < slots.length; i++) {\n        bidmanager.addBidResponse(slots[i].code, noBidResponse());\n      }\n    }\n  };\n\n  function noBidResponse() {\n    var bidObject = bidfactory.createBid(CONSTANTS.STATUS.NO_BID);\n    bidObject.bidderCode = BIDDER_CODE;\n    return bidObject;\n  }\n\n  // inject the audience pixel only if bids.params.pixelId is set.\n  function injectAudiencePixel(pixel) {\n    var pixelId = pixel;\n    window.setTimeout(function() {\n      var pixel = document.createElement('img');\n      pixel.width = 1;\n      pixel.height = 1;\n      pixel.style = 'display:none;';\n      var useSSL = document.location.protocol;\n      pixel.src = (useSSL ? 'https:' : 'http:') + PIXEL_ENDPOINT + pixelId;\n      document.body.insertBefore(pixel, null);\n    }, PIXEL_FIRE_DELAY);\n  }\n\n  function _callBids(params) {\n    var bids = params.bids;\n    var c1xParams = bids[0].params;\n\n    if (c1xParams.pixelId) {\n      var pixelId = c1xParams.pixelId;\n      injectAudiencePixel(pixelId);\n    }\n\n    var siteId = c1xParams.siteId;\n    if (!siteId) {\n      utils.logWarn(LOG_MSG.noSite);\n      return;\n    }\n\n    var options = ['adunits=' + bids.length];\n    options.push('site=' + siteId);\n\n    for (var i = 0; i < bids.length; i++) {\n      options.push('a' + (i + 1) + '=' + bids[i].placementCode);\n      var sizes = bids[i].sizes;\n      var sizeStr = sizes.reduce(function(prev, current) { return prev + (prev === '' ? '' : ',') + current.join('x') }, '');\n      // send floor price if the setting is available.\n      var floorPriceMap = c1xParams.floorPriceMap;\n      if (floorPriceMap) {\n        var adUnitSize = sizes[0].join('x');\n        if (adUnitSize in floorPriceMap) {\n          options.push('a' + (i + 1) + 'p=' + floorPriceMap[adUnitSize]);\n        }\n      }\n      options.push('a' + (i + 1) + 's=[' + sizeStr + ']');\n    }\n    options.push('rid=' + new Date().getTime()); // cache busting\n    var c1xEndpoint = ENDPOINT;\n    if (c1xParams.endpoint) {\n      c1xEndpoint = c1xParams.endpoint;\n    }\n    var dspid = c1xParams.dspid;\n    if (dspid) {\n      options.push('dspid=' + dspid);\n    }\n    var url = c1xEndpoint + '?' + options.join('&');\n    window._c1xResponse = function (c1xResponse) {\n      pbjs._c1xResponse(c1xResponse);\n    };\n    adloader.loadScript(url);\n  }\n  // Export the callBids function, so that prebid.js can execute this function\n  // when the page asks to send out bid requests.\n  return {\n    callBids: _callBids\n  };\n};\n\nadaptermanager.registerBidAdapter(new C1XAdapter(), 'c1x');\nmodule.exports = C1XAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/c1xBidAdapter.js"],"sourceRoot":""}