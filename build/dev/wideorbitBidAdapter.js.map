{"version":3,"sources":["webpack:///./modules/wideorbitBidAdapter.js"],"names":["bidfactory","require","bidmanager","utils","adloader","adaptermanager","WideOrbitAdapter","pageImpression","pageRepeatCommonParam","pageRepeatParamId","pageRepeatParamNamed","base","window","location","protocol","bids","adapterName","_fixParamNames","param","properties","prop","_each","correctName","hasOwnProperty","toLowerCase","_setParam","str","value","pattern","RegExp","replace","_setParams","keyValuePairs","keyValuePair","_setCommonParams","pos","params","encodeURIComponent","tagId","atf","ecpm","_getRankParam","rank","_setupIdPlacementParameters","pId","_setupNamedPlacementParameters","decodeURIComponent","site","page","width","height","subPublisher","_setupAdCall","publisherId","placementCount","placementsComponent","referrer","Date","getTime","Math","floor","random","_setupPlacementParameters","commonParams","_callBids","bidUrl","i","length","requestParams","placementCode","pbId","logMessage","loadScript","_processUserMatchings","userMatchings","headElem","document","getElementsByTagName","createdElem","userMatching","undefined","Type","createElement","createInvisibleIframe","type","async","src","Url","insertBefore","firstChild","_getBidResponse","id","placements","ExtPlacementId","_isUrl","scr","slice","_buildAdCode","placement","adCode","Source","pixelTag","TrackingCodes","trackingCode","pbjs","handleWideOrbitCallback","response","bidResponse","bidObject","Placements","UserMatchings","bid","createBid","cpm","Bid","ad","Width","Height","bidderCode","addBidResponse","callBids","registerBidAdapter","module","exports"],"mappings":"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","file":"wideorbitBidAdapter.js","sourcesContent":["const bidfactory = require('src/bidfactory.js');\nconst bidmanager = require('src/bidmanager.js');\nconst utils = require('src/utils.js');\nconst adloader = require('src/adloader');\nconst adaptermanager = require('src/adaptermanager');\n\nfunction WideOrbitAdapter() {\n  const pageImpression = 'JSAdservingMP.ashx?pc={pc}&pbId={pbId}&clk=&exm=&jsv=1.0&tsv=1.0&cts={cts}&arp=0&fl=0&vitp=&vit=&jscb=window.pbjs.handleWideOrbitCallback&url={referrer}&fp=&oid=&exr=&mraid=&apid=&apbndl=&mpp=0&uid=&cb={cb}&hb=1';\n  const pageRepeatCommonParam = '&gid{o}={gid}&pp{o}=&clk{o}=&rpos{o}={rpos}&ecpm{o}={ecpm}&ntv{o}=&ntl{o}=&adsid{o}=';\n  const pageRepeatParamId = '&pId{o}={pId}&rank{o}={rank}';\n  const pageRepeatParamNamed = '&wsName{o}={wsName}&wName{o}={wName}&rank{o}={rank}&bfDim{o}={width}x{height}&subp{o}={subp}';\n  const base = (window.location.protocol) + '//p{pbId}.atemda.com/';\n  let bids;\n  const adapterName = 'wideorbit';\n\n  function _fixParamNames(param) {\n    if (!param) {\n      return;\n    }\n\n    const properties = ['site', 'page', 'width', 'height', 'rank', 'subPublisher', 'ecpm', 'atf', 'pId', 'pbId', 'referrer'];\n    let prop;\n\n    utils._each(properties, function (correctName) {\n      for (prop in param) {\n        if (param.hasOwnProperty(prop) && prop.toLowerCase() === correctName.toLowerCase()) {\n          param[correctName] = param[prop];\n          break;\n        }\n      }\n    });\n  }\n\n  function _setParam(str, param, value) {\n    var pattern = new RegExp('{' + param + '}', 'g');\n\n    if (value === true) {\n      value = 1;\n    }\n    if (value === false) {\n      value = 0;\n    }\n    return str.replace(pattern, value);\n  }\n\n  function _setParams(str, keyValuePairs) {\n    utils._each(keyValuePairs, function (keyValuePair) {\n      str = _setParam(str, keyValuePair[0], keyValuePair[1]);\n    });\n    return str;\n  }\n\n  function _setCommonParams(pos, params) {\n    return _setParams(pageRepeatCommonParam, [\n      ['o', pos],\n      ['gid', encodeURIComponent(params.tagId)],\n      ['rpos', params.atf ? 1001 : 0],\n      ['ecpm', params.ecpm || '']\n    ]);\n  }\n\n  function _getRankParam(rank, pos) {\n    return rank || pos;\n  }\n\n  function _setupIdPlacementParameters(pos, params) {\n    return _setParams(pageRepeatParamId, [\n      ['o', pos],\n      ['pId', params.pId],\n      ['rank', _getRankParam(params.rank, pos)]\n    ]);\n  }\n\n  function _setupNamedPlacementParameters(pos, params) {\n    return _setParams(pageRepeatParamNamed, [\n      ['o', pos],\n      ['wsName', encodeURIComponent(decodeURIComponent(params.site))],\n      ['wName', encodeURIComponent(decodeURIComponent(params.page))],\n      ['width', params.width],\n      ['height', params.height],\n      ['subp', params.subPublisher ? encodeURIComponent(decodeURIComponent(params.subPublisher)) : ''],\n      ['rank', _getRankParam(params.rank, pos)]\n    ]);\n  }\n\n  function _setupAdCall(publisherId, placementCount, placementsComponent, referrer) {\n    return _setParams(base + pageImpression, [\n      ['pbId', publisherId],\n      ['pc', placementCount],\n      ['cts', new Date().getTime()],\n      ['cb', Math.floor(Math.random() * 100000000)],\n      ['referrer', encodeURIComponent(referrer || '')]\n    ]) + placementsComponent;\n  }\n\n  function _setupPlacementParameters(pos, params) {\n    var commonParams = _setCommonParams(pos, params);\n\n    if (params.pId) {\n      return _setupIdPlacementParameters(pos, params) + commonParams;\n    }\n\n    return _setupNamedPlacementParameters(pos, params) + commonParams;\n  }\n\n  function _callBids(params) {\n    let publisherId;\n    let bidUrl = '';\n    let i;\n    let referrer;\n\n    bids = params.bids || [];\n\n    for (i = 0; i < bids.length; i++) {\n      var requestParams = bids[i].params;\n\n      requestParams.tagId = bids[i].placementCode;\n\n      _fixParamNames(requestParams);\n\n      publisherId = requestParams.pbId;\n      referrer = referrer || requestParams.referrer;\n      bidUrl += _setupPlacementParameters(i, requestParams);\n    }\n\n    bidUrl = _setupAdCall(publisherId, bids.length, bidUrl, referrer);\n\n    utils.logMessage('Calling WO: ' + bidUrl);\n\n    adloader.loadScript(bidUrl);\n  }\n\n  function _processUserMatchings(userMatchings) {\n    const headElem = document.getElementsByTagName('head')[0];\n    let createdElem;\n\n    utils._each(userMatchings, function (userMatching) {\n      createdElem = undefined;\n      switch (userMatching.Type) {\n        case 'redirect':\n          createdElem = document.createElement('img');\n          break;\n        case 'iframe':\n          createdElem = utils.createInvisibleIframe();\n          break;\n        case 'js':\n          createdElem = document.createElement('script');\n          createdElem.type = 'text/javascript';\n          createdElem.async = true;\n          break;\n      }\n      if (createdElem) {\n        createdElem.src = decodeURIComponent(userMatching.Url);\n        headElem.insertBefore(createdElem, headElem.firstChild);\n      }\n    });\n  }\n\n  function _getBidResponse(id, placements) {\n    var i;\n\n    for (i = 0; i < placements.length; i++) {\n      if (placements[i].ExtPlacementId === id) {\n        return placements[i];\n      }\n    }\n  }\n\n  function _isUrl(scr) {\n    return scr.slice(0, 6) === 'http:/' || scr.slice(0, 7) === 'https:/' || scr.slice(0, 2) === '//';\n  }\n\n  function _buildAdCode(placement) {\n    let adCode = placement.Source;\n    let pixelTag;\n\n    utils._each(placement.TrackingCodes, function (trackingCode) {\n      if (_isUrl(trackingCode)) {\n        pixelTag = '<img src=\"' + trackingCode + '\" width=\"0\" height=\"0\" style=\"position:absolute\"></img>';\n      } else {\n        pixelTag = trackingCode;\n      }\n      adCode = pixelTag + adCode;\n    });\n\n    return adCode;\n  }\n\n  window.pbjs = window.pbjs || {};\n  window.pbjs.handleWideOrbitCallback = function (response) {\n    var bidResponse,\n      bidObject;\n\n    utils.logMessage('WO response. Placements: ' + response.Placements.length);\n\n    _processUserMatchings(response.UserMatchings);\n\n    utils._each(bids, function (bid) {\n      bidResponse = _getBidResponse(bid.placementCode, response.Placements);\n\n      if (bidResponse && bidResponse.Type === 'DirectHTML') {\n        bidObject = bidfactory.createBid(1);\n        bidObject.cpm = bidResponse.Bid;\n        bidObject.ad = _buildAdCode(bidResponse);\n        bidObject.width = bidResponse.Width;\n        bidObject.height = bidResponse.Height;\n      } else {\n        bidObject = bidfactory.createBid(2);\n      }\n\n      bidObject.bidderCode = adapterName;\n      bidmanager.addBidResponse(bid.placementCode, bidObject);\n    });\n  };\n\n  return {\n    callBids: _callBids\n  };\n}\n\nadaptermanager.registerBidAdapter(new WideOrbitAdapter(), 'wideorbit');\n\nmodule.exports = WideOrbitAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/wideorbitBidAdapter.js"],"sourceRoot":""}