{"version":3,"sources":["webpack:///./src/AnalyticsAdapter.js","webpack:///./modules/appnexusAnalyticsAdapter.js"],"names":["AnalyticsAdapter","events","require","utils","AUCTION_INIT","EVENTS","AUCTION_END","BID_REQUESTED","BID_TIMEOUT","BID_RESPONSE","BID_WON","BID_ADJUSTMENT","SET_TARGETING","LIBRARY","ENDPOINT","BUNDLE","_sampled","url","analyticsType","global","handler","_queue","_eventCount","_enableCheck","_handlers","_emptyQueue","track","_track","enqueue","_enqueue","enableAnalytics","_enable","disableAnalytics","_disable","getAdapterType","getGlobal","getHandler","getUrl","eventType","args","window","_callEndpoint","arguments","callback","JSON","stringify","_this","push","config","options","sampling","Math","random","parseFloat","getEvents","forEach","event","call","_each","on","logMessage","off","i","length","fn","appnexusAdapter","registerAnalyticsAdapter","adapter","code"],"mappings":"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","file":"appnexusAnalyticsAdapter.js","sourcesContent":["import CONSTANTS from './constants';\nimport { loadScript } from './adloader';\nimport { ajax } from './ajax';\n\nconst events = require('./events');\nconst utils = require('./utils');\n\nconst AUCTION_INIT = CONSTANTS.EVENTS.AUCTION_INIT;\nconst AUCTION_END = CONSTANTS.EVENTS.AUCTION_END;\nconst BID_REQUESTED = CONSTANTS.EVENTS.BID_REQUESTED;\nconst BID_TIMEOUT = CONSTANTS.EVENTS.BID_TIMEOUT;\nconst BID_RESPONSE = CONSTANTS.EVENTS.BID_RESPONSE;\nconst BID_WON = CONSTANTS.EVENTS.BID_WON;\nconst BID_ADJUSTMENT = CONSTANTS.EVENTS.BID_ADJUSTMENT;\nconst SET_TARGETING = CONSTANTS.EVENTS.SET_TARGETING;\n\nconst LIBRARY = 'library';\nconst ENDPOINT = 'endpoint';\nconst BUNDLE = 'bundle';\n\nvar _sampled = true;\n\nexport default function AnalyticsAdapter({ url, analyticsType, global, handler }) {\n  var _queue = [];\n  var _eventCount = 0;\n  var _enableCheck = true;\n  var _handlers;\n\n  if (analyticsType === LIBRARY) {\n    loadScript(url, _emptyQueue);\n  }\n\n  if (analyticsType === ENDPOINT || BUNDLE) {\n    _emptyQueue();\n  }\n\n  return {\n    track: _track,\n    enqueue: _enqueue,\n    enableAnalytics: _enable,\n    disableAnalytics: _disable,\n    getAdapterType: () => analyticsType,\n    getGlobal: () => global,\n    getHandler: () => handler,\n    getUrl: () => url\n  };\n\n  function _track({ eventType, args }) {\n    if (this.getAdapterType() === LIBRARY || BUNDLE) {\n      window[global](handler, eventType, args);\n    }\n\n    if (this.getAdapterType() === ENDPOINT) {\n      _callEndpoint(...arguments);\n    }\n  }\n\n  function _callEndpoint({ eventType, args, callback }) {\n    ajax(url, callback, JSON.stringify({ eventType, args }));\n  }\n\n  function _enqueue({ eventType, args }) {\n    const _this = this;\n\n    if (global && window[global] && eventType && args) {\n      this.track({ eventType, args });\n    } else {\n      _queue.push(function () {\n        _eventCount++;\n        _this.track({ eventType, args });\n      });\n    }\n  }\n\n  function _enable(config) {\n    var _this = this;\n\n    if (typeof config === 'object' && typeof config.options === 'object') {\n      _sampled = typeof config.options.sampling === 'undefined' || Math.random() < parseFloat(config.options.sampling);\n    } else {\n      _sampled = true;\n    }\n\n    if (_sampled) {\n      // first send all events fired before enableAnalytics called\n      events.getEvents().forEach(event => {\n        if (!event) {\n          return;\n        }\n\n        const { eventType, args } = event;\n\n        if (eventType !== BID_TIMEOUT) {\n          _enqueue.call(_this, { eventType, args });\n        }\n      });\n\n      // Next register event listeners to send data immediately\n\n      _handlers = {\n        [BID_REQUESTED]: args => this.enqueue({ eventType: BID_REQUESTED, args }),\n        [BID_RESPONSE]: args => this.enqueue({ eventType: BID_RESPONSE, args }),\n        [BID_TIMEOUT]: args => this.enqueue({ eventType: BID_TIMEOUT, args }),\n        [BID_WON]: args => this.enqueue({ eventType: BID_WON, args }),\n        [BID_ADJUSTMENT]: args => this.enqueue({ eventType: BID_ADJUSTMENT, args }),\n        [SET_TARGETING]: args => this.enqueue({ eventType: SET_TARGETING, args }),\n        [AUCTION_END]: args => this.enqueue({ eventType: AUCTION_END, args }),\n        [AUCTION_INIT]: args => {\n          args.config = config.options; // enableAnaltyics configuration object\n          this.enqueue({ eventType: AUCTION_INIT, args });\n        }\n      };\n\n      utils._each(_handlers, (handler, event) => {\n        events.on(event, handler);\n      });\n    } else {\n      utils.logMessage(`Analytics adapter for \"${global}\" disabled by sampling`);\n    }\n\n    // finally set this function to return log message, prevents multiple adapter listeners\n    this.enableAnalytics = function _enable() {\n      return utils.logMessage(`Analytics adapter for \"${global}\" already enabled, unnecessary call to \\`enableAnalytics\\`.`);\n    };\n  }\n\n  function _disable() {\n    utils._each(_handlers, (handler, event) => {\n      events.off(event, handler);\n    });\n  }\n\n  function _emptyQueue() {\n    if (_enableCheck) {\n      for (var i = 0; i < _queue.length; i++) {\n        _queue[i]();\n      }\n\n      // override push to execute the command immediately from now on\n      _queue.push = function (fn) {\n        fn();\n      };\n\n      _enableCheck = false;\n    }\n\n    utils.logMessage(`event count sent to ${global}: ${_eventCount}`);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/AnalyticsAdapter.js","/**\n * appnexus.js - AppNexus Prebid Analytics Adapter\n */\n\nimport adapter from 'src/AnalyticsAdapter';\nimport adaptermanager from 'src/adaptermanager';\n\nvar appnexusAdapter = adapter({\n  global: 'AppNexusPrebidAnalytics',\n  handler: 'on',\n  analyticsType: 'bundle'\n});\n\nadaptermanager.registerAnalyticsAdapter({\n  adapter: appnexusAdapter,\n  code: 'appnexus'\n});\n\nexport default appnexusAdapter;\n\n\n\n// WEBPACK FOOTER //\n// ./modules/appnexusAnalyticsAdapter.js"],"sourceRoot":""}